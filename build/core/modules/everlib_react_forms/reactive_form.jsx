'use strict';exports.__esModule=true;exports.ReactiveForm=undefined;var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _class,_temp,_jsxFileName='core/modules/everlib_react_forms/reactive_form.jsx';var _react=require('react');var _react2=_interopRequireDefault(_react);var _helpers=require('./_helpers');var H=_interopRequireWildcard(_helpers);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactiveForm=exports.ReactiveForm=(_temp=_class=function(_React$Component){(0,_inherits3.default)(ReactiveForm,_React$Component);function ReactiveForm(props){(0,_classCallCheck3.default)(this,ReactiveForm);var _this=(0,_possibleConstructorReturn3.default)(this,(ReactiveForm.__proto__||(0,_getPrototypeOf2.default)(ReactiveForm)).call(this,props));_this.getChildContext=function(){return _this.__getChildContext__REACT_HOT_LOADER__.apply(_this,arguments)};_this._createNewFormFieldOnState=function(){return _this.___createNewFormFieldOnState__REACT_HOT_LOADER__.apply(_this,arguments)};_this.addFieldOrFormError=function(){return _this.__addFieldOrFormError__REACT_HOT_LOADER__.apply(_this,arguments)};_this.checkFormStage=function(){return _this.__checkFormStage__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleChange=function(){return _this.__handleChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleRecaptchaChange=function(){return _this.__handleRecaptchaChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleBlur=function(){return _this.__handleBlur__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleFocus=function(){return _this.__handleFocus__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleFormSubmit=function(){return _this.__handleFormSubmit__REACT_HOT_LOADER__.apply(_this,arguments)};_this.pauseHandleFormSubmit=function(){return _this.__pauseHandleFormSubmit__REACT_HOT_LOADER__.apply(_this,arguments)};_this.render=function(){return _this.__render__REACT_HOT_LOADER__.apply(_this,arguments)};if(props.hideAllReactiveOnFocus&&props.hideAllReactiveUntilFirstBlur){throw new Error('Cannot set hideAllReactiveOnFocus and hideAllReactiveUntilFirstBlur to true.')}if(props.simulateLongResponse){console.warn('Simulating a long response from the server.')}_this.state={'stage':'neutral','hideAllReactiveOnFocus':props.hideAllReactiveOnFocus||false,'hideAllReactiveUntilFirstBlur':props.hideAllReactiveUntilFirstBlur||false,'delayAllErrorMessages':props.delayAllErrorMessages||0,'errorMessage':'','success':false,'fieldNames':[],'fields':{},'validations':[],'recaptchaForm':false,'recaptchaToken':'','simulateLongResponse':props.simulateLongResponse||false};_this.mapFormFieldsToState=function(children){_react2.default.Children.forEach(children,function(c){if(_react2.default.isValidElement(c)){if(c.type&&c.type.name&&['ReactiveInput','ReactiveTextarea'].includes(c.type.name)){_this._createNewFormFieldOnState(c.props)}if(c.type&&c.type.name&&c.type.name==='ReactiveCaptcha'){_this.state.recaptchaForm=true}if(c.props.children){_this.mapFormFieldsToState(c.props.children)}}})};_this.mapFormFieldsToState(props.children);return _this}(0,_createClass3.default)(ReactiveForm,[{key:'__getChildContext__REACT_HOT_LOADER__',value:function __getChildContext__REACT_HOT_LOADER__(){return this.__getChildContext__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__getChildContext__REACT_HOT_LOADER__',value:function __getChildContext__REACT_HOT_LOADER__(){return{state:this.state,methods:{handleChange:this.handleChange,handleBlur:this.handleBlur,handleFocus:this.handleFocus,handleRecaptchaChange:this.handleRecaptchaChange}}}},{key:'___createNewFormFieldOnState__REACT_HOT_LOADER__',value:function ___createNewFormFieldOnState__REACT_HOT_LOADER__(){return this.___createNewFormFieldOnState__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'___createNewFormFieldOnState__REACT_HOT_LOADER__',value:function ___createNewFormFieldOnState__REACT_HOT_LOADER__(field){var _this2=this;var fields=this.state.fields;var fieldNames=this.state.fieldNames;var obj={};for(var key in field){if(field.hasOwnProperty(key)){obj[key]=field[key]}}obj.reason=field.reason||'';obj.errorType=field.errorType||'';obj.value=field.value||'';obj.validations=field.validations||[];obj.blurred=field.blurred||true;obj.focused=field.focused||false;obj.firstBlur=field.firstBlur||false;obj.hideReactiveUntilFirstBlur=field.firstBlur||false;obj.defaultErrorMessage=field.defaultErrorMessage||'';fields[field.fieldName]=obj;fieldNames.push(field.fieldName);field.validations.forEach(function(v){return _this2.state.validations.push(v)});this.state.fields=fields;this.state.fieldNames=fieldNames}},{key:'__addFieldOrFormError__REACT_HOT_LOADER__',value:function __addFieldOrFormError__REACT_HOT_LOADER__(){return this.__addFieldOrFormError__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__addFieldOrFormError__REACT_HOT_LOADER__',value:function __addFieldOrFormError__REACT_HOT_LOADER__(err){if(this.state.fieldNames.includes(err.error)){var fields=this.state.fields;fields[err.error].reason=err.reason;this.setState({fields:fields})}else{this.setState({errorMessage:err.reason})}}},{key:'__checkFormStage__REACT_HOT_LOADER__',value:function __checkFormStage__REACT_HOT_LOADER__(){return this.__checkFormStage__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__checkFormStage__REACT_HOT_LOADER__',value:function __checkFormStage__REACT_HOT_LOADER__(){var _this3=this;this.setState({stage:'valid'});if(this.state.errorMessage){this.setState({stage:'invalid'})}else{this.state.fieldNames.forEach(function(f){if(H.fieldIsInvalid(_this3.state.fields[f])){_this3.setState({stage:'invalid'})}})}if(this.state.recaptchaForm&&!this.state.recaptchaToken){this.setState({stage:'invalid'})}}},{key:'__handleChange__REACT_HOT_LOADER__',value:function __handleChange__REACT_HOT_LOADER__(){return this.__handleChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleChange__REACT_HOT_LOADER__',value:function __handleChange__REACT_HOT_LOADER__(fieldName,event){var _this4=this;this.setState({errorMessage:''});var fields=this.state.fields;var field=fields[fieldName];field.value=event.target.value;field.touched=true;if(field.validations){field.validations.forEach(function(v){if(typeof v=='function'){field=v(_this4.state,fieldName)}})}fields[fieldName]=field;this.setState({fields:fields});this.checkFormStage()}},{key:'__handleRecaptchaChange__REACT_HOT_LOADER__',value:function __handleRecaptchaChange__REACT_HOT_LOADER__(){return this.__handleRecaptchaChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleRecaptchaChange__REACT_HOT_LOADER__',value:function __handleRecaptchaChange__REACT_HOT_LOADER__(recaptchaToken){this.setState({recaptchaToken:recaptchaToken});this.checkFormStage()}},{key:'__handleBlur__REACT_HOT_LOADER__',value:function __handleBlur__REACT_HOT_LOADER__(){return this.__handleBlur__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleBlur__REACT_HOT_LOADER__',value:function __handleBlur__REACT_HOT_LOADER__(fieldName,event){var fields=this.state.fields;var field=fields[fieldName];field.firstBlur=true;field.blurred=true;field.focused=false;fields[fieldName]=field;this.setState({fields:fields})}},{key:'__handleFocus__REACT_HOT_LOADER__',value:function __handleFocus__REACT_HOT_LOADER__(){return this.__handleFocus__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleFocus__REACT_HOT_LOADER__',value:function __handleFocus__REACT_HOT_LOADER__(fieldName,event){var fields=this.state.fields;var field=fields[fieldName];field.blurred=false;field.focused=true;fields[fieldName]=field;this.setState({fields:fields})}},{key:'__handleFormSubmit__REACT_HOT_LOADER__',value:function __handleFormSubmit__REACT_HOT_LOADER__(){return this.__handleFormSubmit__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleFormSubmit__REACT_HOT_LOADER__',value:function __handleFormSubmit__REACT_HOT_LOADER__(event){event.preventDefault();this.setState({stage:'waiting',errorMessage:''})}},{key:'__pauseHandleFormSubmit__REACT_HOT_LOADER__',value:function __pauseHandleFormSubmit__REACT_HOT_LOADER__(){return this.__pauseHandleFormSubmit__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__pauseHandleFormSubmit__REACT_HOT_LOADER__',value:function __pauseHandleFormSubmit__REACT_HOT_LOADER__(event){var _this5=this;event.preventDefault();this.setState({stage:'waiting'});setTimeout(function(){return _this5.handleFormSubmit(event)},this.props.simulateLongResponse)}},{key:'__render__REACT_HOT_LOADER__',value:function __render__REACT_HOT_LOADER__(){return this.__render__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__render__REACT_HOT_LOADER__',value:function __render__REACT_HOT_LOADER__(){return _react2.default.createElement('form',{onSubmit:this.props.simulateLongResponse?this.pauseHandleFormSubmit:this.handleFormSubmit,__source:{fileName:_jsxFileName,lineNumber:252}},this.props.children)}}]);return ReactiveForm}(_react2.default.Component),_class.propTypes={onSubmit:_react2.default.PropTypes.string,hideAllReactiveOnFocus:_react2.default.PropTypes.bool,hideAllReactiveUntilFirstBlur:_react2.default.PropTypes.bool,simulateLongResponse:_react2.default.PropTypes.number,delayAllErrorMessages:_react2.default.PropTypes.number},_class.childContextTypes={state:_react2.default.PropTypes.object,methods:_react2.default.PropTypes.object},_temp);;var _temp2=function(){if(typeof __REACT_HOT_LOADER__==='undefined'){return}__REACT_HOT_LOADER__.register(ReactiveForm,'ReactiveForm','core/modules/everlib_react_forms/reactive_form.jsx')}();;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlYWN0aXZlX2Zvcm0uanN4Il0sIm5hbWVzIjpbIkgiLCJSZWFjdGl2ZUZvcm0iLCJwcm9wcyIsImdldENoaWxkQ29udGV4dCIsIl9jcmVhdGVOZXdGb3JtRmllbGRPblN0YXRlIiwiYWRkRmllbGRPckZvcm1FcnJvciIsImNoZWNrRm9ybVN0YWdlIiwiaGFuZGxlQ2hhbmdlIiwiaGFuZGxlUmVjYXB0Y2hhQ2hhbmdlIiwiaGFuZGxlQmx1ciIsImhhbmRsZUZvY3VzIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInBhdXNlSGFuZGxlRm9ybVN1Ym1pdCIsInJlbmRlciIsImhpZGVBbGxSZWFjdGl2ZU9uRm9jdXMiLCJoaWRlQWxsUmVhY3RpdmVVbnRpbEZpcnN0Qmx1ciIsIkVycm9yIiwic2ltdWxhdGVMb25nUmVzcG9uc2UiLCJjb25zb2xlIiwid2FybiIsInN0YXRlIiwiZGVsYXlBbGxFcnJvck1lc3NhZ2VzIiwibWFwRm9ybUZpZWxkc1RvU3RhdGUiLCJjaGlsZHJlbiIsIkNoaWxkcmVuIiwiZm9yRWFjaCIsImMiLCJpc1ZhbGlkRWxlbWVudCIsInR5cGUiLCJuYW1lIiwiaW5jbHVkZXMiLCJyZWNhcHRjaGFGb3JtIiwibWV0aG9kcyIsImZpZWxkIiwiZmllbGRzIiwiZmllbGROYW1lcyIsIm9iaiIsImtleSIsImhhc093blByb3BlcnR5IiwicmVhc29uIiwiZXJyb3JUeXBlIiwidmFsdWUiLCJ2YWxpZGF0aW9ucyIsImJsdXJyZWQiLCJmb2N1c2VkIiwiZmlyc3RCbHVyIiwiaGlkZVJlYWN0aXZlVW50aWxGaXJzdEJsdXIiLCJkZWZhdWx0RXJyb3JNZXNzYWdlIiwiZmllbGROYW1lIiwicHVzaCIsInYiLCJlcnIiLCJlcnJvciIsInNldFN0YXRlIiwiZXJyb3JNZXNzYWdlIiwic3RhZ2UiLCJmaWVsZElzSW52YWxpZCIsImYiLCJyZWNhcHRjaGFUb2tlbiIsImV2ZW50IiwidGFyZ2V0IiwidG91Y2hlZCIsInByZXZlbnREZWZhdWx0Iiwic2V0VGltZW91dCIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsIm9uU3VibWl0IiwiUHJvcFR5cGVzIiwic3RyaW5nIiwiYm9vbCIsIm51bWJlciIsImNoaWxkQ29udGV4dFR5cGVzIiwib2JqZWN0Il0sIm1hcHBpbmdzIjoicXpCQU9BLDRCLDJDQUNBLG1DLEdBQVlBLEUsK1ZBT0NDLGEsU0FBQUEsWSxnR0FlWCxzQkFBWUMsS0FBWixDQUFtQix1TEFDWEEsS0FEVyxTQWtEbkJDLGVBbERtQiw2RkFnRW5CQywwQkFoRW1CLHdHQW9HbkJDLG1CQXBHbUIsaUdBaUhuQkMsY0FqSG1CLDRGQWdKbkJDLFlBaEptQiwwRkFvS25CQyxxQkFwS21CLG1HQXlLbkJDLFVBekttQix3RkFtTG5CQyxXQW5MbUIseUZBNExuQkMsZ0JBNUxtQiw4RkFvTm5CQyxxQkFwTm1CLG1HQTJObkJDLE1BM05tQiw4RUFJakIsR0FBSVgsTUFBTVksc0JBQU4sRUFBZ0NaLE1BQU1hLDZCQUExQyxDQUF5RSxDQUN2RSxLQUFNLElBQUlDLE1BQUosQ0FBVSw4RUFBVixDQUNQLENBRUQsR0FBSWQsTUFBTWUsb0JBQVYsQ0FBZ0MsQ0FDOUJDLFFBQVFDLElBQVIsQ0FBYSw2Q0FBYixDQUNELENBR0QsTUFBS0MsS0FBTCxDQUFhLENBQ1gsUUFBUyxTQURFLENBRVgseUJBQTBCbEIsTUFBTVksc0JBQU4sRUFBZ0MsS0FGL0MsQ0FHWCxnQ0FBaUNaLE1BQU1hLDZCQUFOLEVBQXVDLEtBSDdELENBSVgsd0JBQXlCYixNQUFNbUIscUJBQU4sRUFBK0IsQ0FKN0MsQ0FLWCxlQUFnQixFQUxMLENBTVgsVUFBVyxLQU5BLENBT1gsYUFBYyxFQVBILENBUVgsU0FBVSxFQVJDLENBU1gsY0FBZSxFQVRKLENBVVgsZ0JBQWlCLEtBVk4sQ0FXWCxpQkFBa0IsRUFYUCxDQVlYLHVCQUF3Qm5CLE1BQU1lLG9CQUFOLEVBQThCLEtBWjNDLENBQWIsQ0FnQkEsTUFBS0ssb0JBQUwsQ0FBNEIsU0FBQ0MsUUFBRCxDQUFjLENBQ3hDLGdCQUFNQyxRQUFOLENBQWVDLE9BQWYsQ0FB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ZUQsQyxnVEFPd0JLLEssQ0FBVSxpQkFDakNBLE1BQU1HLGNBQU4sR0FDQSxLQUFLVCxRQUFMLENBQWMsQ0FBRUUsTUFBTyxTQUFULENBQWQsRUFDQVEsV0FBVyxpQkFBTSxRQUFLcEQsZ0JBQUwsQ0FBc0JnRCxLQUF0QixDQUFOLENBQVgsQ0FDRSxLQUFLekQsS0FBTCxDQUFXZSxvQkFEYixDQUVELEMsc09BRWMsQ0FDYixNQUNFLHVDQUNFLFNBQVcsS0FBS2YsS0FBTCxDQUFXZSxvQkFBWixDQUFvQyxLQUFLTCxxQkFBekMsQ0FBaUUsS0FBS0QsZ0JBRGxGLGtEQUVHLEtBQUtULEtBQUwsQ0FBV3FCLFFBRmQsQ0FLSCxDLHlCQWpQK0IsZ0JBQU15QyxTLFNBRS9CQyxTLENBQVksQ0FDakJDLFNBQVUsZ0JBQU1DLFNBQU4sQ0FBZ0JDLE1BRFQsQ0FFakJ0RCx1QkFBd0IsZ0JBQU1xRCxTQUFOLENBQWdCRSxJQUZ2QixDQUdqQnRELDhCQUErQixnQkFBTW9ELFNBQU4sQ0FBZ0JFLElBSDlCLENBSWpCcEQscUJBQXNCLGdCQUFNa0QsU0FBTixDQUFnQkcsTUFKckIsQ0FLakJqRCxzQkFBdUIsZ0JBQU04QyxTQUFOLENBQWdCRyxNQUx0QixDLFFBUVpDLGlCLENBQW9CLENBQ3pCbkQsTUFBTyxnQkFBTStDLFNBQU4sQ0FBZ0JLLE1BREUsQ0FFekJ4QyxRQUFTLGdCQUFNbUMsU0FBTixDQUFnQkssTUFGQSxDLGtIQVZoQnZFLFkiLCJmaWxlIjoicmVhY3RpdmVfZm9ybS5qc3giLCJzb3VyY2VSb290IjoiL1VzZXJzL3RvbnluZ3V5ZW4vUHJvamVjdHMvY29kZWZvcmFwcHMvdG9vbHMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEV2ZXJsaWIgUmVhY3QgRm9ybSBjb21wb25lbnRzIGFuZCBoZWxwZXJzXG4gKlxuICogQXV0aG9yOiBOYXRoYW4gQnJhZHlcbiAqIENyZWF0ZWQ6IDA2LzA2LzIwMTZcbiAqL1xuXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0ICogYXMgSCBmcm9tICcuL19oZWxwZXJzJztcblxuLyoqXG4gKiBUaGlzIGlzIG91ciB3cmFwcGVyIGZvciB0aGUgUmVhY3RpdmVGb3JtLiBJdCB3aWxsIGhhbmRsZVxuICogdGhlIGJhc2UgY2FzZSBmb3IgZm9ybSBldmVudHMuXG4gKi9cblxuZXhwb3J0IGNsYXNzIFJlYWN0aXZlRm9ybSBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBvblN1Ym1pdDogUmVhY3QuUHJvcFR5cGVzLnN0cmluZyxcbiAgICBoaWRlQWxsUmVhY3RpdmVPbkZvY3VzOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICBoaWRlQWxsUmVhY3RpdmVVbnRpbEZpcnN0Qmx1cjogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgc2ltdWxhdGVMb25nUmVzcG9uc2U6IFJlYWN0LlByb3BUeXBlcy5udW1iZXIsXG4gICAgZGVsYXlBbGxFcnJvck1lc3NhZ2VzOiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyXG4gIH07XG5cbiAgc3RhdGljIGNoaWxkQ29udGV4dFR5cGVzID0ge1xuICAgIHN0YXRlOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0LFxuICAgIG1ldGhvZHM6IFJlYWN0LlByb3BUeXBlcy5vYmplY3RcbiAgfTtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIC8vIENoZWNrIHByb3BzIGZvciBlcnJvcnMgYW5kIHdhcm5pbmdzXG4gICAgaWYgKHByb3BzLmhpZGVBbGxSZWFjdGl2ZU9uRm9jdXMgJiYgcHJvcHMuaGlkZUFsbFJlYWN0aXZlVW50aWxGaXJzdEJsdXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBzZXQgaGlkZUFsbFJlYWN0aXZlT25Gb2N1cyBhbmQgaGlkZUFsbFJlYWN0aXZlVW50aWxGaXJzdEJsdXIgdG8gdHJ1ZS5cIik7XG4gICAgfVxuICAgIC8vIFdhcm4gYWJvdXQgc2ltdWxhdGlvblxuICAgIGlmIChwcm9wcy5zaW11bGF0ZUxvbmdSZXNwb25zZSkge1xuICAgICAgY29uc29sZS53YXJuKFwiU2ltdWxhdGluZyBhIGxvbmcgcmVzcG9uc2UgZnJvbSB0aGUgc2VydmVyLlwiKTtcbiAgICB9XG5cbiAgICAvLyBFeHBsaWNpdGVseSBzZXQgYm9vbGVhbiBwcm9wcyB0byBmYWxzZSwgaW5zdGVhZCBvZiAnZmFsc2V5JyB2YWx1ZVxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAnc3RhZ2UnOiAnbmV1dHJhbCcsXG4gICAgICAnaGlkZUFsbFJlYWN0aXZlT25Gb2N1cyc6IHByb3BzLmhpZGVBbGxSZWFjdGl2ZU9uRm9jdXMgfHwgZmFsc2UsXG4gICAgICAnaGlkZUFsbFJlYWN0aXZlVW50aWxGaXJzdEJsdXInOiBwcm9wcy5oaWRlQWxsUmVhY3RpdmVVbnRpbEZpcnN0Qmx1ciB8fCBmYWxzZSxcbiAgICAgICdkZWxheUFsbEVycm9yTWVzc2FnZXMnOiBwcm9wcy5kZWxheUFsbEVycm9yTWVzc2FnZXMgfHwgMCxcbiAgICAgICdlcnJvck1lc3NhZ2UnOiAnJyxcbiAgICAgICdzdWNjZXNzJzogZmFsc2UsXG4gICAgICAnZmllbGROYW1lcyc6IFtdLFxuICAgICAgJ2ZpZWxkcyc6IHt9LFxuICAgICAgJ3ZhbGlkYXRpb25zJzogW10sXG4gICAgICAncmVjYXB0Y2hhRm9ybSc6IGZhbHNlLFxuICAgICAgJ3JlY2FwdGNoYVRva2VuJzogJycsXG4gICAgICAnc2ltdWxhdGVMb25nUmVzcG9uc2UnOiBwcm9wcy5zaW11bGF0ZUxvbmdSZXNwb25zZSB8fCBmYWxzZVxuICAgIH07XG5cbiAgICAvLyBTZXQgdXAgaW5pdGlhbCBmb3JtIHN0YXRlXG4gICAgdGhpcy5tYXBGb3JtRmllbGRzVG9TdGF0ZSA9IChjaGlsZHJlbikgPT4ge1xuICAgICAgUmVhY3QuQ2hpbGRyZW4uZm9yRWFjaChjaGlsZHJlbiwgKGMpID0+IHtcbiAgICAgICAgaWYgKFJlYWN0LmlzVmFsaWRFbGVtZW50KGMpKSB7XG4gICAgICAgICAgaWYgKGMudHlwZSAmJiBjLnR5cGUubmFtZSAmJlxuICAgICAgICAgICAgW1wiUmVhY3RpdmVJbnB1dFwiLCBcIlJlYWN0aXZlVGV4dGFyZWFcIl0uaW5jbHVkZXMoYy50eXBlLm5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLl9jcmVhdGVOZXdGb3JtRmllbGRPblN0YXRlKGMucHJvcHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoYy50eXBlICYmIGMudHlwZS5uYW1lICYmIGMudHlwZS5uYW1lID09PSBcIlJlYWN0aXZlQ2FwdGNoYVwiKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXRlLnJlY2FwdGNoYUZvcm0gPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoYy5wcm9wcy5jaGlsZHJlbikge1xuICAgICAgICAgICAgdGhpcy5tYXBGb3JtRmllbGRzVG9TdGF0ZShjLnByb3BzLmNoaWxkcmVuKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH07XG4gICAgdGhpcy5tYXBGb3JtRmllbGRzVG9TdGF0ZShwcm9wcy5jaGlsZHJlbik7XG5cbiAgfVxuXG4gIC8vIEF0dGFjaCBzdGF0ZSBhbmQgbWV0aG9kcyB0aGF0IG5lZWQgdG8gYmUgcGFzc2VkIHRvIGFsbCBjaGlsZHJlblxuICBnZXRDaGlsZENvbnRleHQgPSAoKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgbWV0aG9kczoge1xuICAgICAgICBoYW5kbGVDaGFuZ2U6IHRoaXMuaGFuZGxlQ2hhbmdlLFxuICAgICAgICBoYW5kbGVCbHVyOiB0aGlzLmhhbmRsZUJsdXIsXG4gICAgICAgIGhhbmRsZUZvY3VzOiB0aGlzLmhhbmRsZUZvY3VzLFxuICAgICAgICBoYW5kbGVSZWNhcHRjaGFDaGFuZ2U6IHRoaXMuaGFuZGxlUmVjYXB0Y2hhQ2hhbmdlXG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICAvLyBBbnkgbWV0aG9kIHRoYXQgaXMgY2FsbGVkIGJ5IHRoZSBjb25zdHJ1Y3RvciBhbmQgc2hvdWxkIG9ubHlcbiAgLy8gYmUgdXNlZCB3aXRoaW4gdGhlIGNvbnN0cnVjdG9yIGlzIHByZWZhY2VkIHdpdGggYW4gX1xuICBfY3JlYXRlTmV3Rm9ybUZpZWxkT25TdGF0ZSA9IChmaWVsZCkgPT4ge1xuICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuc3RhdGUuZmllbGRzO1xuICAgIGNvbnN0IGZpZWxkTmFtZXMgPSB0aGlzLnN0YXRlLmZpZWxkTmFtZXM7XG5cbiAgICAvLyBjb3B5IHRoZSBmcm96ZW4gcHJvcHMgb2JqZWN0XG4gICAgbGV0IG9iaiA9IHt9O1xuICAgIGZvciAobGV0IGtleSBpbiBmaWVsZCkge1xuICAgICAgaWYgKGZpZWxkLmhhc093blByb3BlcnR5KGtleSkpIHtcbiAgICAgICAgb2JqW2tleV0gPSBmaWVsZFtrZXldO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHVwZGF0ZSBzb21lIGRlZmF1bHRzXG4gICAgb2JqLnJlYXNvbiA9IGZpZWxkLnJlYXNvbiB8fCAnJztcbiAgICBvYmouZXJyb3JUeXBlID0gZmllbGQuZXJyb3JUeXBlIHx8ICcnO1xuICAgIG9iai52YWx1ZSA9IGZpZWxkLnZhbHVlIHx8ICcnO1xuICAgIG9iai52YWxpZGF0aW9ucyA9IGZpZWxkLnZhbGlkYXRpb25zIHx8IFtdO1xuICAgIG9iai5ibHVycmVkID0gZmllbGQuYmx1cnJlZCB8fCB0cnVlO1xuICAgIG9iai5mb2N1c2VkID0gZmllbGQuZm9jdXNlZCB8fCBmYWxzZTtcbiAgICBvYmouZmlyc3RCbHVyID0gZmllbGQuZmlyc3RCbHVyIHx8IGZhbHNlO1xuICAgIG9iai5oaWRlUmVhY3RpdmVVbnRpbEZpcnN0Qmx1ciA9IGZpZWxkLmZpcnN0Qmx1ciB8fCBmYWxzZTtcbiAgICBvYmouZGVmYXVsdEVycm9yTWVzc2FnZSA9IGZpZWxkLmRlZmF1bHRFcnJvck1lc3NhZ2UgfHwgJyc7XG5cbiAgICAvLyBhZGQgdGhlIG5ldyBwcm9wcyBvYmplY3RcbiAgICBmaWVsZHNbZmllbGQuZmllbGROYW1lXSA9IG9iajtcblxuICAgIC8vIGFkZCB0aGUgZmllbGROYW1lcyB0byB0aGUgdG9wIGxpc3RcbiAgICBmaWVsZE5hbWVzLnB1c2goZmllbGQuZmllbGROYW1lKTtcbiAgICAvLyBhZGQgdGhlIHZhbGlkYXRpb25zIHRvIHRoZSB0b3AgbGlzdFxuICAgIGZpZWxkLnZhbGlkYXRpb25zLmZvckVhY2godiA9PlxuICAgICAgdGhpcy5zdGF0ZS52YWxpZGF0aW9ucy5wdXNoKHYpKTtcblxuICAgIHRoaXMuc3RhdGUuZmllbGRzID0gZmllbGRzO1xuICAgIHRoaXMuc3RhdGUuZmllbGROYW1lcyA9IGZpZWxkTmFtZXM7XG4gIH07XG5cbiAgYWRkRmllbGRPckZvcm1FcnJvciA9IChlcnIpID0+IHtcbiAgICBpZiAodGhpcy5zdGF0ZS5maWVsZE5hbWVzLmluY2x1ZGVzKGVyci5lcnJvcikpIHtcbiAgICAgIGxldCBmaWVsZHMgPSB0aGlzLnN0YXRlLmZpZWxkcztcbiAgICAgIGZpZWxkc1tlcnIuZXJyb3JdLnJlYXNvbiA9IGVyci5yZWFzb247XG4gICAgICB0aGlzLnNldFN0YXRlKHsgZmllbGRzIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3JNZXNzYWdlOiBlcnIucmVhc29uIH0pO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogQ2hlY2tzIHdoZXRoZXIgb3Igbm90IHRoZSBmb3JtIGlzIHZhbGlkXG4gICAqL1xuICBjaGVja0Zvcm1TdGFnZSA9ICgpID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHsgc3RhZ2U6ICd2YWxpZCcgfSk7XG4gICAgaWYgKHRoaXMuc3RhdGUuZXJyb3JNZXNzYWdlKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgc3RhZ2U6ICdpbnZhbGlkJyB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdGF0ZS5maWVsZE5hbWVzLmZvckVhY2goZiA9PiB7XG4gICAgICAgIGlmIChILmZpZWxkSXNJbnZhbGlkKHRoaXMuc3RhdGUuZmllbGRzW2ZdKSkge1xuICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzdGFnZTogJ2ludmFsaWQnIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gSWYgZm9ybSBoYXMgYSByZWNhcHRjaGEgYnV0IG5vIHRva2VuLCBpdCdzIG5vdCByZWFkeVxuICAgIGlmICh0aGlzLnN0YXRlLnJlY2FwdGNoYUZvcm0gJiYgIXRoaXMuc3RhdGUucmVjYXB0Y2hhVG9rZW4pIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBzdGFnZTogJ2ludmFsaWQnIH0pO1xuICAgIH1cbiAgfTtcblxuICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICAgKiBTZXR0aW5nIHVwIG91ciBsb2NhbCBldmVudCBoYW5kbGVyc1xuICAgKlxuICAgKi9cblxuICAvKipcbiAgICogRm9yIG5vdyBldmVyeSBSZWFjdGl2ZUlucHV0IGZpZWxkIHdpbGwgZmxvdyB0aHJvdWdoIHRoaXMgaGFuZGxlQ2hhbmdlXG4gICAqIGV2ZW50IGhhbmRsZXIuIFRoaXMgd2lsbCBhbHNvIHByb2Nlc3MgYW55IHZhbGlkYXRpb24gaG9va3MgcGFzc2VkIGluIHRoZVxuICAgKiBhcnJheSBvZiBwcm9wcy4gRnVuY3Rpb25zIHBhc3NlZCBpbiB3aWxsIGJlIHRyZWF0ZWQgYXMgc3VjaCwgd2hpbGUgc3RyaW5nc1xuICAgKiBwYXNzZWQgaW4gdG8gdGhlIGFycmF5IG9mIHZhbGlkYXRpb25zIGFyZSB0byBiZSB0cmVhdGVkIGFzIG1ldGVvciBtZXRob2RzLlxuICAgKlxuICAgKiBAcGFyYW0gZmllbGROYW1lIC0gTmFtZSBvZiB0aGUgZmllbGQgd2UncmUgdGFyZ2V0aW5nXG4gICAqIEBwYXJhbSBldmVudCAtIHRoZSBjaGFuZ2UgZXZlbnQgUGFzc2VkIGluIGF1dG9tYXRpY2FsbHlcbiAgICovXG4gIGhhbmRsZUNoYW5nZSA9IChmaWVsZE5hbWUsIGV2ZW50KSA9PiB7XG4gICAgLy8gUmVzZXQgdGhlIG1ham9yIGZvcm0gZXJyb3Igb24gYW55IGNoYW5nZVxuICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvck1lc3NhZ2U6ICcnIH0pO1xuICAgIGxldCBmaWVsZHMgPSB0aGlzLnN0YXRlLmZpZWxkcztcbiAgICBsZXQgZmllbGQgPSBmaWVsZHNbZmllbGROYW1lXTtcbiAgICBmaWVsZC52YWx1ZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICBmaWVsZC50b3VjaGVkID0gdHJ1ZTtcblxuICAgIGlmIChmaWVsZC52YWxpZGF0aW9ucykge1xuICAgICAgZmllbGQudmFsaWRhdGlvbnMuZm9yRWFjaCh2ID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiB2ID09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICBmaWVsZCA9IHYodGhpcy5zdGF0ZSwgZmllbGROYW1lKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGZpZWxkc1tmaWVsZE5hbWVdID0gZmllbGQ7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGZpZWxkcyB9KTtcbiAgICB0aGlzLmNoZWNrRm9ybVN0YWdlKCk7XG4gIH07XG5cbiAgaGFuZGxlUmVjYXB0Y2hhQ2hhbmdlID0gKHJlY2FwdGNoYVRva2VuKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHJlY2FwdGNoYVRva2VuIH0pO1xuICAgIHRoaXMuY2hlY2tGb3JtU3RhZ2UoKTtcbiAgfTtcblxuICBoYW5kbGVCbHVyID0gKGZpZWxkTmFtZSwgZXZlbnQpID0+IHtcbiAgICBjb25zdCBmaWVsZHMgPSB0aGlzLnN0YXRlLmZpZWxkcztcbiAgICBjb25zdCBmaWVsZCA9IGZpZWxkc1tmaWVsZE5hbWVdO1xuICAgIGZpZWxkLmZpcnN0Qmx1ciA9IHRydWU7XG4gICAgZmllbGQuYmx1cnJlZCA9IHRydWU7XG4gICAgZmllbGQuZm9jdXNlZCA9IGZhbHNlO1xuICAgIGZpZWxkc1tmaWVsZE5hbWVdID0gZmllbGQ7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGZpZWxkcyB9KTtcbiAgfTtcblxuICBoYW5kbGVGb2N1cyA9IChmaWVsZE5hbWUsIGV2ZW50KSA9PiB7XG4gICAgY29uc3QgZmllbGRzID0gdGhpcy5zdGF0ZS5maWVsZHM7XG4gICAgY29uc3QgZmllbGQgPSBmaWVsZHNbZmllbGROYW1lXTtcbiAgICBmaWVsZC5ibHVycmVkID0gZmFsc2U7XG4gICAgZmllbGQuZm9jdXNlZCA9IHRydWU7XG4gICAgZmllbGRzW2ZpZWxkTmFtZV0gPSBmaWVsZDtcbiAgICB0aGlzLnNldFN0YXRlKHsgZmllbGRzIH0pO1xuICB9O1xuXG4gIGhhbmRsZUZvcm1TdWJtaXQgPSAoZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzdGFnZTogJ3dhaXRpbmcnLCBlcnJvck1lc3NhZ2U6ICcnIH0pO1xuICAgIC8vIFRPRE86IEhBTkRMRSBGT1JNIFNVQk1JU1NJT05cbiAgICAvLyBNZXRlb3IuY2FsbCh0aGlzLnByb3BzLm9uU3VibWl0LCB0aGlzLnN0YXRlLCAoZXJyLCByZXMpID0+IHtcbiAgICAvLyAgIGlmIChlcnIpIHtcbiAgICAvLyAgICAgdGhpcy5hZGRGaWVsZE9yRm9ybUVycm9yKGVycik7XG4gICAgLy8gICB9IGVsc2Uge1xuICAgIC8vICAgICAvLyBkbyB0aGUgb24gc3VjY2VzcyBzdHVmZlxuICAgIC8vICAgICB0aGlzLnByb3BzLm9uU3VjY2Vzcyh0aGlzLnN0YXRlLCAoZXJyLCBkZWZhdWx0TXNnID0gJycpID0+IHtcbiAgICAvLyAgICAgICBpZiAoZXJyKSB7XG4gICAgLy8gICAgICAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3JNZXNzYWdlOiBkZWZhdWx0TXNnIHx8IGVyci5yZWFzb24gfSk7XG4gICAgLy8gICAgICAgfVxuICAgIC8vICAgICB9KTtcbiAgICAvLyAgIH1cbiAgICAvLyAgIHRoaXMuY2hlY2tGb3JtU3RhZ2UoKTtcbiAgICAvLyB9KTtcbiAgfTtcblxuICAvKipcbiAgICogSWYgc2ltdWxhdGVMb25nUmVzcG9uc2UgaXMgYWN0aXZlLCB0aGlzIHdpbGwgcGF1c2UgZXhlY3V0aW9uIG9mXG4gICAqIGhhbmRsZUZvcm1TdWJtaXRcbiAgICogQHBhcmFtIGV2ZW50XG4gICAqL1xuICBwYXVzZUhhbmRsZUZvcm1TdWJtaXQgPSAoZXZlbnQpID0+IHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzdGFnZTogJ3dhaXRpbmcnIH0pO1xuICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5oYW5kbGVGb3JtU3VibWl0KGV2ZW50KSxcbiAgICAgIHRoaXMucHJvcHMuc2ltdWxhdGVMb25nUmVzcG9uc2UpO1xuICB9O1xuXG4gIHJlbmRlciA9ICgpID0+IHtcbiAgICByZXR1cm4gKFxuICAgICAgPGZvcm1cbiAgICAgICAgb25TdWJtaXQ9eyh0aGlzLnByb3BzLnNpbXVsYXRlTG9uZ1Jlc3BvbnNlKSA/IHRoaXMucGF1c2VIYW5kbGVGb3JtU3VibWl0IDogdGhpcy5oYW5kbGVGb3JtU3VibWl0fT5cbiAgICAgICAge3RoaXMucHJvcHMuY2hpbGRyZW59XG4gICAgICA8L2Zvcm0+XG4gICAgKVxuICB9O1xufSJdfQ==