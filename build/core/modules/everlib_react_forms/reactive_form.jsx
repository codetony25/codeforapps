'use strict';exports.__esModule=true;exports.ReactiveForm=undefined;var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _class,_temp,_jsxFileName='core/modules/everlib_react_forms/reactive_form.jsx';var _react=require('react');var _react2=_interopRequireDefault(_react);var _helpers=require('./_helpers');var H=_interopRequireWildcard(_helpers);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactiveForm=exports.ReactiveForm=(_temp=_class=function(_React$Component){(0,_inherits3.default)(ReactiveForm,_React$Component);function ReactiveForm(props){(0,_classCallCheck3.default)(this,ReactiveForm);var _this=(0,_possibleConstructorReturn3.default)(this,(ReactiveForm.__proto__||(0,_getPrototypeOf2.default)(ReactiveForm)).call(this,props));_this.getChildContext=function(){return _this.__getChildContext__REACT_HOT_LOADER__.apply(_this,arguments)};_this._createNewFormFieldOnState=function(){return _this.___createNewFormFieldOnState__REACT_HOT_LOADER__.apply(_this,arguments)};_this.addFieldOrFormError=function(){return _this.__addFieldOrFormError__REACT_HOT_LOADER__.apply(_this,arguments)};_this.checkFormStage=function(){return _this.__checkFormStage__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleChange=function(){return _this.__handleChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleRecaptchaChange=function(){return _this.__handleRecaptchaChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleBlur=function(){return _this.__handleBlur__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleFocus=function(){return _this.__handleFocus__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleFormSubmit=function(){return _this.__handleFormSubmit__REACT_HOT_LOADER__.apply(_this,arguments)};_this.pauseHandleFormSubmit=function(){return _this.__pauseHandleFormSubmit__REACT_HOT_LOADER__.apply(_this,arguments)};_this.render=function(){return _this.__render__REACT_HOT_LOADER__.apply(_this,arguments)};if(props.hideAllReactiveOnFocus&&props.hideAllReactiveUntilFirstBlur){throw new Error('Cannot set hideAllReactiveOnFocus and hideAllReactiveUntilFirstBlur to true.')}if(props.simulateLongResponse){console.warn('Simulating a long response from the server.')}_this.state={'stage':'neutral','hideAllReactiveOnFocus':props.hideAllReactiveOnFocus||false,'hideAllReactiveUntilFirstBlur':props.hideAllReactiveUntilFirstBlur||false,'delayAllErrorMessages':props.delayAllErrorMessages||0,'errorMessage':'','success':false,'fieldNames':[],'fields':{},'validations':[],'recaptchaForm':false,'recaptchaToken':'','simulateLongResponse':props.simulateLongResponse||false};_this.mapFormFieldsToState=function(children){_react2.default.Children.forEach(children,function(c){if(_react2.default.isValidElement(c)){if(c.type&&c.type.name&&['ReactiveInput','ReactiveTextarea'].includes(c.type.name)){_this._createNewFormFieldOnState(c.props)}if(c.type&&c.type.name&&c.type.name==='ReactiveCaptcha'){_this.state.recaptchaForm=true}if(c.props.children){_this.mapFormFieldsToState(c.props.children)}}})};_this.mapFormFieldsToState(props.children);return _this}(0,_createClass3.default)(ReactiveForm,[{key:'__getChildContext__REACT_HOT_LOADER__',value:function __getChildContext__REACT_HOT_LOADER__(){return this.__getChildContext__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__getChildContext__REACT_HOT_LOADER__',value:function __getChildContext__REACT_HOT_LOADER__(){return{state:this.state,methods:{handleChange:this.handleChange,handleBlur:this.handleBlur,handleFocus:this.handleFocus,handleRecaptchaChange:this.handleRecaptchaChange}}}},{key:'___createNewFormFieldOnState__REACT_HOT_LOADER__',value:function ___createNewFormFieldOnState__REACT_HOT_LOADER__(){return this.___createNewFormFieldOnState__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'___createNewFormFieldOnState__REACT_HOT_LOADER__',value:function ___createNewFormFieldOnState__REACT_HOT_LOADER__(field){var _this2=this;var fields=this.state.fields;var fieldNames=this.state.fieldNames;var obj={};for(var key in field){if(field.hasOwnProperty(key)){obj[key]=field[key]}}obj.reason=field.reason||'';obj.errorType=field.errorType||'';obj.value=field.value||'';obj.validations=field.validations||[];obj.blurred=field.blurred||true;obj.focused=field.focused||false;obj.firstBlur=field.firstBlur||false;obj.hideReactiveUntilFirstBlur=field.firstBlur||false;obj.defaultErrorMessage=field.defaultErrorMessage||'';fields[field.fieldName]=obj;fieldNames.push(field.fieldName);field.validations.forEach(function(v){return _this2.state.validations.push(v)});this.state.fields=fields;this.state.fieldNames=fieldNames}},{key:'__addFieldOrFormError__REACT_HOT_LOADER__',value:function __addFieldOrFormError__REACT_HOT_LOADER__(){return this.__addFieldOrFormError__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__addFieldOrFormError__REACT_HOT_LOADER__',value:function __addFieldOrFormError__REACT_HOT_LOADER__(err){if(this.state.fieldNames.includes(err.error)){var fields=this.state.fields;fields[err.error].reason=err.reason;this.setState({fields:fields})}else{this.setState({errorMessage:err.reason})}}},{key:'__checkFormStage__REACT_HOT_LOADER__',value:function __checkFormStage__REACT_HOT_LOADER__(){return this.__checkFormStage__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__checkFormStage__REACT_HOT_LOADER__',value:function __checkFormStage__REACT_HOT_LOADER__(){var _this3=this;this.setState({stage:'valid'});if(this.state.errorMessage){this.setState({stage:'invalid'})}else{this.state.fieldNames.forEach(function(f){if(H.fieldIsInvalid(_this3.state.fields[f])){_this3.setState({stage:'invalid'})}})}if(this.state.recaptchaForm&&!this.state.recaptchaToken){this.setState({stage:'invalid'})}}},{key:'__handleChange__REACT_HOT_LOADER__',value:function __handleChange__REACT_HOT_LOADER__(){return this.__handleChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleChange__REACT_HOT_LOADER__',value:function __handleChange__REACT_HOT_LOADER__(fieldName,event){var _this4=this;this.setState({errorMessage:''});var fields=this.state.fields;var field=fields[fieldName];field.value=event.target.value;field.touched=true;if(field.validations){field.validations.forEach(function(v){if(typeof v=='function'){field=v(_this4.state,fieldName)}})}fields[fieldName]=field;this.setState({fields:fields});this.checkFormStage()}},{key:'__handleRecaptchaChange__REACT_HOT_LOADER__',value:function __handleRecaptchaChange__REACT_HOT_LOADER__(){return this.__handleRecaptchaChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleRecaptchaChange__REACT_HOT_LOADER__',value:function __handleRecaptchaChange__REACT_HOT_LOADER__(recaptchaToken){this.setState({recaptchaToken:recaptchaToken});this.checkFormStage()}},{key:'__handleBlur__REACT_HOT_LOADER__',value:function __handleBlur__REACT_HOT_LOADER__(){return this.__handleBlur__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleBlur__REACT_HOT_LOADER__',value:function __handleBlur__REACT_HOT_LOADER__(fieldName,event){var fields=this.state.fields;var field=fields[fieldName];field.firstBlur=true;field.blurred=true;field.focused=false;fields[fieldName]=field;this.setState({fields:fields})}},{key:'__handleFocus__REACT_HOT_LOADER__',value:function __handleFocus__REACT_HOT_LOADER__(){return this.__handleFocus__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleFocus__REACT_HOT_LOADER__',value:function __handleFocus__REACT_HOT_LOADER__(fieldName,event){var fields=this.state.fields;var field=fields[fieldName];field.blurred=false;field.focused=true;fields[fieldName]=field;this.setState({fields:fields})}},{key:'__handleFormSubmit__REACT_HOT_LOADER__',value:function __handleFormSubmit__REACT_HOT_LOADER__(){return this.__handleFormSubmit__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleFormSubmit__REACT_HOT_LOADER__',value:function __handleFormSubmit__REACT_HOT_LOADER__(event){event.preventDefault();this.setState({stage:'waiting',errorMessage:''})}},{key:'__pauseHandleFormSubmit__REACT_HOT_LOADER__',value:function __pauseHandleFormSubmit__REACT_HOT_LOADER__(){return this.__pauseHandleFormSubmit__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__pauseHandleFormSubmit__REACT_HOT_LOADER__',value:function __pauseHandleFormSubmit__REACT_HOT_LOADER__(event){var _this5=this;event.preventDefault();this.setState({stage:'waiting'});setTimeout(function(){return _this5.handleFormSubmit(event)},this.props.simulateLongResponse)}},{key:'__render__REACT_HOT_LOADER__',value:function __render__REACT_HOT_LOADER__(){return this.__render__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__render__REACT_HOT_LOADER__',value:function __render__REACT_HOT_LOADER__(){return _react2.default.createElement('form',{onSubmit:this.props.simulateLongResponse?this.pauseHandleFormSubmit:this.handleFormSubmit,__source:{fileName:_jsxFileName,lineNumber:252}},this.props.children)}}]);return ReactiveForm}(_react2.default.Component),_class.propTypes={onSubmit:_react2.default.PropTypes.string,hideAllReactiveOnFocus:_react2.default.PropTypes.bool,hideAllReactiveUntilFirstBlur:_react2.default.PropTypes.bool,simulateLongResponse:_react2.default.PropTypes.number,delayAllErrorMessages:_react2.default.PropTypes.number},_class.childContextTypes={state:_react2.default.PropTypes.object,methods:_react2.default.PropTypes.object},_temp);;var _temp2=function(){if(typeof __REACT_HOT_LOADER__==='undefined'){return}__REACT_HOT_LOADER__.register(ReactiveForm,'ReactiveForm','core/modules/everlib_react_forms/reactive_form.jsx')}();;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlYWN0aXZlX2Zvcm0uanN4Il0sIm5hbWVzIjpbIkgiLCJSZWFjdGl2ZUZvcm0iLCJwcm9wcyIsImdldENoaWxkQ29udGV4dCIsIl9jcmVhdGVOZXdGb3JtRmllbGRPblN0YXRlIiwiYWRkRmllbGRPckZvcm1FcnJvciIsImNoZWNrRm9ybVN0YWdlIiwiaGFuZGxlQ2hhbmdlIiwiaGFuZGxlUmVjYXB0Y2hhQ2hhbmdlIiwiaGFuZGxlQmx1ciIsImhhbmRsZUZvY3VzIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInBhdXNlSGFuZGxlRm9ybVN1Ym1pdCIsInJlbmRlciIsImhpZGVBbGxSZWFjdGl2ZU9uRm9jdXMiLCJoaWRlQWxsUmVhY3RpdmVVbnRpbEZpcnN0Qmx1ciIsIkVycm9yIiwic2ltdWxhdGVMb25nUmVzcG9uc2UiLCJjb25zb2xlIiwid2FybiIsInN0YXRlIiwiZGVsYXlBbGxFcnJvck1lc3NhZ2VzIiwibWFwRm9ybUZpZWxkc1RvU3RhdGUiLCJjaGlsZHJlbiIsIkNoaWxkcmVuIiwiZm9yRWFjaCIsImMiLCJpc1ZhbGlkRWxlbWVudCIsInR5cGUiLCJuYW1lIiwiaW5jbHVkZXMiLCJyZWNhcHRjaGFGb3JtIiwibWV0aG9kcyIsImZpZWxkIiwiZmllbGRzIiwiZmllbGROYW1lcyIsIm9iaiIsImtleSIsImhhc093blByb3BlcnR5IiwicmVhc29uIiwiZXJyb3JUeXBlIiwidmFsdWUiLCJ2YWxpZGF0aW9ucyIsImJsdXJyZWQiLCJmb2N1c2VkIiwiZmlyc3RCbHVyIiwiaGlkZVJlYWN0aXZlVW50aWxGaXJzdEJsdXIiLCJkZWZhdWx0RXJyb3JNZXNzYWdlIiwiZmllbGROYW1lIiwicHVzaCIsInYiLCJlcnIiLCJlcnJvciIsInNldFN0YXRlIiwiZXJyb3JNZXNzYWdlIiwic3RhZ2UiLCJmaWVsZElzSW52YWxpZCIsImYiLCJyZWNhcHRjaGFUb2tlbiIsImV2ZW50IiwidGFyZ2V0IiwidG91Y2hlZCIsInByZXZlbnREZWZhdWx0Iiwic2V0VGltZW91dCIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsIm9uU3VibWl0IiwiUHJvcFR5cGVzIiwic3RyaW5nIiwiYm9vbCIsIm51bWJlciIsImNoaWxkQ29udGV4dFR5cGVzIiwib2JqZWN0Il0sIm1hcHBpbmdzIjoicXpCQU9BLDRCLDJDQUNBLG1DLEdBQVlBLEUsK1ZBT0NDLGEsU0FBQUEsWSxnR0FlWCxzQkFBWUMsS0FBWixDQUFtQix1TEFDWEEsS0FEVyxTQWtEbkJDLGVBbERtQiw2RkFnRW5CQywwQkFoRW1CLHdHQW9HbkJDLG1CQXBHbUIsaUdBaUhuQkMsY0FqSG1CLDRGQWdKbkJDLFlBaEptQiwwRkFvS25CQyxxQkFwS21CLG1HQXlLbkJDLFVBekttQix3RkFtTG5CQyxXQW5MbUIseUZBNExuQkMsZ0JBNUxtQiw4RkFvTm5CQyxxQkFwTm1CLG1HQTJObkJDLE1BM05tQiw4RUFJakIsR0FBSVgsTUFBTVksc0JBQU4sRUFBZ0NaLE1BQU1hLDZCQUExQyxDQUF5RSxDQUN2RSxLQUFNLElBQUlDLE1BQUosQ0FBVSw4RUFBVixDQUNQLENBRUQsR0FBSWQsTUFBTWUsb0JBQVYsQ0FBZ0MsQ0FDOUJDLFFBQVFDLElBQVIsQ0FBYSw2Q0FBYixDQUNELENBR0QsTUFBS0MsS0FBTCxDQUFhLENBQ1gsUUFBUyxTQURFLENBRVgseUJBQTBCbEIsTUFBTVksc0JBQU4sRUFBZ0MsS0FGL0MsQ0FHWCxnQ0FBaUNaLE1BQU1hLDZCQUFOLEVBQXVDLEtBSDdELENBSVgsd0JBQXlCYixNQUFNbUIscUJBQU4sRUFBK0IsQ0FKN0MsQ0FLWCxlQUFnQixFQUxMLENBTVgsVUFBVyxLQU5BLENBT1gsYUFBYyxFQVBILENBUVgsU0FBVSxFQVJDLENBU1gsY0FBZSxFQVRKLENBVVgsZ0JBQWlCLEtBVk4sQ0FXWCxpQkFBa0IsRUFYUCxDQVlYLHVCQUF3Qm5CLE1BQU1lLG9CQUFOLEVBQThCLEtBWjNDLENBQWIsQ0FnQkEsTUFBS0ssb0JBQUwsQ0FBNEIsU0FBQ0MsUUFBRCxDQUFjLENBQ3hDLGdCQUFNQyxRQUFOLENBQWVDLE9BQWYsQ0FB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ZUQsQyxnVEFPd0JLLEssQ0FBVSxpQkFDakNBLE1BQU1HLGNBQU4sR0FDQSxLQUFLVCxRQUFMLENBQWMsQ0FBRUUsTUFBTyxTQUFULENBQWQsRUFDQVEsV0FBVyxpQkFBTSxRQUFLcEQsZ0JBQUwsQ0FBc0JnRCxLQUF0QixDQUFOLENBQVgsQ0FDRSxLQUFLekQsS0FBTCxDQUFXZSxvQkFEYixDQUVELEMsc09BRWMsQ0FDYixNQUNFLHVDQUNFLFNBQVcsS0FBS2YsS0FBTCxDQUFXZSxvQkFBWixDQUFvQyxLQUFLTCxxQkFBekMsQ0FBaUUsS0FBS0QsZ0JBRGxGLGtEQUVHLEtBQUtULEtBQUwsQ0FBV3FCLFFBRmQsQ0FLSCxDLHlCQWpQK0IsZ0JBQU15QyxTLFNBRS9CQyxTLENBQVksQ0FDakJDLFNBQVUsZ0JBQU1DLFNBQU4sQ0FBZ0JDLE1BRFQsQ0FFakJ0RCx1QkFBd0IsZ0JBQU1xRCxTQUFOLENBQWdCRSxJQUZ2QixDQUdqQnRELDhCQUErQixnQkFBTW9ELFNBQU4sQ0FBZ0JFLElBSDlCLENBSWpCcEQscUJBQXNCLGdCQUFNa0QsU0FBTixDQUFnQkcsTUFKckIsQ0FLakJqRCxzQkFBdUIsZ0JBQU04QyxTQUFOLENBQWdCRyxNQUx0QixDLFFBUVpDLGlCLENBQW9CLENBQ3pCbkQsTUFBTyxnQkFBTStDLFNBQU4sQ0FBZ0JLLE1BREUsQ0FFekJ4QyxRQUFTLGdCQUFNbUMsU0FBTixDQUFnQkssTUFGQSxDLGtIQVZoQnZFLFkiLCJmaWxlIjoicmVhY3RpdmVfZm9ybS5qc3giLCJzb3VyY2VSb290IjoiL1VzZXJzL3RvbnluZ3V5ZW4vRG9jdW1lbnRzL0dpdEh1Yi9jb2RlZm9yYXBwcy90b29scyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRXZlcmxpYiBSZWFjdCBGb3JtIGNvbXBvbmVudHMgYW5kIGhlbHBlcnNcbiAqXG4gKiBBdXRob3I6IE5hdGhhbiBCcmFkeVxuICogQ3JlYXRlZDogMDYvMDYvMjAxNlxuICovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgKiBhcyBIIGZyb20gJy4vX2hlbHBlcnMnO1xuXG4vKipcbiAqIFRoaXMgaXMgb3VyIHdyYXBwZXIgZm9yIHRoZSBSZWFjdGl2ZUZvcm0uIEl0IHdpbGwgaGFuZGxlXG4gKiB0aGUgYmFzZSBjYXNlIGZvciBmb3JtIGV2ZW50cy5cbiAqL1xuXG5leHBvcnQgY2xhc3MgUmVhY3RpdmVGb3JtIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIG9uU3VibWl0OiBSZWFjdC5Qcm9wVHlwZXMuc3RyaW5nLFxuICAgIGhpZGVBbGxSZWFjdGl2ZU9uRm9jdXM6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIGhpZGVBbGxSZWFjdGl2ZVVudGlsRmlyc3RCbHVyOiBSZWFjdC5Qcm9wVHlwZXMuYm9vbCxcbiAgICBzaW11bGF0ZUxvbmdSZXNwb25zZTogUmVhY3QuUHJvcFR5cGVzLm51bWJlcixcbiAgICBkZWxheUFsbEVycm9yTWVzc2FnZXM6IFJlYWN0LlByb3BUeXBlcy5udW1iZXJcbiAgfTtcblxuICBzdGF0aWMgY2hpbGRDb250ZXh0VHlwZXMgPSB7XG4gICAgc3RhdGU6IFJlYWN0LlByb3BUeXBlcy5vYmplY3QsXG4gICAgbWV0aG9kczogUmVhY3QuUHJvcFR5cGVzLm9iamVjdFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgLy8gQ2hlY2sgcHJvcHMgZm9yIGVycm9ycyBhbmQgd2FybmluZ3NcbiAgICBpZiAocHJvcHMuaGlkZUFsbFJlYWN0aXZlT25Gb2N1cyAmJiBwcm9wcy5oaWRlQWxsUmVhY3RpdmVVbnRpbEZpcnN0Qmx1cikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHNldCBoaWRlQWxsUmVhY3RpdmVPbkZvY3VzIGFuZCBoaWRlQWxsUmVhY3RpdmVVbnRpbEZpcnN0Qmx1ciB0byB0cnVlLlwiKTtcbiAgICB9XG4gICAgLy8gV2FybiBhYm91dCBzaW11bGF0aW9uXG4gICAgaWYgKHByb3BzLnNpbXVsYXRlTG9uZ1Jlc3BvbnNlKSB7XG4gICAgICBjb25zb2xlLndhcm4oXCJTaW11bGF0aW5nIGEgbG9uZyByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIuXCIpO1xuICAgIH1cblxuICAgIC8vIEV4cGxpY2l0ZWx5IHNldCBib29sZWFuIHByb3BzIHRvIGZhbHNlLCBpbnN0ZWFkIG9mICdmYWxzZXknIHZhbHVlXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgICdzdGFnZSc6ICduZXV0cmFsJyxcbiAgICAgICdoaWRlQWxsUmVhY3RpdmVPbkZvY3VzJzogcHJvcHMuaGlkZUFsbFJlYWN0aXZlT25Gb2N1cyB8fCBmYWxzZSxcbiAgICAgICdoaWRlQWxsUmVhY3RpdmVVbnRpbEZpcnN0Qmx1cic6IHByb3BzLmhpZGVBbGxSZWFjdGl2ZVVudGlsRmlyc3RCbHVyIHx8IGZhbHNlLFxuICAgICAgJ2RlbGF5QWxsRXJyb3JNZXNzYWdlcyc6IHByb3BzLmRlbGF5QWxsRXJyb3JNZXNzYWdlcyB8fCAwLFxuICAgICAgJ2Vycm9yTWVzc2FnZSc6ICcnLFxuICAgICAgJ3N1Y2Nlc3MnOiBmYWxzZSxcbiAgICAgICdmaWVsZE5hbWVzJzogW10sXG4gICAgICAnZmllbGRzJzoge30sXG4gICAgICAndmFsaWRhdGlvbnMnOiBbXSxcbiAgICAgICdyZWNhcHRjaGFGb3JtJzogZmFsc2UsXG4gICAgICAncmVjYXB0Y2hhVG9rZW4nOiAnJyxcbiAgICAgICdzaW11bGF0ZUxvbmdSZXNwb25zZSc6IHByb3BzLnNpbXVsYXRlTG9uZ1Jlc3BvbnNlIHx8IGZhbHNlXG4gICAgfTtcblxuICAgIC8vIFNldCB1cCBpbml0aWFsIGZvcm0gc3RhdGVcbiAgICB0aGlzLm1hcEZvcm1GaWVsZHNUb1N0YXRlID0gKGNoaWxkcmVuKSA9PiB7XG4gICAgICBSZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNoaWxkcmVuLCAoYykgPT4ge1xuICAgICAgICBpZiAoUmVhY3QuaXNWYWxpZEVsZW1lbnQoYykpIHtcbiAgICAgICAgICBpZiAoYy50eXBlICYmIGMudHlwZS5uYW1lICYmXG4gICAgICAgICAgICBbXCJSZWFjdGl2ZUlucHV0XCIsIFwiUmVhY3RpdmVUZXh0YXJlYVwiXS5pbmNsdWRlcyhjLnR5cGUubmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMuX2NyZWF0ZU5ld0Zvcm1GaWVsZE9uU3RhdGUoYy5wcm9wcyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjLnR5cGUgJiYgYy50eXBlLm5hbWUgJiYgYy50eXBlLm5hbWUgPT09IFwiUmVhY3RpdmVDYXB0Y2hhXCIpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUucmVjYXB0Y2hhRm9ybSA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjLnByb3BzLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICB0aGlzLm1hcEZvcm1GaWVsZHNUb1N0YXRlKGMucHJvcHMuY2hpbGRyZW4pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICB0aGlzLm1hcEZvcm1GaWVsZHNUb1N0YXRlKHByb3BzLmNoaWxkcmVuKTtcblxuICB9XG5cbiAgLy8gQXR0YWNoIHN0YXRlIGFuZCBtZXRob2RzIHRoYXQgbmVlZCB0byBiZSBwYXNzZWQgdG8gYWxsIGNoaWxkcmVuXG4gIGdldENoaWxkQ29udGV4dCA9ICgpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgc3RhdGU6IHRoaXMuc3RhdGUsXG4gICAgICBtZXRob2RzOiB7XG4gICAgICAgIGhhbmRsZUNoYW5nZTogdGhpcy5oYW5kbGVDaGFuZ2UsXG4gICAgICAgIGhhbmRsZUJsdXI6IHRoaXMuaGFuZGxlQmx1cixcbiAgICAgICAgaGFuZGxlRm9jdXM6IHRoaXMuaGFuZGxlRm9jdXMsXG4gICAgICAgIGhhbmRsZVJlY2FwdGNoYUNoYW5nZTogdGhpcy5oYW5kbGVSZWNhcHRjaGFDaGFuZ2VcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIC8vIEFueSBtZXRob2QgdGhhdCBpcyBjYWxsZWQgYnkgdGhlIGNvbnN0cnVjdG9yIGFuZCBzaG91bGQgb25seVxuICAvLyBiZSB1c2VkIHdpdGhpbiB0aGUgY29uc3RydWN0b3IgaXMgcHJlZmFjZWQgd2l0aCBhbiBfXG4gIF9jcmVhdGVOZXdGb3JtRmllbGRPblN0YXRlID0gKGZpZWxkKSA9PiB7XG4gICAgY29uc3QgZmllbGRzID0gdGhpcy5zdGF0ZS5maWVsZHM7XG4gICAgY29uc3QgZmllbGROYW1lcyA9IHRoaXMuc3RhdGUuZmllbGROYW1lcztcblxuICAgIC8vIGNvcHkgdGhlIGZyb3plbiBwcm9wcyBvYmplY3RcbiAgICBsZXQgb2JqID0ge307XG4gICAgZm9yIChsZXQga2V5IGluIGZpZWxkKSB7XG4gICAgICBpZiAoZmllbGQuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICBvYmpba2V5XSA9IGZpZWxkW2tleV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gdXBkYXRlIHNvbWUgZGVmYXVsdHNcbiAgICBvYmoucmVhc29uID0gZmllbGQucmVhc29uIHx8ICcnO1xuICAgIG9iai5lcnJvclR5cGUgPSBmaWVsZC5lcnJvclR5cGUgfHwgJyc7XG4gICAgb2JqLnZhbHVlID0gZmllbGQudmFsdWUgfHwgJyc7XG4gICAgb2JqLnZhbGlkYXRpb25zID0gZmllbGQudmFsaWRhdGlvbnMgfHwgW107XG4gICAgb2JqLmJsdXJyZWQgPSBmaWVsZC5ibHVycmVkIHx8IHRydWU7XG4gICAgb2JqLmZvY3VzZWQgPSBmaWVsZC5mb2N1c2VkIHx8IGZhbHNlO1xuICAgIG9iai5maXJzdEJsdXIgPSBmaWVsZC5maXJzdEJsdXIgfHwgZmFsc2U7XG4gICAgb2JqLmhpZGVSZWFjdGl2ZVVudGlsRmlyc3RCbHVyID0gZmllbGQuZmlyc3RCbHVyIHx8IGZhbHNlO1xuICAgIG9iai5kZWZhdWx0RXJyb3JNZXNzYWdlID0gZmllbGQuZGVmYXVsdEVycm9yTWVzc2FnZSB8fCAnJztcblxuICAgIC8vIGFkZCB0aGUgbmV3IHByb3BzIG9iamVjdFxuICAgIGZpZWxkc1tmaWVsZC5maWVsZE5hbWVdID0gb2JqO1xuXG4gICAgLy8gYWRkIHRoZSBmaWVsZE5hbWVzIHRvIHRoZSB0b3AgbGlzdFxuICAgIGZpZWxkTmFtZXMucHVzaChmaWVsZC5maWVsZE5hbWUpO1xuICAgIC8vIGFkZCB0aGUgdmFsaWRhdGlvbnMgdG8gdGhlIHRvcCBsaXN0XG4gICAgZmllbGQudmFsaWRhdGlvbnMuZm9yRWFjaCh2ID0+XG4gICAgICB0aGlzLnN0YXRlLnZhbGlkYXRpb25zLnB1c2godikpO1xuXG4gICAgdGhpcy5zdGF0ZS5maWVsZHMgPSBmaWVsZHM7XG4gICAgdGhpcy5zdGF0ZS5maWVsZE5hbWVzID0gZmllbGROYW1lcztcbiAgfTtcblxuICBhZGRGaWVsZE9yRm9ybUVycm9yID0gKGVycikgPT4ge1xuICAgIGlmICh0aGlzLnN0YXRlLmZpZWxkTmFtZXMuaW5jbHVkZXMoZXJyLmVycm9yKSkge1xuICAgICAgbGV0IGZpZWxkcyA9IHRoaXMuc3RhdGUuZmllbGRzO1xuICAgICAgZmllbGRzW2Vyci5lcnJvcl0ucmVhc29uID0gZXJyLnJlYXNvbjtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBmaWVsZHMgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvck1lc3NhZ2U6IGVyci5yZWFzb24gfSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBDaGVja3Mgd2hldGhlciBvciBub3QgdGhlIGZvcm0gaXMgdmFsaWRcbiAgICovXG4gIGNoZWNrRm9ybVN0YWdlID0gKCkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzdGFnZTogJ3ZhbGlkJyB9KTtcbiAgICBpZiAodGhpcy5zdGF0ZS5lcnJvck1lc3NhZ2UpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBzdGFnZTogJ2ludmFsaWQnIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnN0YXRlLmZpZWxkTmFtZXMuZm9yRWFjaChmID0+IHtcbiAgICAgICAgaWYgKEguZmllbGRJc0ludmFsaWQodGhpcy5zdGF0ZS5maWVsZHNbZl0pKSB7XG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IHN0YWdlOiAnaW52YWxpZCcgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICAvLyBJZiBmb3JtIGhhcyBhIHJlY2FwdGNoYSBidXQgbm8gdG9rZW4sIGl0J3Mgbm90IHJlYWR5XG4gICAgaWYgKHRoaXMuc3RhdGUucmVjYXB0Y2hhRm9ybSAmJiAhdGhpcy5zdGF0ZS5yZWNhcHRjaGFUb2tlbikge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IHN0YWdlOiAnaW52YWxpZCcgfSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gICAqIFNldHRpbmcgdXAgb3VyIGxvY2FsIGV2ZW50IGhhbmRsZXJzXG4gICAqXG4gICAqL1xuXG4gIC8qKlxuICAgKiBGb3Igbm93IGV2ZXJ5IFJlYWN0aXZlSW5wdXQgZmllbGQgd2lsbCBmbG93IHRocm91Z2ggdGhpcyBoYW5kbGVDaGFuZ2VcbiAgICogZXZlbnQgaGFuZGxlci4gVGhpcyB3aWxsIGFsc28gcHJvY2VzcyBhbnkgdmFsaWRhdGlvbiBob29rcyBwYXNzZWQgaW4gdGhlXG4gICAqIGFycmF5IG9mIHByb3BzLiBGdW5jdGlvbnMgcGFzc2VkIGluIHdpbGwgYmUgdHJlYXRlZCBhcyBzdWNoLCB3aGlsZSBzdHJpbmdzXG4gICAqIHBhc3NlZCBpbiB0byB0aGUgYXJyYXkgb2YgdmFsaWRhdGlvbnMgYXJlIHRvIGJlIHRyZWF0ZWQgYXMgbWV0ZW9yIG1ldGhvZHMuXG4gICAqXG4gICAqIEBwYXJhbSBmaWVsZE5hbWUgLSBOYW1lIG9mIHRoZSBmaWVsZCB3ZSdyZSB0YXJnZXRpbmdcbiAgICogQHBhcmFtIGV2ZW50IC0gdGhlIGNoYW5nZSBldmVudCBQYXNzZWQgaW4gYXV0b21hdGljYWxseVxuICAgKi9cbiAgaGFuZGxlQ2hhbmdlID0gKGZpZWxkTmFtZSwgZXZlbnQpID0+IHtcbiAgICAvLyBSZXNldCB0aGUgbWFqb3IgZm9ybSBlcnJvciBvbiBhbnkgY2hhbmdlXG4gICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yTWVzc2FnZTogJycgfSk7XG4gICAgbGV0IGZpZWxkcyA9IHRoaXMuc3RhdGUuZmllbGRzO1xuICAgIGxldCBmaWVsZCA9IGZpZWxkc1tmaWVsZE5hbWVdO1xuICAgIGZpZWxkLnZhbHVlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgIGZpZWxkLnRvdWNoZWQgPSB0cnVlO1xuXG4gICAgaWYgKGZpZWxkLnZhbGlkYXRpb25zKSB7XG4gICAgICBmaWVsZC52YWxpZGF0aW9ucy5mb3JFYWNoKHYgPT4ge1xuICAgICAgICBpZiAodHlwZW9mIHYgPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgIGZpZWxkID0gdih0aGlzLnN0YXRlLCBmaWVsZE5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgZmllbGRzW2ZpZWxkTmFtZV0gPSBmaWVsZDtcbiAgICB0aGlzLnNldFN0YXRlKHsgZmllbGRzIH0pO1xuICAgIHRoaXMuY2hlY2tGb3JtU3RhZ2UoKTtcbiAgfTtcblxuICBoYW5kbGVSZWNhcHRjaGFDaGFuZ2UgPSAocmVjYXB0Y2hhVG9rZW4pID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHsgcmVjYXB0Y2hhVG9rZW4gfSk7XG4gICAgdGhpcy5jaGVja0Zvcm1TdGFnZSgpO1xuICB9O1xuXG4gIGhhbmRsZUJsdXIgPSAoZmllbGROYW1lLCBldmVudCkgPT4ge1xuICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuc3RhdGUuZmllbGRzO1xuICAgIGNvbnN0IGZpZWxkID0gZmllbGRzW2ZpZWxkTmFtZV07XG4gICAgZmllbGQuZmlyc3RCbHVyID0gdHJ1ZTtcbiAgICBmaWVsZC5ibHVycmVkID0gdHJ1ZTtcbiAgICBmaWVsZC5mb2N1c2VkID0gZmFsc2U7XG4gICAgZmllbGRzW2ZpZWxkTmFtZV0gPSBmaWVsZDtcbiAgICB0aGlzLnNldFN0YXRlKHsgZmllbGRzIH0pO1xuICB9O1xuXG4gIGhhbmRsZUZvY3VzID0gKGZpZWxkTmFtZSwgZXZlbnQpID0+IHtcbiAgICBjb25zdCBmaWVsZHMgPSB0aGlzLnN0YXRlLmZpZWxkcztcbiAgICBjb25zdCBmaWVsZCA9IGZpZWxkc1tmaWVsZE5hbWVdO1xuICAgIGZpZWxkLmJsdXJyZWQgPSBmYWxzZTtcbiAgICBmaWVsZC5mb2N1c2VkID0gdHJ1ZTtcbiAgICBmaWVsZHNbZmllbGROYW1lXSA9IGZpZWxkO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBmaWVsZHMgfSk7XG4gIH07XG5cbiAgaGFuZGxlRm9ybVN1Ym1pdCA9IChldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHN0YWdlOiAnd2FpdGluZycsIGVycm9yTWVzc2FnZTogJycgfSk7XG4gICAgLy8gVE9ETzogSEFORExFIEZPUk0gU1VCTUlTU0lPTlxuICAgIC8vIE1ldGVvci5jYWxsKHRoaXMucHJvcHMub25TdWJtaXQsIHRoaXMuc3RhdGUsIChlcnIsIHJlcykgPT4ge1xuICAgIC8vICAgaWYgKGVycikge1xuICAgIC8vICAgICB0aGlzLmFkZEZpZWxkT3JGb3JtRXJyb3IoZXJyKTtcbiAgICAvLyAgIH0gZWxzZSB7XG4gICAgLy8gICAgIC8vIGRvIHRoZSBvbiBzdWNjZXNzIHN0dWZmXG4gICAgLy8gICAgIHRoaXMucHJvcHMub25TdWNjZXNzKHRoaXMuc3RhdGUsIChlcnIsIGRlZmF1bHRNc2cgPSAnJykgPT4ge1xuICAgIC8vICAgICAgIGlmIChlcnIpIHtcbiAgICAvLyAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBlcnJvck1lc3NhZ2U6IGRlZmF1bHRNc2cgfHwgZXJyLnJlYXNvbiB9KTtcbiAgICAvLyAgICAgICB9XG4gICAgLy8gICAgIH0pO1xuICAgIC8vICAgfVxuICAgIC8vICAgdGhpcy5jaGVja0Zvcm1TdGFnZSgpO1xuICAgIC8vIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBJZiBzaW11bGF0ZUxvbmdSZXNwb25zZSBpcyBhY3RpdmUsIHRoaXMgd2lsbCBwYXVzZSBleGVjdXRpb24gb2ZcbiAgICogaGFuZGxlRm9ybVN1Ym1pdFxuICAgKiBAcGFyYW0gZXZlbnRcbiAgICovXG4gIHBhdXNlSGFuZGxlRm9ybVN1Ym1pdCA9IChldmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHN0YWdlOiAnd2FpdGluZycgfSk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmhhbmRsZUZvcm1TdWJtaXQoZXZlbnQpLFxuICAgICAgdGhpcy5wcm9wcy5zaW11bGF0ZUxvbmdSZXNwb25zZSk7XG4gIH07XG5cbiAgcmVuZGVyID0gKCkgPT4ge1xuICAgIHJldHVybiAoXG4gICAgICA8Zm9ybVxuICAgICAgICBvblN1Ym1pdD17KHRoaXMucHJvcHMuc2ltdWxhdGVMb25nUmVzcG9uc2UpID8gdGhpcy5wYXVzZUhhbmRsZUZvcm1TdWJtaXQgOiB0aGlzLmhhbmRsZUZvcm1TdWJtaXR9PlxuICAgICAgICB7dGhpcy5wcm9wcy5jaGlsZHJlbn1cbiAgICAgIDwvZm9ybT5cbiAgICApXG4gIH07XG59Il19