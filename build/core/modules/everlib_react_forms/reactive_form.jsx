'use strict';exports.__esModule=true;exports.ReactiveForm=undefined;var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _class,_temp,_jsxFileName='core/modules/everlib_react_forms/reactive_form.jsx';var _react=require('react');var _react2=_interopRequireDefault(_react);var _helpers=require('./_helpers');var H=_interopRequireWildcard(_helpers);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ReactiveForm=exports.ReactiveForm=(_temp=_class=function(_React$Component){(0,_inherits3.default)(ReactiveForm,_React$Component);function ReactiveForm(props){(0,_classCallCheck3.default)(this,ReactiveForm);var _this=(0,_possibleConstructorReturn3.default)(this,(ReactiveForm.__proto__||(0,_getPrototypeOf2.default)(ReactiveForm)).call(this,props));_this.getChildContext=function(){return _this.__getChildContext__REACT_HOT_LOADER__.apply(_this,arguments)};_this._createNewFormFieldOnState=function(){return _this.___createNewFormFieldOnState__REACT_HOT_LOADER__.apply(_this,arguments)};_this.addFieldOrFormError=function(){return _this.__addFieldOrFormError__REACT_HOT_LOADER__.apply(_this,arguments)};_this.checkFormStage=function(){return _this.__checkFormStage__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleChange=function(){return _this.__handleChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleRecaptchaChange=function(){return _this.__handleRecaptchaChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleBlur=function(){return _this.__handleBlur__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleFocus=function(){return _this.__handleFocus__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleFormSubmit=function(){return _this.__handleFormSubmit__REACT_HOT_LOADER__.apply(_this,arguments)};_this.pauseHandleFormSubmit=function(){return _this.__pauseHandleFormSubmit__REACT_HOT_LOADER__.apply(_this,arguments)};_this.render=function(){return _this.__render__REACT_HOT_LOADER__.apply(_this,arguments)};if(props.hideAllReactiveOnFocus&&props.hideAllReactiveUntilFirstBlur){throw new Error('Cannot set hideAllReactiveOnFocus and hideAllReactiveUntilFirstBlur to true.')}if(props.simulateLongResponse){console.warn('Simulating a long response from the server.')}_this.state={'stage':'neutral','hideAllReactiveOnFocus':props.hideAllReactiveOnFocus||false,'hideAllReactiveUntilFirstBlur':props.hideAllReactiveUntilFirstBlur||false,'delayAllErrorMessages':props.delayAllErrorMessages||0,'errorMessage':'','success':false,'fieldNames':[],'fields':{},'validations':[],'recaptchaForm':false,'recaptchaToken':'','simulateLongResponse':props.simulateLongResponse||false};_this.mapFormFieldsToState=function(children){_react2.default.Children.forEach(children,function(c){if(_react2.default.isValidElement(c)){if(c.type&&c.type.name&&['ReactiveInput','ReactiveTextarea'].includes(c.type.name)){_this._createNewFormFieldOnState(c.props)}if(c.type&&c.type.name&&c.type.name==='ReactiveCaptcha'){_this.state.recaptchaForm=true}if(c.props.children){_this.mapFormFieldsToState(c.props.children)}}})};_this.mapFormFieldsToState(props.children);return _this}(0,_createClass3.default)(ReactiveForm,[{key:'__getChildContext__REACT_HOT_LOADER__',value:function __getChildContext__REACT_HOT_LOADER__(){return this.__getChildContext__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__getChildContext__REACT_HOT_LOADER__',value:function __getChildContext__REACT_HOT_LOADER__(){return{state:this.state,methods:{handleChange:this.handleChange,handleBlur:this.handleBlur,handleFocus:this.handleFocus,handleRecaptchaChange:this.handleRecaptchaChange}}}},{key:'___createNewFormFieldOnState__REACT_HOT_LOADER__',value:function ___createNewFormFieldOnState__REACT_HOT_LOADER__(){return this.___createNewFormFieldOnState__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'___createNewFormFieldOnState__REACT_HOT_LOADER__',value:function ___createNewFormFieldOnState__REACT_HOT_LOADER__(field){var _this2=this;var fields=this.state.fields;var fieldNames=this.state.fieldNames;var obj={};for(var key in field){if(field.hasOwnProperty(key)){obj[key]=field[key]}}obj.reason=field.reason||'';obj.errorType=field.errorType||'';obj.value=field.value||'';obj.validations=field.validations||[];obj.blurred=field.blurred||true;obj.focused=field.focused||false;obj.firstBlur=field.firstBlur||false;obj.hideReactiveUntilFirstBlur=field.firstBlur||false;obj.defaultErrorMessage=field.defaultErrorMessage||'';fields[field.fieldName]=obj;fieldNames.push(field.fieldName);field.validations.forEach(function(v){return _this2.state.validations.push(v)});this.state.fields=fields;this.state.fieldNames=fieldNames}},{key:'__addFieldOrFormError__REACT_HOT_LOADER__',value:function __addFieldOrFormError__REACT_HOT_LOADER__(){return this.__addFieldOrFormError__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__addFieldOrFormError__REACT_HOT_LOADER__',value:function __addFieldOrFormError__REACT_HOT_LOADER__(err){if(this.state.fieldNames.includes(err.error)){var fields=this.state.fields;fields[err.error].reason=err.reason;this.setState({fields:fields})}else{this.setState({errorMessage:err.reason})}}},{key:'__checkFormStage__REACT_HOT_LOADER__',value:function __checkFormStage__REACT_HOT_LOADER__(){return this.__checkFormStage__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__checkFormStage__REACT_HOT_LOADER__',value:function __checkFormStage__REACT_HOT_LOADER__(){var _this3=this;this.setState({stage:'valid'});if(this.state.errorMessage){this.setState({stage:'invalid'})}else{this.state.fieldNames.forEach(function(f){if(H.fieldIsInvalid(_this3.state.fields[f])){_this3.setState({stage:'invalid'})}})}if(this.state.recaptchaForm&&!this.state.recaptchaToken){this.setState({stage:'invalid'})}}},{key:'__handleChange__REACT_HOT_LOADER__',value:function __handleChange__REACT_HOT_LOADER__(){return this.__handleChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleChange__REACT_HOT_LOADER__',value:function __handleChange__REACT_HOT_LOADER__(fieldName,event){var _this4=this;this.setState({errorMessage:''});var fields=this.state.fields;var field=fields[fieldName];field.value=event.target.value;field.touched=true;if(field.validations){field.validations.forEach(function(v){if(typeof v=='function'){field=v(_this4.state,fieldName)}})}fields[fieldName]=field;this.setState({fields:fields});this.checkFormStage()}},{key:'__handleRecaptchaChange__REACT_HOT_LOADER__',value:function __handleRecaptchaChange__REACT_HOT_LOADER__(){return this.__handleRecaptchaChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleRecaptchaChange__REACT_HOT_LOADER__',value:function __handleRecaptchaChange__REACT_HOT_LOADER__(recaptchaToken){this.setState({recaptchaToken:recaptchaToken});this.checkFormStage()}},{key:'__handleBlur__REACT_HOT_LOADER__',value:function __handleBlur__REACT_HOT_LOADER__(){return this.__handleBlur__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleBlur__REACT_HOT_LOADER__',value:function __handleBlur__REACT_HOT_LOADER__(fieldName,event){var fields=this.state.fields;var field=fields[fieldName];field.firstBlur=true;field.blurred=true;field.focused=false;fields[fieldName]=field;this.setState({fields:fields})}},{key:'__handleFocus__REACT_HOT_LOADER__',value:function __handleFocus__REACT_HOT_LOADER__(){return this.__handleFocus__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleFocus__REACT_HOT_LOADER__',value:function __handleFocus__REACT_HOT_LOADER__(fieldName,event){var fields=this.state.fields;var field=fields[fieldName];field.blurred=false;field.focused=true;fields[fieldName]=field;this.setState({fields:fields})}},{key:'__handleFormSubmit__REACT_HOT_LOADER__',value:function __handleFormSubmit__REACT_HOT_LOADER__(){return this.__handleFormSubmit__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleFormSubmit__REACT_HOT_LOADER__',value:function __handleFormSubmit__REACT_HOT_LOADER__(event){event.preventDefault();this.setState({stage:'waiting',errorMessage:''})}},{key:'__pauseHandleFormSubmit__REACT_HOT_LOADER__',value:function __pauseHandleFormSubmit__REACT_HOT_LOADER__(){return this.__pauseHandleFormSubmit__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__pauseHandleFormSubmit__REACT_HOT_LOADER__',value:function __pauseHandleFormSubmit__REACT_HOT_LOADER__(event){var _this5=this;event.preventDefault();this.setState({stage:'waiting'});setTimeout(function(){return _this5.handleFormSubmit(event)},this.props.simulateLongResponse)}},{key:'__render__REACT_HOT_LOADER__',value:function __render__REACT_HOT_LOADER__(){return this.__render__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__render__REACT_HOT_LOADER__',value:function __render__REACT_HOT_LOADER__(){return _react2.default.createElement('form',{onSubmit:this.props.simulateLongResponse?this.pauseHandleFormSubmit:this.handleFormSubmit,__source:{fileName:_jsxFileName,lineNumber:252}},this.props.children)}}]);return ReactiveForm}(_react2.default.Component),_class.propTypes={onSubmit:_react2.default.PropTypes.string,hideAllReactiveOnFocus:_react2.default.PropTypes.bool,hideAllReactiveUntilFirstBlur:_react2.default.PropTypes.bool,simulateLongResponse:_react2.default.PropTypes.number,delayAllErrorMessages:_react2.default.PropTypes.number},_class.childContextTypes={state:_react2.default.PropTypes.object,methods:_react2.default.PropTypes.object},_temp);;var _temp2=function(){if(typeof __REACT_HOT_LOADER__==='undefined'){return}__REACT_HOT_LOADER__.register(ReactiveForm,'ReactiveForm','core/modules/everlib_react_forms/reactive_form.jsx')}();;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlYWN0aXZlX2Zvcm0uanN4Il0sIm5hbWVzIjpbIkgiLCJSZWFjdGl2ZUZvcm0iLCJwcm9wcyIsImdldENoaWxkQ29udGV4dCIsIl9jcmVhdGVOZXdGb3JtRmllbGRPblN0YXRlIiwiYWRkRmllbGRPckZvcm1FcnJvciIsImNoZWNrRm9ybVN0YWdlIiwiaGFuZGxlQ2hhbmdlIiwiaGFuZGxlUmVjYXB0Y2hhQ2hhbmdlIiwiaGFuZGxlQmx1ciIsImhhbmRsZUZvY3VzIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInBhdXNlSGFuZGxlRm9ybVN1Ym1pdCIsInJlbmRlciIsImhpZGVBbGxSZWFjdGl2ZU9uRm9jdXMiLCJoaWRlQWxsUmVhY3RpdmVVbnRpbEZpcnN0Qmx1ciIsIkVycm9yIiwic2ltdWxhdGVMb25nUmVzcG9uc2UiLCJjb25zb2xlIiwid2FybiIsInN0YXRlIiwiZGVsYXlBbGxFcnJvck1lc3NhZ2VzIiwibWFwRm9ybUZpZWxkc1RvU3RhdGUiLCJjaGlsZHJlbiIsIkNoaWxkcmVuIiwiZm9yRWFjaCIsImMiLCJpc1ZhbGlkRWxlbWVudCIsInR5cGUiLCJuYW1lIiwiaW5jbHVkZXMiLCJyZWNhcHRjaGFGb3JtIiwibWV0aG9kcyIsImZpZWxkIiwiZmllbGRzIiwiZmllbGROYW1lcyIsIm9iaiIsImtleSIsImhhc093blByb3BlcnR5IiwicmVhc29uIiwiZXJyb3JUeXBlIiwidmFsdWUiLCJ2YWxpZGF0aW9ucyIsImJsdXJyZWQiLCJmb2N1c2VkIiwiZmlyc3RCbHVyIiwiaGlkZVJlYWN0aXZlVW50aWxGaXJzdEJsdXIiLCJkZWZhdWx0RXJyb3JNZXNzYWdlIiwiZmllbGROYW1lIiwicHVzaCIsInYiLCJlcnIiLCJlcnJvciIsInNldFN0YXRlIiwiZXJyb3JNZXNzYWdlIiwic3RhZ2UiLCJmaWVsZElzSW52YWxpZCIsImYiLCJyZWNhcHRjaGFUb2tlbiIsImV2ZW50IiwidGFyZ2V0IiwidG91Y2hlZCIsInByZXZlbnREZWZhdWx0Iiwic2V0VGltZW91dCIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsIm9uU3VibWl0IiwiUHJvcFR5cGVzIiwic3RyaW5nIiwiYm9vbCIsIm51bWJlciIsImNoaWxkQ29udGV4dFR5cGVzIiwib2JqZWN0Il0sIm1hcHBpbmdzIjoicXpCQU9BLDRCLDJDQUNBLG1DLEdBQVlBLEUsK1ZBT0NDLGEsU0FBQUEsWSxnR0FlWCxzQkFBWUMsS0FBWixDQUFtQix1TEFDWEEsS0FEVyxTQWtEbkJDLGVBbERtQiw2RkFnRW5CQywwQkFoRW1CLHdHQW9HbkJDLG1CQXBHbUIsaUdBaUhuQkMsY0FqSG1CLDRGQWdKbkJDLFlBaEptQiwwRkFvS25CQyxxQkFwS21CLG1HQXlLbkJDLFVBekttQix3RkFtTG5CQyxXQW5MbUIseUZBNExuQkMsZ0JBNUxtQiw4RkFvTm5CQyxxQkFwTm1CLG1HQTJObkJDLE1BM05tQiw4RUFJakIsR0FBSVgsTUFBTVksc0JBQU4sRUFBZ0NaLE1BQU1hLDZCQUExQyxDQUF5RSxDQUN2RSxLQUFNLElBQUlDLE1BQUosQ0FBVSw4RUFBVixDQUNQLENBRUQsR0FBSWQsTUFBTWUsb0JBQVYsQ0FBZ0MsQ0FDOUJDLFFBQVFDLElBQVIsQ0FBYSw2Q0FBYixDQUNELENBR0QsTUFBS0MsS0FBTCxDQUFhLENBQ1gsUUFBUyxTQURFLENBRVgseUJBQTBCbEIsTUFBTVksc0JBQU4sRUFBZ0MsS0FGL0MsQ0FHWCxnQ0FBaUNaLE1BQU1hLDZCQUFOLEVBQXVDLEtBSDdELENBSVgsd0JBQXlCYixNQUFNbUIscUJBQU4sRUFBK0IsQ0FKN0MsQ0FLWCxlQUFnQixFQUxMLENBTVgsVUFBVyxLQU5BLENBT1gsYUFBYyxFQVBILENBUVgsU0FBVSxFQVJDLENBU1gsY0FBZSxFQVRKLENBVVgsZ0JBQWlCLEtBVk4sQ0FXWCxpQkFBa0IsRUFYUCxDQVlYLHVCQUF3Qm5CLE1BQU1lLG9CQUFOLEVBQThCLEtBWjNDLENBQWIsQ0FnQkEsTUFBS0ssb0JBQUwsQ0FBNEIsU0FBQ0MsUUFBRCxDQUFjLENBQ3hDLGdCQUFNQyxRQUFOLENBQWVDLE9BQWYsQ0FB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ZUQsQyxnVEFPd0JLLEssQ0FBVSxpQkFDakNBLE1BQU1HLGNBQU4sR0FDQSxLQUFLVCxRQUFMLENBQWMsQ0FBRUUsTUFBTyxTQUFULENBQWQsRUFDQVEsV0FBVyxpQkFBTSxRQUFLcEQsZ0JBQUwsQ0FBc0JnRCxLQUF0QixDQUFOLENBQVgsQ0FDRSxLQUFLekQsS0FBTCxDQUFXZSxvQkFEYixDQUVELEMsc09BRWMsQ0FDYixNQUNFLHVDQUNFLFNBQVcsS0FBS2YsS0FBTCxDQUFXZSxvQkFBWixDQUFvQyxLQUFLTCxxQkFBekMsQ0FBaUUsS0FBS0QsZ0JBRGxGLGtEQUVHLEtBQUtULEtBQUwsQ0FBV3FCLFFBRmQsQ0FLSCxDLHlCQWpQK0IsZ0JBQU15QyxTLFNBRS9CQyxTLENBQVksQ0FDakJDLFNBQVUsZ0JBQU1DLFNBQU4sQ0FBZ0JDLE1BRFQsQ0FFakJ0RCx1QkFBd0IsZ0JBQU1xRCxTQUFOLENBQWdCRSxJQUZ2QixDQUdqQnRELDhCQUErQixnQkFBTW9ELFNBQU4sQ0FBZ0JFLElBSDlCLENBSWpCcEQscUJBQXNCLGdCQUFNa0QsU0FBTixDQUFnQkcsTUFKckIsQ0FLakJqRCxzQkFBdUIsZ0JBQU04QyxTQUFOLENBQWdCRyxNQUx0QixDLFFBUVpDLGlCLENBQW9CLENBQ3pCbkQsTUFBTyxnQkFBTStDLFNBQU4sQ0FBZ0JLLE1BREUsQ0FFekJ4QyxRQUFTLGdCQUFNbUMsU0FBTixDQUFnQkssTUFGQSxDLGtIQVZoQnZFLFkiLCJmaWxlIjoicmVhY3RpdmVfZm9ybS5qc3giLCJzb3VyY2VSb290IjoiL1VzZXJzL3RvbnluZ3V5ZW4vSWRlYVByb2plY3RzL2NvZGVmb3JhcHBzL3Rvb2xzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBFdmVybGliIFJlYWN0IEZvcm0gY29tcG9uZW50cyBhbmQgaGVscGVyc1xuICpcbiAqIEF1dGhvcjogTmF0aGFuIEJyYWR5XG4gKiBDcmVhdGVkOiAwNi8wNi8yMDE2XG4gKi9cblxuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCAqIGFzIEggZnJvbSAnLi9faGVscGVycyc7XG5cbi8qKlxuICogVGhpcyBpcyBvdXIgd3JhcHBlciBmb3IgdGhlIFJlYWN0aXZlRm9ybS4gSXQgd2lsbCBoYW5kbGVcbiAqIHRoZSBiYXNlIGNhc2UgZm9yIGZvcm0gZXZlbnRzLlxuICovXG5cbmV4cG9ydCBjbGFzcyBSZWFjdGl2ZUZvcm0gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuXG4gIHN0YXRpYyBwcm9wVHlwZXMgPSB7XG4gICAgb25TdWJtaXQ6IFJlYWN0LlByb3BUeXBlcy5zdHJpbmcsXG4gICAgaGlkZUFsbFJlYWN0aXZlT25Gb2N1czogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgaGlkZUFsbFJlYWN0aXZlVW50aWxGaXJzdEJsdXI6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIHNpbXVsYXRlTG9uZ1Jlc3BvbnNlOiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyLFxuICAgIGRlbGF5QWxsRXJyb3JNZXNzYWdlczogUmVhY3QuUHJvcFR5cGVzLm51bWJlclxuICB9O1xuXG4gIHN0YXRpYyBjaGlsZENvbnRleHRUeXBlcyA9IHtcbiAgICBzdGF0ZTogUmVhY3QuUHJvcFR5cGVzLm9iamVjdCxcbiAgICBtZXRob2RzOiBSZWFjdC5Qcm9wVHlwZXMub2JqZWN0XG4gIH07XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAvLyBDaGVjayBwcm9wcyBmb3IgZXJyb3JzIGFuZCB3YXJuaW5nc1xuICAgIGlmIChwcm9wcy5oaWRlQWxsUmVhY3RpdmVPbkZvY3VzICYmIHByb3BzLmhpZGVBbGxSZWFjdGl2ZVVudGlsRmlyc3RCbHVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3Qgc2V0IGhpZGVBbGxSZWFjdGl2ZU9uRm9jdXMgYW5kIGhpZGVBbGxSZWFjdGl2ZVVudGlsRmlyc3RCbHVyIHRvIHRydWUuXCIpO1xuICAgIH1cbiAgICAvLyBXYXJuIGFib3V0IHNpbXVsYXRpb25cbiAgICBpZiAocHJvcHMuc2ltdWxhdGVMb25nUmVzcG9uc2UpIHtcbiAgICAgIGNvbnNvbGUud2FybihcIlNpbXVsYXRpbmcgYSBsb25nIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlci5cIik7XG4gICAgfVxuXG4gICAgLy8gRXhwbGljaXRlbHkgc2V0IGJvb2xlYW4gcHJvcHMgdG8gZmFsc2UsIGluc3RlYWQgb2YgJ2ZhbHNleScgdmFsdWVcbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgJ3N0YWdlJzogJ25ldXRyYWwnLFxuICAgICAgJ2hpZGVBbGxSZWFjdGl2ZU9uRm9jdXMnOiBwcm9wcy5oaWRlQWxsUmVhY3RpdmVPbkZvY3VzIHx8IGZhbHNlLFxuICAgICAgJ2hpZGVBbGxSZWFjdGl2ZVVudGlsRmlyc3RCbHVyJzogcHJvcHMuaGlkZUFsbFJlYWN0aXZlVW50aWxGaXJzdEJsdXIgfHwgZmFsc2UsXG4gICAgICAnZGVsYXlBbGxFcnJvck1lc3NhZ2VzJzogcHJvcHMuZGVsYXlBbGxFcnJvck1lc3NhZ2VzIHx8IDAsXG4gICAgICAnZXJyb3JNZXNzYWdlJzogJycsXG4gICAgICAnc3VjY2Vzcyc6IGZhbHNlLFxuICAgICAgJ2ZpZWxkTmFtZXMnOiBbXSxcbiAgICAgICdmaWVsZHMnOiB7fSxcbiAgICAgICd2YWxpZGF0aW9ucyc6IFtdLFxuICAgICAgJ3JlY2FwdGNoYUZvcm0nOiBmYWxzZSxcbiAgICAgICdyZWNhcHRjaGFUb2tlbic6ICcnLFxuICAgICAgJ3NpbXVsYXRlTG9uZ1Jlc3BvbnNlJzogcHJvcHMuc2ltdWxhdGVMb25nUmVzcG9uc2UgfHwgZmFsc2VcbiAgICB9O1xuXG4gICAgLy8gU2V0IHVwIGluaXRpYWwgZm9ybSBzdGF0ZVxuICAgIHRoaXMubWFwRm9ybUZpZWxkc1RvU3RhdGUgPSAoY2hpbGRyZW4pID0+IHtcbiAgICAgIFJlYWN0LkNoaWxkcmVuLmZvckVhY2goY2hpbGRyZW4sIChjKSA9PiB7XG4gICAgICAgIGlmIChSZWFjdC5pc1ZhbGlkRWxlbWVudChjKSkge1xuICAgICAgICAgIGlmIChjLnR5cGUgJiYgYy50eXBlLm5hbWUgJiZcbiAgICAgICAgICAgIFtcIlJlYWN0aXZlSW5wdXRcIiwgXCJSZWFjdGl2ZVRleHRhcmVhXCJdLmluY2x1ZGVzKGMudHlwZS5uYW1lKSkge1xuICAgICAgICAgICAgdGhpcy5fY3JlYXRlTmV3Rm9ybUZpZWxkT25TdGF0ZShjLnByb3BzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGMudHlwZSAmJiBjLnR5cGUubmFtZSAmJiBjLnR5cGUubmFtZSA9PT0gXCJSZWFjdGl2ZUNhcHRjaGFcIikge1xuICAgICAgICAgICAgdGhpcy5zdGF0ZS5yZWNhcHRjaGFGb3JtID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGMucHJvcHMuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIHRoaXMubWFwRm9ybUZpZWxkc1RvU3RhdGUoYy5wcm9wcy5jaGlsZHJlbik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICAgIHRoaXMubWFwRm9ybUZpZWxkc1RvU3RhdGUocHJvcHMuY2hpbGRyZW4pO1xuXG4gIH1cblxuICAvLyBBdHRhY2ggc3RhdGUgYW5kIG1ldGhvZHMgdGhhdCBuZWVkIHRvIGJlIHBhc3NlZCB0byBhbGwgY2hpbGRyZW5cbiAgZ2V0Q2hpbGRDb250ZXh0ID0gKCkgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBzdGF0ZTogdGhpcy5zdGF0ZSxcbiAgICAgIG1ldGhvZHM6IHtcbiAgICAgICAgaGFuZGxlQ2hhbmdlOiB0aGlzLmhhbmRsZUNoYW5nZSxcbiAgICAgICAgaGFuZGxlQmx1cjogdGhpcy5oYW5kbGVCbHVyLFxuICAgICAgICBoYW5kbGVGb2N1czogdGhpcy5oYW5kbGVGb2N1cyxcbiAgICAgICAgaGFuZGxlUmVjYXB0Y2hhQ2hhbmdlOiB0aGlzLmhhbmRsZVJlY2FwdGNoYUNoYW5nZVxuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgLy8gQW55IG1ldGhvZCB0aGF0IGlzIGNhbGxlZCBieSB0aGUgY29uc3RydWN0b3IgYW5kIHNob3VsZCBvbmx5XG4gIC8vIGJlIHVzZWQgd2l0aGluIHRoZSBjb25zdHJ1Y3RvciBpcyBwcmVmYWNlZCB3aXRoIGFuIF9cbiAgX2NyZWF0ZU5ld0Zvcm1GaWVsZE9uU3RhdGUgPSAoZmllbGQpID0+IHtcbiAgICBjb25zdCBmaWVsZHMgPSB0aGlzLnN0YXRlLmZpZWxkcztcbiAgICBjb25zdCBmaWVsZE5hbWVzID0gdGhpcy5zdGF0ZS5maWVsZE5hbWVzO1xuXG4gICAgLy8gY29weSB0aGUgZnJvemVuIHByb3BzIG9iamVjdFxuICAgIGxldCBvYmogPSB7fTtcbiAgICBmb3IgKGxldCBrZXkgaW4gZmllbGQpIHtcbiAgICAgIGlmIChmaWVsZC5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgIG9ialtrZXldID0gZmllbGRba2V5XTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB1cGRhdGUgc29tZSBkZWZhdWx0c1xuICAgIG9iai5yZWFzb24gPSBmaWVsZC5yZWFzb24gfHwgJyc7XG4gICAgb2JqLmVycm9yVHlwZSA9IGZpZWxkLmVycm9yVHlwZSB8fCAnJztcbiAgICBvYmoudmFsdWUgPSBmaWVsZC52YWx1ZSB8fCAnJztcbiAgICBvYmoudmFsaWRhdGlvbnMgPSBmaWVsZC52YWxpZGF0aW9ucyB8fCBbXTtcbiAgICBvYmouYmx1cnJlZCA9IGZpZWxkLmJsdXJyZWQgfHwgdHJ1ZTtcbiAgICBvYmouZm9jdXNlZCA9IGZpZWxkLmZvY3VzZWQgfHwgZmFsc2U7XG4gICAgb2JqLmZpcnN0Qmx1ciA9IGZpZWxkLmZpcnN0Qmx1ciB8fCBmYWxzZTtcbiAgICBvYmouaGlkZVJlYWN0aXZlVW50aWxGaXJzdEJsdXIgPSBmaWVsZC5maXJzdEJsdXIgfHwgZmFsc2U7XG4gICAgb2JqLmRlZmF1bHRFcnJvck1lc3NhZ2UgPSBmaWVsZC5kZWZhdWx0RXJyb3JNZXNzYWdlIHx8ICcnO1xuXG4gICAgLy8gYWRkIHRoZSBuZXcgcHJvcHMgb2JqZWN0XG4gICAgZmllbGRzW2ZpZWxkLmZpZWxkTmFtZV0gPSBvYmo7XG5cbiAgICAvLyBhZGQgdGhlIGZpZWxkTmFtZXMgdG8gdGhlIHRvcCBsaXN0XG4gICAgZmllbGROYW1lcy5wdXNoKGZpZWxkLmZpZWxkTmFtZSk7XG4gICAgLy8gYWRkIHRoZSB2YWxpZGF0aW9ucyB0byB0aGUgdG9wIGxpc3RcbiAgICBmaWVsZC52YWxpZGF0aW9ucy5mb3JFYWNoKHYgPT5cbiAgICAgIHRoaXMuc3RhdGUudmFsaWRhdGlvbnMucHVzaCh2KSk7XG5cbiAgICB0aGlzLnN0YXRlLmZpZWxkcyA9IGZpZWxkcztcbiAgICB0aGlzLnN0YXRlLmZpZWxkTmFtZXMgPSBmaWVsZE5hbWVzO1xuICB9O1xuXG4gIGFkZEZpZWxkT3JGb3JtRXJyb3IgPSAoZXJyKSA9PiB7XG4gICAgaWYgKHRoaXMuc3RhdGUuZmllbGROYW1lcy5pbmNsdWRlcyhlcnIuZXJyb3IpKSB7XG4gICAgICBsZXQgZmllbGRzID0gdGhpcy5zdGF0ZS5maWVsZHM7XG4gICAgICBmaWVsZHNbZXJyLmVycm9yXS5yZWFzb24gPSBlcnIucmVhc29uO1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGZpZWxkcyB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yTWVzc2FnZTogZXJyLnJlYXNvbiB9KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIENoZWNrcyB3aGV0aGVyIG9yIG5vdCB0aGUgZm9ybSBpcyB2YWxpZFxuICAgKi9cbiAgY2hlY2tGb3JtU3RhZ2UgPSAoKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHN0YWdlOiAndmFsaWQnIH0pO1xuICAgIGlmICh0aGlzLnN0YXRlLmVycm9yTWVzc2FnZSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IHN0YWdlOiAnaW52YWxpZCcgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc3RhdGUuZmllbGROYW1lcy5mb3JFYWNoKGYgPT4ge1xuICAgICAgICBpZiAoSC5maWVsZElzSW52YWxpZCh0aGlzLnN0YXRlLmZpZWxkc1tmXSkpIHtcbiAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgc3RhZ2U6ICdpbnZhbGlkJyB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIC8vIElmIGZvcm0gaGFzIGEgcmVjYXB0Y2hhIGJ1dCBubyB0b2tlbiwgaXQncyBub3QgcmVhZHlcbiAgICBpZiAodGhpcy5zdGF0ZS5yZWNhcHRjaGFGb3JtICYmICF0aGlzLnN0YXRlLnJlY2FwdGNoYVRva2VuKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgc3RhZ2U6ICdpbnZhbGlkJyB9KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAgICogU2V0dGluZyB1cCBvdXIgbG9jYWwgZXZlbnQgaGFuZGxlcnNcbiAgICpcbiAgICovXG5cbiAgLyoqXG4gICAqIEZvciBub3cgZXZlcnkgUmVhY3RpdmVJbnB1dCBmaWVsZCB3aWxsIGZsb3cgdGhyb3VnaCB0aGlzIGhhbmRsZUNoYW5nZVxuICAgKiBldmVudCBoYW5kbGVyLiBUaGlzIHdpbGwgYWxzbyBwcm9jZXNzIGFueSB2YWxpZGF0aW9uIGhvb2tzIHBhc3NlZCBpbiB0aGVcbiAgICogYXJyYXkgb2YgcHJvcHMuIEZ1bmN0aW9ucyBwYXNzZWQgaW4gd2lsbCBiZSB0cmVhdGVkIGFzIHN1Y2gsIHdoaWxlIHN0cmluZ3NcbiAgICogcGFzc2VkIGluIHRvIHRoZSBhcnJheSBvZiB2YWxpZGF0aW9ucyBhcmUgdG8gYmUgdHJlYXRlZCBhcyBtZXRlb3IgbWV0aG9kcy5cbiAgICpcbiAgICogQHBhcmFtIGZpZWxkTmFtZSAtIE5hbWUgb2YgdGhlIGZpZWxkIHdlJ3JlIHRhcmdldGluZ1xuICAgKiBAcGFyYW0gZXZlbnQgLSB0aGUgY2hhbmdlIGV2ZW50IFBhc3NlZCBpbiBhdXRvbWF0aWNhbGx5XG4gICAqL1xuICBoYW5kbGVDaGFuZ2UgPSAoZmllbGROYW1lLCBldmVudCkgPT4ge1xuICAgIC8vIFJlc2V0IHRoZSBtYWpvciBmb3JtIGVycm9yIG9uIGFueSBjaGFuZ2VcbiAgICB0aGlzLnNldFN0YXRlKHsgZXJyb3JNZXNzYWdlOiAnJyB9KTtcbiAgICBsZXQgZmllbGRzID0gdGhpcy5zdGF0ZS5maWVsZHM7XG4gICAgbGV0IGZpZWxkID0gZmllbGRzW2ZpZWxkTmFtZV07XG4gICAgZmllbGQudmFsdWUgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgZmllbGQudG91Y2hlZCA9IHRydWU7XG5cbiAgICBpZiAoZmllbGQudmFsaWRhdGlvbnMpIHtcbiAgICAgIGZpZWxkLnZhbGlkYXRpb25zLmZvckVhY2godiA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgdiA9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgZmllbGQgPSB2KHRoaXMuc3RhdGUsIGZpZWxkTmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBmaWVsZHNbZmllbGROYW1lXSA9IGZpZWxkO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBmaWVsZHMgfSk7XG4gICAgdGhpcy5jaGVja0Zvcm1TdGFnZSgpO1xuICB9O1xuXG4gIGhhbmRsZVJlY2FwdGNoYUNoYW5nZSA9IChyZWNhcHRjaGFUb2tlbikgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoeyByZWNhcHRjaGFUb2tlbiB9KTtcbiAgICB0aGlzLmNoZWNrRm9ybVN0YWdlKCk7XG4gIH07XG5cbiAgaGFuZGxlQmx1ciA9IChmaWVsZE5hbWUsIGV2ZW50KSA9PiB7XG4gICAgY29uc3QgZmllbGRzID0gdGhpcy5zdGF0ZS5maWVsZHM7XG4gICAgY29uc3QgZmllbGQgPSBmaWVsZHNbZmllbGROYW1lXTtcbiAgICBmaWVsZC5maXJzdEJsdXIgPSB0cnVlO1xuICAgIGZpZWxkLmJsdXJyZWQgPSB0cnVlO1xuICAgIGZpZWxkLmZvY3VzZWQgPSBmYWxzZTtcbiAgICBmaWVsZHNbZmllbGROYW1lXSA9IGZpZWxkO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBmaWVsZHMgfSk7XG4gIH07XG5cbiAgaGFuZGxlRm9jdXMgPSAoZmllbGROYW1lLCBldmVudCkgPT4ge1xuICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuc3RhdGUuZmllbGRzO1xuICAgIGNvbnN0IGZpZWxkID0gZmllbGRzW2ZpZWxkTmFtZV07XG4gICAgZmllbGQuYmx1cnJlZCA9IGZhbHNlO1xuICAgIGZpZWxkLmZvY3VzZWQgPSB0cnVlO1xuICAgIGZpZWxkc1tmaWVsZE5hbWVdID0gZmllbGQ7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGZpZWxkcyB9KTtcbiAgfTtcblxuICBoYW5kbGVGb3JtU3VibWl0ID0gKGV2ZW50KSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgc3RhZ2U6ICd3YWl0aW5nJywgZXJyb3JNZXNzYWdlOiAnJyB9KTtcbiAgICAvLyBUT0RPOiBIQU5ETEUgRk9STSBTVUJNSVNTSU9OXG4gICAgLy8gTWV0ZW9yLmNhbGwodGhpcy5wcm9wcy5vblN1Ym1pdCwgdGhpcy5zdGF0ZSwgKGVyciwgcmVzKSA9PiB7XG4gICAgLy8gICBpZiAoZXJyKSB7XG4gICAgLy8gICAgIHRoaXMuYWRkRmllbGRPckZvcm1FcnJvcihlcnIpO1xuICAgIC8vICAgfSBlbHNlIHtcbiAgICAvLyAgICAgLy8gZG8gdGhlIG9uIHN1Y2Nlc3Mgc3R1ZmZcbiAgICAvLyAgICAgdGhpcy5wcm9wcy5vblN1Y2Nlc3ModGhpcy5zdGF0ZSwgKGVyciwgZGVmYXVsdE1zZyA9ICcnKSA9PiB7XG4gICAgLy8gICAgICAgaWYgKGVycikge1xuICAgIC8vICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7IGVycm9yTWVzc2FnZTogZGVmYXVsdE1zZyB8fCBlcnIucmVhc29uIH0pO1xuICAgIC8vICAgICAgIH1cbiAgICAvLyAgICAgfSk7XG4gICAgLy8gICB9XG4gICAgLy8gICB0aGlzLmNoZWNrRm9ybVN0YWdlKCk7XG4gICAgLy8gfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIElmIHNpbXVsYXRlTG9uZ1Jlc3BvbnNlIGlzIGFjdGl2ZSwgdGhpcyB3aWxsIHBhdXNlIGV4ZWN1dGlvbiBvZlxuICAgKiBoYW5kbGVGb3JtU3VibWl0XG4gICAqIEBwYXJhbSBldmVudFxuICAgKi9cbiAgcGF1c2VIYW5kbGVGb3JtU3VibWl0ID0gKGV2ZW50KSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgc3RhZ2U6ICd3YWl0aW5nJyB9KTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlRm9ybVN1Ym1pdChldmVudCksXG4gICAgICB0aGlzLnByb3BzLnNpbXVsYXRlTG9uZ1Jlc3BvbnNlKTtcbiAgfTtcblxuICByZW5kZXIgPSAoKSA9PiB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxmb3JtXG4gICAgICAgIG9uU3VibWl0PXsodGhpcy5wcm9wcy5zaW11bGF0ZUxvbmdSZXNwb25zZSkgPyB0aGlzLnBhdXNlSGFuZGxlRm9ybVN1Ym1pdCA6IHRoaXMuaGFuZGxlRm9ybVN1Ym1pdH0+XG4gICAgICAgIHt0aGlzLnByb3BzLmNoaWxkcmVufVxuICAgICAgPC9mb3JtPlxuICAgIClcbiAgfTtcbn0iXX0=