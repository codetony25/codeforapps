'use strict';exports.__esModule=true;var _assign=require('babel-runtime/core-js/object/assign');var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _jsxFileName='components/pages/EditorPage/MainEditor/MainEditor.jsx';var _lodash=require('lodash');var _react=require('react');var _react2=_interopRequireDefault(_react);var _draftJs=require('draft-js');var _everlib_editor=require('../../../../core/modules/everlib_editor');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MainEditor=function(_React$Component){(0,_inherits3.default)(MainEditor,_React$Component);function MainEditor(props){(0,_classCallCheck3.default)(this,MainEditor);var _this=(0,_possibleConstructorReturn3.default)(this,(MainEditor.__proto__||(0,_getPrototypeOf2.default)(MainEditor)).call(this,props));_this.componentDidMount=function(){return _this.__componentDidMount__REACT_HOT_LOADER__.apply(_this,arguments)};_this.shouldComponentUpdate=function(){return _this.__shouldComponentUpdate__REACT_HOT_LOADER__.apply(_this,arguments)};_this.componentWillUnmount=function(){return _this.__componentWillUnmount__REACT_HOT_LOADER__.apply(_this,arguments)};_this.onWindowResize=function(){return _this.__onWindowResize__REACT_HOT_LOADER__.apply(_this,arguments)};_this.onChange=function(){return _this.__onChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.debouncedSave=(0,_lodash.debounce)(function(draft){return _this.props.methods.saveDraft(draft)},_this.milliSecondsToSave);_this.handleChapterTitleChange=function(){return _this.__handleChapterTitleChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleMainContentToggleStyles=function(){return _this.__handleMainContentToggleStyles__REACT_HOT_LOADER__.apply(_this,arguments)};console.log(props.book.draft.chapters[props.selectedChapter].text);_this.displayName='MainEditor';_this.initialText=(0,_draftJs.convertFromRaw)(props.book.draft.chapters[props.selectedChapter].text);_this.state={titleValue:props.book.draft.chapters[props.selectedChapter].title,isToolbarHidden:false,browserWidth:'',editorState:_draftJs.EditorState.createWithContent(_this.initialText)};_this.mediaQueryLargeWidth=992;_this.milliSecondsToSave=3000;_this.maxChapterTitleLength=100;return _this}(0,_createClass3.default)(MainEditor,[{key:'__componentDidMount__REACT_HOT_LOADER__',value:function __componentDidMount__REACT_HOT_LOADER__(){return this.__componentDidMount__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__componentDidMount__REACT_HOT_LOADER__',value:function __componentDidMount__REACT_HOT_LOADER__(){var bookMainElement=this.refs.bookMainContent;if(window.innerWidth<=this.mediaQueryLargeWidth){bookMainElement.style.left='0px'}window.addEventListener('resize',this.onWindowResize)}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){if(this.props.selectedChapter!==nextProps.selectedChapter){var newText=(0,_draftJs.convertFromRaw)(nextProps.book.draft.chapters[nextProps.selectedChapter].text);this.setState({editorState:_draftJs.EditorState.createWithContent(newText),titleValue:nextProps.book.draft.chapters[nextProps.selectedChapter].title})}}},{key:'__shouldComponentUpdate__REACT_HOT_LOADER__',value:function __shouldComponentUpdate__REACT_HOT_LOADER__(){return this.__shouldComponentUpdate__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__shouldComponentUpdate__REACT_HOT_LOADER__',value:function __shouldComponentUpdate__REACT_HOT_LOADER__(nextProps,nextState){return this.props.selectedChapter!==nextProps.selectedChapter||this.state.editorState!==nextState.editorState||this.state.titleValue!==nextState.titleValue||this.props.settings!==nextProps.settings||this.props.isToolbarHidden!==nextState.isToolbarHidden}},{key:'__componentWillUnmount__REACT_HOT_LOADER__',value:function __componentWillUnmount__REACT_HOT_LOADER__(){return this.__componentWillUnmount__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__componentWillUnmount__REACT_HOT_LOADER__',value:function __componentWillUnmount__REACT_HOT_LOADER__(){window.removeEventListener('resize',this.onWindowResize)}},{key:'__onWindowResize__REACT_HOT_LOADER__',value:function __onWindowResize__REACT_HOT_LOADER__(){return this.__onWindowResize__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__onWindowResize__REACT_HOT_LOADER__',value:function __onWindowResize__REACT_HOT_LOADER__(){var lessThanInnerWidth=window.innerWidth<=this.mediaQueryLargeWidth,moreThanInnerWidth=window.innerWidth>=this.mediaQueryLargeWidth,isSidebarHidden=this.props.settings.isSidebarContentHidden;if(lessThanInnerWidth){this.refs.bookMainContent.style.left='0px'}else if(moreThanInnerWidth&&isSidebarHidden){this.refs.bookMainContent.style.left='80px'}else if(moreThanInnerWidth&&!isSidebarHidden){this.refs.bookMainContent.style.left='330px'}}},{key:'__onChange__REACT_HOT_LOADER__',value:function __onChange__REACT_HOT_LOADER__(){return this.__onChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__onChange__REACT_HOT_LOADER__',value:function __onChange__REACT_HOT_LOADER__(editorState){console.log('book_edit_main_content onChange');console.log('CHANGING EDITOR STATE');this.setState({editorState:editorState});var draft=this.props.book.draft;draft.chapters[this.props.selectedChapter].text=(0,_draftJs.convertToRaw)(editorState.getCurrentContent());this.debouncedSave(draft)}},{key:'__handleChapterTitleChange__REACT_HOT_LOADER__',value:function __handleChapterTitleChange__REACT_HOT_LOADER__(){return this.__handleChapterTitleChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleChapterTitleChange__REACT_HOT_LOADER__',value:function __handleChapterTitleChange__REACT_HOT_LOADER__(event){var title=event.target.value;if(title.length>=this.maxChapterTitleLength){title=title.slice(0,this.maxChapterTitleLength)}if(!title.length){title='Chapter Title'}this.setState({titleValue:title});var draft=this.props.book.draft;draft.chapters[this.props.selectedChapter].title=title;this.debouncedSave(draft)}},{key:'__handleMainContentToggleStyles__REACT_HOT_LOADER__',value:function __handleMainContentToggleStyles__REACT_HOT_LOADER__(){return this.__handleMainContentToggleStyles__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleMainContentToggleStyles__REACT_HOT_LOADER__',value:function __handleMainContentToggleStyles__REACT_HOT_LOADER__(){return(0,_assign2.default)({},this.props.settings.isSidebarContentHidden?{left:80}:{left:330})}},{key:'render',value:function render(){var _this2=this;console.log('Rendering in MainEditor');var currentContent=(0,_draftJs.convertToRaw)(this.state.editorState.getCurrentContent());console.log(currentContent);return _react2.default.createElement('div',{ref:'bookMainContent',style:this.handleMainContentToggleStyles(),className:'main-editor-container',__source:{fileName:_jsxFileName,lineNumber:181}},_react2.default.createElement(_everlib_editor.EverLibToolbar,{book:this.props.book,selectedChapter:this.props.selectedChapter,settings:this.props.settings,methods:this.props.methods,handleChange:function handleChange(editorState){return _this2.onChange(editorState)},editorState:this.state.editorState,editor:this.handleEditor,__source:{fileName:_jsxFileName,lineNumber:185}}),_react2.default.createElement('div',{ref:'bookMainContainer',className:'book-edit-main-container',__source:{fileName:_jsxFileName,lineNumber:194}},_react2.default.createElement('div',{className:'chapter-title-container',__source:{fileName:_jsxFileName,lineNumber:197}},_react2.default.createElement('input',{className:'main-content-chapter-title-input',type:'text',value:this.state.titleValue,onChange:this.handleChapterTitleChange,__source:{fileName:_jsxFileName,lineNumber:198}})),_react2.default.createElement(_everlib_editor.EverLibEditor,{handleChange:function handleChange(editorState){return _this2.onChange(editorState)},editorState:this.state.editorState,__source:{fileName:_jsxFileName,lineNumber:205}})),_react2.default.createElement(_everlib_editor.EverLibEditorStats,{book:this.props.book,selectedChapter:this.props.selectedChapter,settings:this.props.settings,methods:this.props.methods,__source:{fileName:_jsxFileName,lineNumber:210}}))}}]);return MainEditor}(_react2.default.Component);var _default=MainEditor;exports.default=_default;;var _temp=function(){if(typeof __REACT_HOT_LOADER__==='undefined'){return}__REACT_HOT_LOADER__.register(MainEditor,'MainEditor','components/pages/EditorPage/MainEditor/MainEditor.jsx');__REACT_HOT_LOADER__.register(_default,'default','components/pages/EditorPage/MainEditor/MainEditor.jsx')}();;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1haW5FZGl0b3IuanN4Il0sIm5hbWVzIjpbIk1haW5FZGl0b3IiLCJwcm9wcyIsImNvbXBvbmVudERpZE1vdW50Iiwic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJvbldpbmRvd1Jlc2l6ZSIsIm9uQ2hhbmdlIiwiZGVib3VuY2VkU2F2ZSIsImRyYWZ0IiwibWV0aG9kcyIsInNhdmVEcmFmdCIsIm1pbGxpU2Vjb25kc1RvU2F2ZSIsImhhbmRsZUNoYXB0ZXJUaXRsZUNoYW5nZSIsImhhbmRsZU1haW5Db250ZW50VG9nZ2xlU3R5bGVzIiwiY29uc29sZSIsImxvZyIsImJvb2siLCJjaGFwdGVycyIsInNlbGVjdGVkQ2hhcHRlciIsInRleHQiLCJkaXNwbGF5TmFtZSIsImluaXRpYWxUZXh0Iiwic3RhdGUiLCJ0aXRsZVZhbHVlIiwidGl0bGUiLCJpc1Rvb2xiYXJIaWRkZW4iLCJicm93c2VyV2lkdGgiLCJlZGl0b3JTdGF0ZSIsImNyZWF0ZVdpdGhDb250ZW50IiwibWVkaWFRdWVyeUxhcmdlV2lkdGgiLCJtYXhDaGFwdGVyVGl0bGVMZW5ndGgiLCJib29rTWFpbkVsZW1lbnQiLCJyZWZzIiwiYm9va01haW5Db250ZW50Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsInN0eWxlIiwibGVmdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJuZXh0UHJvcHMiLCJuZXdUZXh0Iiwic2V0U3RhdGUiLCJuZXh0U3RhdGUiLCJzZXR0aW5ncyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJsZXNzVGhhbklubmVyV2lkdGgiLCJtb3JlVGhhbklubmVyV2lkdGgiLCJpc1NpZGViYXJIaWRkZW4iLCJpc1NpZGViYXJDb250ZW50SGlkZGVuIiwiZ2V0Q3VycmVudENvbnRlbnQiLCJldmVudCIsInRhcmdldCIsInZhbHVlIiwibGVuZ3RoIiwic2xpY2UiLCJjdXJyZW50Q29udGVudCIsImhhbmRsZUVkaXRvciIsIkNvbXBvbmVudCJdLCJtYXBwaW5n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RSxLQUFLLE1BRlAsQ0FHRSxNQUFPLEtBQUtsQyxLQUFMLENBQVdDLFVBSHBCLENBSUUsU0FBVSxLQUFLWCx3QkFKakIsa0RBREYsQ0FIRixDQVdFLDZEQUNFLGFBQWMsc0JBQUNlLFdBQUQsUUFBaUIsUUFBS3JCLFFBQUwsQ0FBY3FCLFdBQWQsQ0FBakIsQ0FEaEIsQ0FFRSxZQUFhLEtBQUtMLEtBQUwsQ0FBV0ssV0FGMUIsa0RBWEYsQ0FiRixDQTZCRSxrRUFDRSxLQUFNLEtBQUsxQixLQUFMLENBQVdlLElBRG5CLENBRUUsZ0JBQWlCLEtBQUtmLEtBQUwsQ0FBV2lCLGVBRjlCLENBR0UsU0FBVSxLQUFLakIsS0FBTCxDQUFXMEMsUUFIdkIsQ0FJRSxRQUFTLEtBQUsxQyxLQUFMLENBQVdRLE9BSnRCLGtEQTdCRixDQXFDSCxDLHVCQS9Nc0IsZ0JBQU1nRCxTLGVBbU5oQnpELFUsbUlBbk5UQSxVIiwiZmlsZSI6Ik1haW5FZGl0b3IuanN4Iiwic291cmNlUm9vdCI6Ii9Vc2Vycy90b255bmd1eWVuL0lkZWFQcm9qZWN0cy9jb2RlZm9yYXBwcy90b29scyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlYm91bmNlIH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBFZGl0b3JTdGF0ZSwgY29udmVydFRvUmF3LCBjb252ZXJ0RnJvbVJhdyB9IGZyb20gJ2RyYWZ0LWpzJztcblxuaW1wb3J0IHtcbiAgRXZlckxpYkVkaXRvcixcbiAgRXZlckxpYlRvb2xiYXIsXG4gIEV2ZXJMaWJFZGl0b3JTdGF0c1xufSBmcm9tICcuLi8uLi8uLi8uLi9jb3JlL21vZHVsZXMvZXZlcmxpYl9lZGl0b3InO1xuXG5jbGFzcyBNYWluRWRpdG9yIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIC8vIFRPRE86IEhhdmUgdG8gY29udmVydCB0aGUgdGV4dCBzdG9yZWRcbiAgICAvLyBUT0RPOiBpbiB0aGUgZGF0YWJhc2UgdG8gdGhlIGluaXRpYWwgZWRpdG9yIHN0YXRlXG4gICAgY29uc29sZS5sb2cocHJvcHMuYm9vay5kcmFmdC5jaGFwdGVyc1twcm9wcy5zZWxlY3RlZENoYXB0ZXJdLnRleHQpO1xuXG4gICAgdGhpcy5kaXNwbGF5TmFtZSA9ICdNYWluRWRpdG9yJztcbiAgICB0aGlzLmluaXRpYWxUZXh0ID1cbiAgICAgIGNvbnZlcnRGcm9tUmF3KHByb3BzLmJvb2suZHJhZnQuY2hhcHRlcnNbcHJvcHMuc2VsZWN0ZWRDaGFwdGVyXS50ZXh0KTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICB0aXRsZVZhbHVlOiBwcm9wcy5ib29rLmRyYWZ0LmNoYXB0ZXJzW3Byb3BzLnNlbGVjdGVkQ2hhcHRlcl0udGl0bGUsXG4gICAgICBpc1Rvb2xiYXJIaWRkZW46IGZhbHNlLFxuICAgICAgYnJvd3NlcldpZHRoOiAnJyxcbiAgICAgIGVkaXRvclN0YXRlOiBFZGl0b3JTdGF0ZS5jcmVhdGVXaXRoQ29udGVudChcbiAgICAgICAgdGhpcy5pbml0aWFsVGV4dFxuICAgICAgKVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBNZWRpdW0gTWVkaWEgUXVlcnkgdG8ga2VlcCB0cmFjayBvZiByZXNpemluZyBhbmQgd2hlbiB0aGVcbiAgICAgKiBjb21wb25lbnQgaXMgbW91bnRlZCBUbyBzaG93IHRoZSBjb3JyZWN0IG1haW4gY29udGVudCB3aWR0aFxuICAgICAqL1xuICAgIHRoaXMubWVkaWFRdWVyeUxhcmdlV2lkdGggPSA5OTI7XG5cbiAgICB0aGlzLm1pbGxpU2Vjb25kc1RvU2F2ZSA9IDMwMDA7XG4gICAgdGhpcy5tYXhDaGFwdGVyVGl0bGVMZW5ndGggPSAxMDA7XG5cbiAgfVxuXG4gIC8qKlxuICAgKiBXaGVuIHRoZSBjb21wb25lbnQgaXMgbW91bnRlZCwgaXQgd2lsbCBzZWUgaWYgdGhlIGJyb3dzZXIgd2lkdGggaXMgbGVzc1xuICAgKiB0aGFuIGxlc3MgdGhhbiA3NjgsIGFuZCBpZiBpdCBpcywgdGhlbiBpdCB3aWxsIHNoaWZ0IHRoZSBtYWluIGNvbnRlbnRcbiAgICogYWxsIHRoZSB3YXkgdG8gdGhlIGxlZnQgb24gaXRzIGluaXRpYWwgbG9hZC4gSXQgd2lsbCBhbHNvIGFkZCB0aGVcbiAgICogcmVzaXppbmcgZXZlbnQgbGlzdGVuZXIuXG4gICAqL1xuICBjb21wb25lbnREaWRNb3VudCA9ICgpID0+IHtcbiAgICBjb25zdCBib29rTWFpbkVsZW1lbnQgPSB0aGlzLnJlZnMuYm9va01haW5Db250ZW50O1xuXG4gICAgaWYgKHdpbmRvdy5pbm5lcldpZHRoIDw9IHRoaXMubWVkaWFRdWVyeUxhcmdlV2lkdGgpIHtcbiAgICAgIGJvb2tNYWluRWxlbWVudC5zdHlsZS5sZWZ0ID0gJzBweCc7XG4gICAgfVxuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMub25XaW5kb3dSZXNpemUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBXZSBhcmUgY3VycmVudGx5IG5vdCB0eWluZyB0aGUgY2hhbmdlcyB0byB0aGUgdGV4dCBhcmVhIHRvIGRhdGFiYXNlXG4gICAqIGNoYW5nZXMuIFRoaXMgaXMgYmVjYXVzZSBpdCdzIHF1aWNrZXIgdG8gc2ltcGx5IGtlZXAgdHJhY2sgb2YgdGhlIHRleHRcbiAgICogaW4gc3RhdGUgYW5kIGhhdmUgYSBzdHViIGdvIG9mZiBhbmQgaGFuZGxlIHRoZSBkYXRhYmFzZSBzYXZpbmcuIEhvd2V2ZXIsXG4gICAqIHN3aXRjaGluZyBiZXR3ZWVuIGNoYXB0ZXJzIGlzIGEgZ29vZCB0aW1lIHRvIGdyYWIgdGhlIGN1cnJlbnQgdmFsdWUgb2ZcbiAgICogdGhhdCB0ZXh0IGZyb20gdGhlIGRhdGFiYXNlICh0aGUgYm9vayBwcm9wcyBvYmplY3QpXG4gICAqL1xuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmICh0aGlzLnByb3BzLnNlbGVjdGVkQ2hhcHRlciAhPT0gbmV4dFByb3BzLnNlbGVjdGVkQ2hhcHRlcikge1xuXG4gICAgICAvLyBHZXQgdGhlIG5ldyBjaGFwdGVycyB0ZXh0IGFuZCBjb252ZXJ0IGl0IGZyb20gaXQncyByYXcgZm9ybVxuICAgICAgY29uc3QgbmV3VGV4dCA9IGNvbnZlcnRGcm9tUmF3KFxuICAgICAgICBuZXh0UHJvcHMuYm9vay5kcmFmdC5jaGFwdGVyc1tuZXh0UHJvcHMuc2VsZWN0ZWRDaGFwdGVyXS50ZXh0XG4gICAgICApO1xuXG4gICAgICAvLyBTZXQgdGhlIG5ldyBjb250ZW50IG9uIHRvIHN0YXRlXG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgZWRpdG9yU3RhdGU6IEVkaXRvclN0YXRlLmNyZWF0ZVdpdGhDb250ZW50KG5ld1RleHQpLFxuICAgICAgICB0aXRsZVZhbHVlOiBuZXh0UHJvcHMuYm9vay5kcmFmdFxuICAgICAgICAgIC5jaGFwdGVyc1tuZXh0UHJvcHMuc2VsZWN0ZWRDaGFwdGVyXS50aXRsZVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEJlY2F1c2Ugb3VyIGNvbXBvbmVudCBpcyByZWNlaXZpbmcgbXVsdGlwbGUgcHJvcHMsXG4gICAqICB3ZSBvbmx5IHdhbnQgdG8gdXBkYXRlIGl0IGluIGEgZmV3IGNhc2VzLlxuICAgKiAgSWYgYW55IG9mIHRoZSBmb2xsb3dpbmcgYXJlIHRydWU6XG4gICAqIDEpIFRoZSBjdXJyZW50IHNlbGVjdGVkIGNoYXB0ZXIgaGFzIGNoYW5nZWQuXG4gICAqIDIpIFRoZSB2YWx1ZSBvZiBzdGF0ZS50ZXh0VmFsdWUgaGFzIGNoYW5nZWQgLVxuICAgKiAgIE5vdGU6IFdlIHdpbGwgb25seSBiZSBwdWxsaW5nIGluIHRoZSB0ZXh0IHZhbHVlIG9mIGEgY2hhcHRlciBmcm9tIHRoZVxuICAgKiAgICAgICAgIGRhdGFiYXNlIG9uIGluaXRpYWwgbG9hZCBvciB3aGVuIGEgbmV3IGNoYXB0ZXIgaXMgc2VsZWN0ZWQuXG4gICAqICAgICAgICAgVGhpcyBpcyB0byBtYWtlIHN1cmUgdGhlcmUgYXJlIG5vIGJhY2sgYW5kIGZvcnRoIGlzc3Vlc1xuICAgKiAgICAgICAgIHdpdGggcmVhY3RpdmUgZGF0YSBvdmVyd3JpdGluZyB0aGUgdGV4dCB0aGF0J3MgYmVpbmcgdHlwZWQuXG4gICAqIDMpIFNldHRpbmdzIHRvIHRoZSBwYWdlIGhhdmUgY2hhbmdlZFxuICAgKlxuICAgKiBEb24ndCBiZSBhbGFybWVkIGJ5IHRoZSB0cmlwZSBlcXVhbGl0eSBjaGVjayBjb21wYXJpbmcgdGhlIHByb3BzLnNldHRpbmdzXG4gICAqIG9iamVjdCB0byB0aGUgbmV4dFByb3BzLnNldHRpbmdzIG9iamVjdC4gVGhpcyBhY3R1YWxseSB3b3JrcyBmb3IgcHJvcFxuICAgKiBvYmplY3RzIGluIHJlYWN0LlxuICAgKi9cbiAgc2hvdWxkQ29tcG9uZW50VXBkYXRlID0gKG5leHRQcm9wcywgbmV4dFN0YXRlKSA9PiB7XG4gICAgcmV0dXJuICgodGhpcy5wcm9wcy5zZWxlY3RlZENoYXB0ZXIgIT09IG5leHRQcm9wcy5zZWxlY3RlZENoYXB0ZXIpIHx8XG4gICAgKHRoaXMuc3RhdGUuZWRpdG9yU3RhdGUgIT09IG5leHRTdGF0ZS5lZGl0b3JTdGF0ZSkgfHxcbiAgICAodGhpcy5zdGF0ZS50aXRsZVZhbHVlICE9PSBuZXh0U3RhdGUudGl0bGVWYWx1ZSkgfHxcbiAgICAodGhpcy5wcm9wcy5zZXR0aW5ncyAhPT0gbmV4dFByb3BzLnNldHRpbmdzKSB8fFxuICAgICh0aGlzLnByb3BzLmlzVG9vbGJhckhpZGRlbiAhPT0gbmV4dFN0YXRlLmlzVG9vbGJhckhpZGRlbikpO1xuICB9O1xuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50ID0gKCkgPT4ge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uV2luZG93UmVzaXplKTtcbiAgfTtcblxuICAvKipcbiAgICogT24gd2luZG93IHJlLXNpemluZywgdGhlIG1haW4gY29udGVudCB3aWxsIHNoaWZ0IHRoZSBhbW91bnQgb2YgcGl4ZWxzXG4gICAqIHRvIHRoZSBsZWZ0IGRlcGVuZGluZyBvbiB0aGUgbWVkaWEgcXVlcnkgd2lkdGggb2YgNzY4IGFuZCBhbHNvIGlmXG4gICAqIHRoZSBzaWRlYmFyIGNvbnRlbnQgaGFzIGJlZW4gdG9nZ2xlZCBvciBub3QuXG4gICAqL1xuICBvbldpbmRvd1Jlc2l6ZSA9ICgpID0+IHtcbiAgICBjb25zdCBsZXNzVGhhbklubmVyV2lkdGggPSAod2luZG93LmlubmVyV2lkdGggPD0gdGhpcy5tZWRpYVF1ZXJ5TGFyZ2VXaWR0aCksXG4gICAgICBtb3JlVGhhbklubmVyV2lkdGggPSAod2luZG93LmlubmVyV2lkdGggPj0gdGhpcy5tZWRpYVF1ZXJ5TGFyZ2VXaWR0aCksXG4gICAgICBpc1NpZGViYXJIaWRkZW4gPSB0aGlzLnByb3BzLnNldHRpbmdzLmlzU2lkZWJhckNvbnRlbnRIaWRkZW47XG5cbiAgICBpZiAobGVzc1RoYW5Jbm5lcldpZHRoKSB7XG4gICAgICB0aGlzLnJlZnMuYm9va01haW5Db250ZW50LnN0eWxlLmxlZnQgPSAnMHB4JztcbiAgICB9IGVsc2UgaWYgKG1vcmVUaGFuSW5uZXJXaWR0aCAmJiBpc1NpZGViYXJIaWRkZW4pIHtcbiAgICAgIHRoaXMucmVmcy5ib29rTWFpbkNvbnRlbnQuc3R5bGUubGVmdCA9ICc4MHB4JztcbiAgICB9IGVsc2UgaWYgKG1vcmVUaGFuSW5uZXJXaWR0aCAmJiAhaXNTaWRlYmFySGlkZGVuKSB7XG4gICAgICB0aGlzLnJlZnMuYm9va01haW5Db250ZW50LnN0eWxlLmxlZnQgPSAnMzMwcHgnO1xuICAgIH1cbiAgfTtcblxuICAvLyBUT0RPOiBOZWVkcyB0byBiZSB1cGRhdGVkXG4gIC8vIFRPRE86IFRoaXMgaXMgd2hlcmUgdGhlIGRiIHNhdmluZyBjaGFpbiB3b3VsZCBzdGFydFxuICBvbkNoYW5nZSA9IChlZGl0b3JTdGF0ZSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdib29rX2VkaXRfbWFpbl9jb250ZW50IG9uQ2hhbmdlJyk7XG4gICAgY29uc29sZS5sb2coJ0NIQU5HSU5HIEVESVRPUiBTVEFURScpO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBlZGl0b3JTdGF0ZSB9KTtcbiAgICBjb25zdCBkcmFmdCA9IHRoaXMucHJvcHMuYm9vay5kcmFmdDtcbiAgICBkcmFmdC5jaGFwdGVyc1t0aGlzLnByb3BzLnNlbGVjdGVkQ2hhcHRlcl0udGV4dCA9XG4gICAgICBjb252ZXJ0VG9SYXcoZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKSk7XG4gICAgdGhpcy5kZWJvdW5jZWRTYXZlKGRyYWZ0KTtcbiAgfTtcblxuICAvKipcbiAgICogZGVib3VuY2UgdGhlIHNhdmluZyBvZiB0aGUgZHJhZnRcbiAgICovXG4gIGRlYm91bmNlZFNhdmUgPSBkZWJvdW5jZSgoZHJhZnQpID0+XG4gICAgdGhpcy5wcm9wcy5tZXRob2RzLnNhdmVEcmFmdChkcmFmdCksIHRoaXMubWlsbGlTZWNvbmRzVG9TYXZlKTtcblxuICBoYW5kbGVDaGFwdGVyVGl0bGVDaGFuZ2UgPSAoZXZlbnQpID0+IHtcbiAgICBsZXQgdGl0bGUgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgaWYgKHRpdGxlLmxlbmd0aCA+PSB0aGlzLm1heENoYXB0ZXJUaXRsZUxlbmd0aCkge1xuICAgICAgdGl0bGUgPSB0aXRsZS5zbGljZSgwLCB0aGlzLm1heENoYXB0ZXJUaXRsZUxlbmd0aCk7XG4gICAgfVxuICAgIGlmICghdGl0bGUubGVuZ3RoKSB7XG4gICAgICB0aXRsZSA9ICdDaGFwdGVyIFRpdGxlJztcbiAgICB9XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHRpdGxlVmFsdWU6IHRpdGxlIH0pO1xuICAgIGNvbnN0IGRyYWZ0ID0gdGhpcy5wcm9wcy5ib29rLmRyYWZ0O1xuICAgIGRyYWZ0LmNoYXB0ZXJzW3RoaXMucHJvcHMuc2VsZWN0ZWRDaGFwdGVyXS50aXRsZSA9IHRpdGxlO1xuICAgIC8vIFRPRE86IGxldCdzIGp1c3QgbWFrZSBhIHNlcGFyYXRlIHNhdmUgZm9yIGNoYXB0ZXIgdGl0bGVzXG4gICAgdGhpcy5kZWJvdW5jZWRTYXZlKGRyYWZ0KTtcbiAgfTtcblxuICAvKipcbiAgICogSGFuZGxlcyByZXNpemluZyBvZiB0aGUgbWFpbiBjb250ZW50IGRlcGVuZGluZyBvbiB3aGF0IGlzXG4gICAqIGN1cnJlbnRseSBiZWluZyB0b2dnbGVkIGJ5IG1lcmdpbmcgdGhlIGN1cnJlY3Qgc3R5bGVzXG4gICAqL1xuICBoYW5kbGVNYWluQ29udGVudFRvZ2dsZVN0eWxlcyA9ICgpID0+IHtcbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSxcbiAgICAgIHRoaXMucHJvcHMuc2V0dGluZ3MuaXNTaWRlYmFyQ29udGVudEhpZGRlbiA/IHsgbGVmdDogODAgfSA6IHsgbGVmdDogMzMwIH1cbiAgICApO1xuICB9O1xuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zb2xlLmxvZygnUmVuZGVyaW5nIGluIE1haW5FZGl0b3InKTtcbiAgICAvLyBUZXN0aW5nIGRhdGEgY29udmVyc2lvblxuICAgIGNvbnN0IGN1cnJlbnRDb250ZW50ID1cbiAgICAgIGNvbnZlcnRUb1Jhdyh0aGlzLnN0YXRlLmVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCkpO1xuICAgIGNvbnNvbGUubG9nKGN1cnJlbnRDb250ZW50KTtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICByZWY9XCJib29rTWFpbkNvbnRlbnRcIlxuICAgICAgICBzdHlsZT17dGhpcy5oYW5kbGVNYWluQ29udGVudFRvZ2dsZVN0eWxlcygpfVxuICAgICAgICBjbGFzc05hbWU9XCJtYWluLWVkaXRvci1jb250YWluZXJcIj5cbiAgICAgICAgPEV2ZXJMaWJUb29sYmFyXG4gICAgICAgICAgYm9vaz17dGhpcy5wcm9wcy5ib29rfVxuICAgICAgICAgIHNlbGVjdGVkQ2hhcHRlcj17dGhpcy5wcm9wcy5zZWxlY3RlZENoYXB0ZXJ9XG4gICAgICAgICAgc2V0dGluZ3M9e3RoaXMucHJvcHMuc2V0dGluZ3N9XG4gICAgICAgICAgbWV0aG9kcz17dGhpcy5wcm9wcy5tZXRob2RzfVxuICAgICAgICAgIGhhbmRsZUNoYW5nZT17KGVkaXRvclN0YXRlKSA9PiB0aGlzLm9uQ2hhbmdlKGVkaXRvclN0YXRlKX1cbiAgICAgICAgICBlZGl0b3JTdGF0ZT17dGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZX1cbiAgICAgICAgICBlZGl0b3I9e3RoaXMuaGFuZGxlRWRpdG9yfVxuICAgICAgICAvPlxuICAgICAgICA8ZGl2XG4gICAgICAgICAgcmVmPVwiYm9va01haW5Db250YWluZXJcIlxuICAgICAgICAgIGNsYXNzTmFtZT1cImJvb2stZWRpdC1tYWluLWNvbnRhaW5lclwiPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiY2hhcHRlci10aXRsZS1jb250YWluZXJcIj5cbiAgICAgICAgICAgIDxpbnB1dFxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJtYWluLWNvbnRlbnQtY2hhcHRlci10aXRsZS1pbnB1dFwiXG4gICAgICAgICAgICAgIHR5cGU9XCJ0ZXh0XCJcbiAgICAgICAgICAgICAgdmFsdWU9e3RoaXMuc3RhdGUudGl0bGVWYWx1ZX1cbiAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuaGFuZGxlQ2hhcHRlclRpdGxlQ2hhbmdlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8RXZlckxpYkVkaXRvclxuICAgICAgICAgICAgaGFuZGxlQ2hhbmdlPXsoZWRpdG9yU3RhdGUpID0+IHRoaXMub25DaGFuZ2UoZWRpdG9yU3RhdGUpfVxuICAgICAgICAgICAgZWRpdG9yU3RhdGU9e3RoaXMuc3RhdGUuZWRpdG9yU3RhdGV9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxFdmVyTGliRWRpdG9yU3RhdHNcbiAgICAgICAgICBib29rPXt0aGlzLnByb3BzLmJvb2t9XG4gICAgICAgICAgc2VsZWN0ZWRDaGFwdGVyPXt0aGlzLnByb3BzLnNlbGVjdGVkQ2hhcHRlcn1cbiAgICAgICAgICBzZXR0aW5ncz17dGhpcy5wcm9wcy5zZXR0aW5nc31cbiAgICAgICAgICBtZXRob2RzPXt0aGlzLnByb3BzLm1ldGhvZHN9XG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgTWFpbkVkaXRvcjtcbiJdfQ==