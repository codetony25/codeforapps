'use strict';exports.__esModule=true;var _assign=require('babel-runtime/core-js/object/assign');var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _jsxFileName='components/pages/EditorPage/MainEditor/MainEditor.jsx';var _lodash=require('lodash');var _react=require('react');var _react2=_interopRequireDefault(_react);var _draftJs=require('draft-js');var _everlib_editor=require('../../../../core/modules/everlib_editor');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MainEditor=function(_React$Component){(0,_inherits3.default)(MainEditor,_React$Component);function MainEditor(props){(0,_classCallCheck3.default)(this,MainEditor);var _this=(0,_possibleConstructorReturn3.default)(this,(MainEditor.__proto__||(0,_getPrototypeOf2.default)(MainEditor)).call(this,props));_this.componentDidMount=function(){return _this.__componentDidMount__REACT_HOT_LOADER__.apply(_this,arguments)};_this.shouldComponentUpdate=function(){return _this.__shouldComponentUpdate__REACT_HOT_LOADER__.apply(_this,arguments)};_this.componentWillUnmount=function(){return _this.__componentWillUnmount__REACT_HOT_LOADER__.apply(_this,arguments)};_this.onWindowResize=function(){return _this.__onWindowResize__REACT_HOT_LOADER__.apply(_this,arguments)};_this.onChange=function(){return _this.__onChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.debouncedSave=(0,_lodash.debounce)(function(draft){return _this.props.methods.saveDraft(draft)},_this.milliSecondsToSave);_this.handleChapterTitleChange=function(){return _this.__handleChapterTitleChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleMainContentToggleStyles=function(){return _this.__handleMainContentToggleStyles__REACT_HOT_LOADER__.apply(_this,arguments)};console.log(props.book.draft.chapters[props.selectedChapter].text);_this.displayName='MainEditor';_this.initialText=(0,_draftJs.convertFromRaw)(props.book.draft.chapters[props.selectedChapter].text);_this.state={titleValue:props.book.draft.chapters[props.selectedChapter].title,isToolbarHidden:false,browserWidth:'',editorState:_draftJs.EditorState.createWithContent(_this.initialText)};_this.mediaQueryLargeWidth=992;_this.milliSecondsToSave=3000;_this.maxChapterTitleLength=100;return _this}(0,_createClass3.default)(MainEditor,[{key:'__componentDidMount__REACT_HOT_LOADER__',value:function __componentDidMount__REACT_HOT_LOADER__(){return this.__componentDidMount__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__componentDidMount__REACT_HOT_LOADER__',value:function __componentDidMount__REACT_HOT_LOADER__(){var bookMainElement=this.refs.bookMainContent;if(window.innerWidth<=this.mediaQueryLargeWidth){bookMainElement.style.left='0px'}window.addEventListener('resize',this.onWindowResize)}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){if(this.props.selectedChapter!==nextProps.selectedChapter){var newText=(0,_draftJs.convertFromRaw)(nextProps.book.draft.chapters[nextProps.selectedChapter].text);this.setState({editorState:_draftJs.EditorState.createWithContent(newText),titleValue:nextProps.book.draft.chapters[nextProps.selectedChapter].title})}}},{key:'__shouldComponentUpdate__REACT_HOT_LOADER__',value:function __shouldComponentUpdate__REACT_HOT_LOADER__(){return this.__shouldComponentUpdate__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__shouldComponentUpdate__REACT_HOT_LOADER__',value:function __shouldComponentUpdate__REACT_HOT_LOADER__(nextProps,nextState){return this.props.selectedChapter!==nextProps.selectedChapter||this.state.editorState!==nextState.editorState||this.state.titleValue!==nextState.titleValue||this.props.settings!==nextProps.settings||this.props.isToolbarHidden!==nextState.isToolbarHidden}},{key:'__componentWillUnmount__REACT_HOT_LOADER__',value:function __componentWillUnmount__REACT_HOT_LOADER__(){return this.__componentWillUnmount__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__componentWillUnmount__REACT_HOT_LOADER__',value:function __componentWillUnmount__REACT_HOT_LOADER__(){window.removeEventListener('resize',this.onWindowResize)}},{key:'__onWindowResize__REACT_HOT_LOADER__',value:function __onWindowResize__REACT_HOT_LOADER__(){return this.__onWindowResize__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__onWindowResize__REACT_HOT_LOADER__',value:function __onWindowResize__REACT_HOT_LOADER__(){var lessThanInnerWidth=window.innerWidth<=this.mediaQueryLargeWidth,moreThanInnerWidth=window.innerWidth>=this.mediaQueryLargeWidth,isSidebarHidden=this.props.settings.isSidebarContentHidden;if(lessThanInnerWidth){this.refs.bookMainContent.style.left='0px'}else if(moreThanInnerWidth&&isSidebarHidden){this.refs.bookMainContent.style.left='80px'}else if(moreThanInnerWidth&&!isSidebarHidden){this.refs.bookMainContent.style.left='330px'}}},{key:'__onChange__REACT_HOT_LOADER__',value:function __onChange__REACT_HOT_LOADER__(){return this.__onChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__onChange__REACT_HOT_LOADER__',value:function __onChange__REACT_HOT_LOADER__(editorState){console.log('book_edit_main_content onChange');console.log('CHANGING EDITOR STATE');this.setState({editorState:editorState});var draft=this.props.book.draft;draft.chapters[this.props.selectedChapter].text=(0,_draftJs.convertToRaw)(editorState.getCurrentContent());this.debouncedSave(draft)}},{key:'__handleChapterTitleChange__REACT_HOT_LOADER__',value:function __handleChapterTitleChange__REACT_HOT_LOADER__(){return this.__handleChapterTitleChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleChapterTitleChange__REACT_HOT_LOADER__',value:function __handleChapterTitleChange__REACT_HOT_LOADER__(event){var title=event.target.value;if(title.length>=this.maxChapterTitleLength){title=title.slice(0,this.maxChapterTitleLength)}if(!title.length){title='Chapter Title'}this.setState({titleValue:title});var draft=this.props.book.draft;draft.chapters[this.props.selectedChapter].title=title;this.debouncedSave(draft)}},{key:'__handleMainContentToggleStyles__REACT_HOT_LOADER__',value:function __handleMainContentToggleStyles__REACT_HOT_LOADER__(){return this.__handleMainContentToggleStyles__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleMainContentToggleStyles__REACT_HOT_LOADER__',value:function __handleMainContentToggleStyles__REACT_HOT_LOADER__(){return(0,_assign2.default)({},this.props.settings.isSidebarContentHidden?{left:80}:{left:330})}},{key:'render',value:function render(){var _this2=this;console.log('Rendering in MainEditor');var currentContent=(0,_draftJs.convertToRaw)(this.state.editorState.getCurrentContent());console.log(currentContent);return _react2.default.createElement('div',{ref:'bookMainContent',style:this.handleMainContentToggleStyles(),className:'main-editor-container',__source:{fileName:_jsxFileName,lineNumber:181}},_react2.default.createElement(_everlib_editor.EverLibToolbar,{book:this.props.book,selectedChapter:this.props.selectedChapter,settings:this.props.settings,methods:this.props.methods,handleChange:function handleChange(editorState){return _this2.onChange(editorState)},editorState:this.state.editorState,editor:this.handleEditor,__source:{fileName:_jsxFileName,lineNumber:185}}),_react2.default.createElement('div',{ref:'bookMainContainer',className:'book-edit-main-container',__source:{fileName:_jsxFileName,lineNumber:194}},_react2.default.createElement('div',{className:'chapter-title-container',__source:{fileName:_jsxFileName,lineNumber:197}},_react2.default.createElement('input',{className:'main-content-chapter-title-input',type:'text',value:this.state.titleValue,onChange:this.handleChapterTitleChange,__source:{fileName:_jsxFileName,lineNumber:198}})),_react2.default.createElement(_everlib_editor.EverLibEditor,{handleChange:function handleChange(editorState){return _this2.onChange(editorState)},editorState:this.state.editorState,__source:{fileName:_jsxFileName,lineNumber:205}})),_react2.default.createElement(_everlib_editor.EverLibEditorStats,{book:this.props.book,selectedChapter:this.props.selectedChapter,settings:this.props.settings,methods:this.props.methods,__source:{fileName:_jsxFileName,lineNumber:210}}))}}]);return MainEditor}(_react2.default.Component);var _default=MainEditor;exports.default=_default;;var _temp=function(){if(typeof __REACT_HOT_LOADER__==='undefined'){return}__REACT_HOT_LOADER__.register(MainEditor,'MainEditor','components/pages/EditorPage/MainEditor/MainEditor.jsx');__REACT_HOT_LOADER__.register(_default,'default','components/pages/EditorPage/MainEditor/MainEditor.jsx')}();;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1haW5FZGl0b3IuanN4Il0sIm5hbWVzIjpbIk1haW5FZGl0b3IiLCJwcm9wcyIsImNvbXBvbmVudERpZE1vdW50Iiwic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJvbldpbmRvd1Jlc2l6ZSIsIm9uQ2hhbmdlIiwiZGVib3VuY2VkU2F2ZSIsImRyYWZ0IiwibWV0aG9kcyIsInNhdmVEcmFmdCIsIm1pbGxpU2Vjb25kc1RvU2F2ZSIsImhhbmRsZUNoYXB0ZXJUaXRsZUNoYW5nZSIsImhhbmRsZU1haW5Db250ZW50VG9nZ2xlU3R5bGVzIiwiY29uc29sZSIsImxvZyIsImJvb2siLCJjaGFwdGVycyIsInNlbGVjdGVkQ2hhcHRlciIsInRleHQiLCJkaXNwbGF5TmFtZSIsImluaXRpYWxUZXh0Iiwic3RhdGUiLCJ0aXRsZVZhbHVlIiwidGl0bGUiLCJpc1Rvb2xiYXJIaWRkZW4iLCJicm93c2VyV2lkdGgiLCJlZGl0b3JTdGF0ZSIsImNyZWF0ZVdpdGhDb250ZW50IiwibWVkaWFRdWVyeUxhcmdlV2lkdGgiLCJtYXhDaGFwdGVyVGl0bGVMZW5ndGgiLCJib29rTWFpbkVsZW1lbnQiLCJyZWZzIiwiYm9va01haW5Db250ZW50Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsInN0eWxlIiwibGVmdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJuZXh0UHJvcHMiLCJuZXdUZXh0Iiwic2V0U3RhdGUiLCJuZXh0U3RhdGUiLCJzZXR0aW5ncyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJsZXNzVGhhbklubmVyV2lkdGgiLCJtb3JlVGhhbklubmVyV2lkdGgiLCJpc1NpZGViYXJIaWRkZW4iLCJpc1NpZGViYXJDb250ZW50SGlkZGVuIiwiZ2V0Q3VycmVudENvbnRlbnQiLCJldmVudCIsInRhcmdldCIsInZhbHVlIiwibGVuZ3RoIiwic2xpY2UiLCJjdXJyZW50Q29udGVudCIsImhhbmRsZUVkaXRvciIsIkNvbXBvbmVudCJdLCJtYXBwaW5n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RSxLQUFLLE1BRlAsQ0FHRSxNQUFPLEtBQUtsQyxLQUFMLENBQVdDLFVBSHBCLENBSUUsU0FBVSxLQUFLWCx3QkFKakIsa0RBREYsQ0FIRixDQVdFLDZEQUNFLGFBQWMsc0JBQUNlLFdBQUQsUUFBaUIsUUFBS3JCLFFBQUwsQ0FBY3FCLFdBQWQsQ0FBakIsQ0FEaEIsQ0FFRSxZQUFhLEtBQUtMLEtBQUwsQ0FBV0ssV0FGMUIsa0RBWEYsQ0FiRixDQTZCRSxrRUFDRSxLQUFNLEtBQUsxQixLQUFMLENBQVdlLElBRG5CLENBRUUsZ0JBQWlCLEtBQUtmLEtBQUwsQ0FBV2lCLGVBRjlCLENBR0UsU0FBVSxLQUFLakIsS0FBTCxDQUFXMEMsUUFIdkIsQ0FJRSxRQUFTLEtBQUsxQyxLQUFMLENBQVdRLE9BSnRCLGtEQTdCRixDQXFDSCxDLHVCQS9Nc0IsZ0JBQU1nRCxTLGVBbU5oQnpELFUsbUlBbk5UQSxVIiwiZmlsZSI6Ik1haW5FZGl0b3IuanN4Iiwic291cmNlUm9vdCI6Ii9Vc2Vycy90b255bmd1eWVuL0RvY3VtZW50cy9HaXRIdWIvY29kZWZvcmFwcHMvdG9vbHMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZWJvdW5jZSB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgRWRpdG9yU3RhdGUsIGNvbnZlcnRUb1JhdywgY29udmVydEZyb21SYXcgfSBmcm9tICdkcmFmdC1qcyc7XG5cbmltcG9ydCB7XG4gIEV2ZXJMaWJFZGl0b3IsXG4gIEV2ZXJMaWJUb29sYmFyLFxuICBFdmVyTGliRWRpdG9yU3RhdHNcbn0gZnJvbSAnLi4vLi4vLi4vLi4vY29yZS9tb2R1bGVzL2V2ZXJsaWJfZWRpdG9yJztcblxuY2xhc3MgTWFpbkVkaXRvciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICAvLyBUT0RPOiBIYXZlIHRvIGNvbnZlcnQgdGhlIHRleHQgc3RvcmVkXG4gICAgLy8gVE9ETzogaW4gdGhlIGRhdGFiYXNlIHRvIHRoZSBpbml0aWFsIGVkaXRvciBzdGF0ZVxuICAgIGNvbnNvbGUubG9nKHByb3BzLmJvb2suZHJhZnQuY2hhcHRlcnNbcHJvcHMuc2VsZWN0ZWRDaGFwdGVyXS50ZXh0KTtcblxuICAgIHRoaXMuZGlzcGxheU5hbWUgPSAnTWFpbkVkaXRvcic7XG4gICAgdGhpcy5pbml0aWFsVGV4dCA9XG4gICAgICBjb252ZXJ0RnJvbVJhdyhwcm9wcy5ib29rLmRyYWZ0LmNoYXB0ZXJzW3Byb3BzLnNlbGVjdGVkQ2hhcHRlcl0udGV4dCk7XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAgdGl0bGVWYWx1ZTogcHJvcHMuYm9vay5kcmFmdC5jaGFwdGVyc1twcm9wcy5zZWxlY3RlZENoYXB0ZXJdLnRpdGxlLFxuICAgICAgaXNUb29sYmFySGlkZGVuOiBmYWxzZSxcbiAgICAgIGJyb3dzZXJXaWR0aDogJycsXG4gICAgICBlZGl0b3JTdGF0ZTogRWRpdG9yU3RhdGUuY3JlYXRlV2l0aENvbnRlbnQoXG4gICAgICAgIHRoaXMuaW5pdGlhbFRleHRcbiAgICAgIClcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogTWVkaXVtIE1lZGlhIFF1ZXJ5IHRvIGtlZXAgdHJhY2sgb2YgcmVzaXppbmcgYW5kIHdoZW4gdGhlXG4gICAgICogY29tcG9uZW50IGlzIG1vdW50ZWQgVG8gc2hvdyB0aGUgY29ycmVjdCBtYWluIGNvbnRlbnQgd2lkdGhcbiAgICAgKi9cbiAgICB0aGlzLm1lZGlhUXVlcnlMYXJnZVdpZHRoID0gOTkyO1xuXG4gICAgdGhpcy5taWxsaVNlY29uZHNUb1NhdmUgPSAzMDAwO1xuICAgIHRoaXMubWF4Q2hhcHRlclRpdGxlTGVuZ3RoID0gMTAwO1xuXG4gIH1cblxuICAvKipcbiAgICogV2hlbiB0aGUgY29tcG9uZW50IGlzIG1vdW50ZWQsIGl0IHdpbGwgc2VlIGlmIHRoZSBicm93c2VyIHdpZHRoIGlzIGxlc3NcbiAgICogdGhhbiBsZXNzIHRoYW4gNzY4LCBhbmQgaWYgaXQgaXMsIHRoZW4gaXQgd2lsbCBzaGlmdCB0aGUgbWFpbiBjb250ZW50XG4gICAqIGFsbCB0aGUgd2F5IHRvIHRoZSBsZWZ0IG9uIGl0cyBpbml0aWFsIGxvYWQuIEl0IHdpbGwgYWxzbyBhZGQgdGhlXG4gICAqIHJlc2l6aW5nIGV2ZW50IGxpc3RlbmVyLlxuICAgKi9cbiAgY29tcG9uZW50RGlkTW91bnQgPSAoKSA9PiB7XG4gICAgY29uc3QgYm9va01haW5FbGVtZW50ID0gdGhpcy5yZWZzLmJvb2tNYWluQ29udGVudDtcblxuICAgIGlmICh3aW5kb3cuaW5uZXJXaWR0aCA8PSB0aGlzLm1lZGlhUXVlcnlMYXJnZVdpZHRoKSB7XG4gICAgICBib29rTWFpbkVsZW1lbnQuc3R5bGUubGVmdCA9ICcwcHgnO1xuICAgIH1cblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLm9uV2luZG93UmVzaXplKTtcbiAgfTtcblxuICAvKipcbiAgICogV2UgYXJlIGN1cnJlbnRseSBub3QgdHlpbmcgdGhlIGNoYW5nZXMgdG8gdGhlIHRleHQgYXJlYSB0byBkYXRhYmFzZVxuICAgKiBjaGFuZ2VzLiBUaGlzIGlzIGJlY2F1c2UgaXQncyBxdWlja2VyIHRvIHNpbXBseSBrZWVwIHRyYWNrIG9mIHRoZSB0ZXh0XG4gICAqIGluIHN0YXRlIGFuZCBoYXZlIGEgc3R1YiBnbyBvZmYgYW5kIGhhbmRsZSB0aGUgZGF0YWJhc2Ugc2F2aW5nLiBIb3dldmVyLFxuICAgKiBzd2l0Y2hpbmcgYmV0d2VlbiBjaGFwdGVycyBpcyBhIGdvb2QgdGltZSB0byBncmFiIHRoZSBjdXJyZW50IHZhbHVlIG9mXG4gICAqIHRoYXQgdGV4dCBmcm9tIHRoZSBkYXRhYmFzZSAodGhlIGJvb2sgcHJvcHMgb2JqZWN0KVxuICAgKi9cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBpZiAodGhpcy5wcm9wcy5zZWxlY3RlZENoYXB0ZXIgIT09IG5leHRQcm9wcy5zZWxlY3RlZENoYXB0ZXIpIHtcblxuICAgICAgLy8gR2V0IHRoZSBuZXcgY2hhcHRlcnMgdGV4dCBhbmQgY29udmVydCBpdCBmcm9tIGl0J3MgcmF3IGZvcm1cbiAgICAgIGNvbnN0IG5ld1RleHQgPSBjb252ZXJ0RnJvbVJhdyhcbiAgICAgICAgbmV4dFByb3BzLmJvb2suZHJhZnQuY2hhcHRlcnNbbmV4dFByb3BzLnNlbGVjdGVkQ2hhcHRlcl0udGV4dFxuICAgICAgKTtcblxuICAgICAgLy8gU2V0IHRoZSBuZXcgY29udGVudCBvbiB0byBzdGF0ZVxuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIGVkaXRvclN0YXRlOiBFZGl0b3JTdGF0ZS5jcmVhdGVXaXRoQ29udGVudChuZXdUZXh0KSxcbiAgICAgICAgdGl0bGVWYWx1ZTogbmV4dFByb3BzLmJvb2suZHJhZnRcbiAgICAgICAgICAuY2hhcHRlcnNbbmV4dFByb3BzLnNlbGVjdGVkQ2hhcHRlcl0udGl0bGVcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBCZWNhdXNlIG91ciBjb21wb25lbnQgaXMgcmVjZWl2aW5nIG11bHRpcGxlIHByb3BzLFxuICAgKiAgd2Ugb25seSB3YW50IHRvIHVwZGF0ZSBpdCBpbiBhIGZldyBjYXNlcy5cbiAgICogIElmIGFueSBvZiB0aGUgZm9sbG93aW5nIGFyZSB0cnVlOlxuICAgKiAxKSBUaGUgY3VycmVudCBzZWxlY3RlZCBjaGFwdGVyIGhhcyBjaGFuZ2VkLlxuICAgKiAyKSBUaGUgdmFsdWUgb2Ygc3RhdGUudGV4dFZhbHVlIGhhcyBjaGFuZ2VkIC1cbiAgICogICBOb3RlOiBXZSB3aWxsIG9ubHkgYmUgcHVsbGluZyBpbiB0aGUgdGV4dCB2YWx1ZSBvZiBhIGNoYXB0ZXIgZnJvbSB0aGVcbiAgICogICAgICAgICBkYXRhYmFzZSBvbiBpbml0aWFsIGxvYWQgb3Igd2hlbiBhIG5ldyBjaGFwdGVyIGlzIHNlbGVjdGVkLlxuICAgKiAgICAgICAgIFRoaXMgaXMgdG8gbWFrZSBzdXJlIHRoZXJlIGFyZSBubyBiYWNrIGFuZCBmb3J0aCBpc3N1ZXNcbiAgICogICAgICAgICB3aXRoIHJlYWN0aXZlIGRhdGEgb3ZlcndyaXRpbmcgdGhlIHRleHQgdGhhdCdzIGJlaW5nIHR5cGVkLlxuICAgKiAzKSBTZXR0aW5ncyB0byB0aGUgcGFnZSBoYXZlIGNoYW5nZWRcbiAgICpcbiAgICogRG9uJ3QgYmUgYWxhcm1lZCBieSB0aGUgdHJpcGUgZXF1YWxpdHkgY2hlY2sgY29tcGFyaW5nIHRoZSBwcm9wcy5zZXR0aW5nc1xuICAgKiBvYmplY3QgdG8gdGhlIG5leHRQcm9wcy5zZXR0aW5ncyBvYmplY3QuIFRoaXMgYWN0dWFsbHkgd29ya3MgZm9yIHByb3BcbiAgICogb2JqZWN0cyBpbiByZWFjdC5cbiAgICovXG4gIHNob3VsZENvbXBvbmVudFVwZGF0ZSA9IChuZXh0UHJvcHMsIG5leHRTdGF0ZSkgPT4ge1xuICAgIHJldHVybiAoKHRoaXMucHJvcHMuc2VsZWN0ZWRDaGFwdGVyICE9PSBuZXh0UHJvcHMuc2VsZWN0ZWRDaGFwdGVyKSB8fFxuICAgICh0aGlzLnN0YXRlLmVkaXRvclN0YXRlICE9PSBuZXh0U3RhdGUuZWRpdG9yU3RhdGUpIHx8XG4gICAgKHRoaXMuc3RhdGUudGl0bGVWYWx1ZSAhPT0gbmV4dFN0YXRlLnRpdGxlVmFsdWUpIHx8XG4gICAgKHRoaXMucHJvcHMuc2V0dGluZ3MgIT09IG5leHRQcm9wcy5zZXR0aW5ncykgfHxcbiAgICAodGhpcy5wcm9wcy5pc1Rvb2xiYXJIaWRkZW4gIT09IG5leHRTdGF0ZS5pc1Rvb2xiYXJIaWRkZW4pKTtcbiAgfTtcblxuICBjb21wb25lbnRXaWxsVW5tb3VudCA9ICgpID0+IHtcbiAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vbldpbmRvd1Jlc2l6ZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIE9uIHdpbmRvdyByZS1zaXppbmcsIHRoZSBtYWluIGNvbnRlbnQgd2lsbCBzaGlmdCB0aGUgYW1vdW50IG9mIHBpeGVsc1xuICAgKiB0byB0aGUgbGVmdCBkZXBlbmRpbmcgb24gdGhlIG1lZGlhIHF1ZXJ5IHdpZHRoIG9mIDc2OCBhbmQgYWxzbyBpZlxuICAgKiB0aGUgc2lkZWJhciBjb250ZW50IGhhcyBiZWVuIHRvZ2dsZWQgb3Igbm90LlxuICAgKi9cbiAgb25XaW5kb3dSZXNpemUgPSAoKSA9PiB7XG4gICAgY29uc3QgbGVzc1RoYW5Jbm5lcldpZHRoID0gKHdpbmRvdy5pbm5lcldpZHRoIDw9IHRoaXMubWVkaWFRdWVyeUxhcmdlV2lkdGgpLFxuICAgICAgbW9yZVRoYW5Jbm5lcldpZHRoID0gKHdpbmRvdy5pbm5lcldpZHRoID49IHRoaXMubWVkaWFRdWVyeUxhcmdlV2lkdGgpLFxuICAgICAgaXNTaWRlYmFySGlkZGVuID0gdGhpcy5wcm9wcy5zZXR0aW5ncy5pc1NpZGViYXJDb250ZW50SGlkZGVuO1xuXG4gICAgaWYgKGxlc3NUaGFuSW5uZXJXaWR0aCkge1xuICAgICAgdGhpcy5yZWZzLmJvb2tNYWluQ29udGVudC5zdHlsZS5sZWZ0ID0gJzBweCc7XG4gICAgfSBlbHNlIGlmIChtb3JlVGhhbklubmVyV2lkdGggJiYgaXNTaWRlYmFySGlkZGVuKSB7XG4gICAgICB0aGlzLnJlZnMuYm9va01haW5Db250ZW50LnN0eWxlLmxlZnQgPSAnODBweCc7XG4gICAgfSBlbHNlIGlmIChtb3JlVGhhbklubmVyV2lkdGggJiYgIWlzU2lkZWJhckhpZGRlbikge1xuICAgICAgdGhpcy5yZWZzLmJvb2tNYWluQ29udGVudC5zdHlsZS5sZWZ0ID0gJzMzMHB4JztcbiAgICB9XG4gIH07XG5cbiAgLy8gVE9ETzogTmVlZHMgdG8gYmUgdXBkYXRlZFxuICAvLyBUT0RPOiBUaGlzIGlzIHdoZXJlIHRoZSBkYiBzYXZpbmcgY2hhaW4gd291bGQgc3RhcnRcbiAgb25DaGFuZ2UgPSAoZWRpdG9yU3RhdGUpID0+IHtcbiAgICBjb25zb2xlLmxvZygnYm9va19lZGl0X21haW5fY29udGVudCBvbkNoYW5nZScpO1xuICAgIGNvbnNvbGUubG9nKCdDSEFOR0lORyBFRElUT1IgU1RBVEUnKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgZWRpdG9yU3RhdGUgfSk7XG4gICAgY29uc3QgZHJhZnQgPSB0aGlzLnByb3BzLmJvb2suZHJhZnQ7XG4gICAgZHJhZnQuY2hhcHRlcnNbdGhpcy5wcm9wcy5zZWxlY3RlZENoYXB0ZXJdLnRleHQgPVxuICAgICAgY29udmVydFRvUmF3KGVkaXRvclN0YXRlLmdldEN1cnJlbnRDb250ZW50KCkpO1xuICAgIHRoaXMuZGVib3VuY2VkU2F2ZShkcmFmdCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIGRlYm91bmNlIHRoZSBzYXZpbmcgb2YgdGhlIGRyYWZ0XG4gICAqL1xuICBkZWJvdW5jZWRTYXZlID0gZGVib3VuY2UoKGRyYWZ0KSA9PlxuICAgIHRoaXMucHJvcHMubWV0aG9kcy5zYXZlRHJhZnQoZHJhZnQpLCB0aGlzLm1pbGxpU2Vjb25kc1RvU2F2ZSk7XG5cbiAgaGFuZGxlQ2hhcHRlclRpdGxlQ2hhbmdlID0gKGV2ZW50KSA9PiB7XG4gICAgbGV0IHRpdGxlID0gZXZlbnQudGFyZ2V0LnZhbHVlO1xuICAgIGlmICh0aXRsZS5sZW5ndGggPj0gdGhpcy5tYXhDaGFwdGVyVGl0bGVMZW5ndGgpIHtcbiAgICAgIHRpdGxlID0gdGl0bGUuc2xpY2UoMCwgdGhpcy5tYXhDaGFwdGVyVGl0bGVMZW5ndGgpO1xuICAgIH1cbiAgICBpZiAoIXRpdGxlLmxlbmd0aCkge1xuICAgICAgdGl0bGUgPSAnQ2hhcHRlciBUaXRsZSc7XG4gICAgfVxuICAgIHRoaXMuc2V0U3RhdGUoeyB0aXRsZVZhbHVlOiB0aXRsZSB9KTtcbiAgICBjb25zdCBkcmFmdCA9IHRoaXMucHJvcHMuYm9vay5kcmFmdDtcbiAgICBkcmFmdC5jaGFwdGVyc1t0aGlzLnByb3BzLnNlbGVjdGVkQ2hhcHRlcl0udGl0bGUgPSB0aXRsZTtcbiAgICAvLyBUT0RPOiBsZXQncyBqdXN0IG1ha2UgYSBzZXBhcmF0ZSBzYXZlIGZvciBjaGFwdGVyIHRpdGxlc1xuICAgIHRoaXMuZGVib3VuY2VkU2F2ZShkcmFmdCk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgcmVzaXppbmcgb2YgdGhlIG1haW4gY29udGVudCBkZXBlbmRpbmcgb24gd2hhdCBpc1xuICAgKiBjdXJyZW50bHkgYmVpbmcgdG9nZ2xlZCBieSBtZXJnaW5nIHRoZSBjdXJyZWN0IHN0eWxlc1xuICAgKi9cbiAgaGFuZGxlTWFpbkNvbnRlbnRUb2dnbGVTdHlsZXMgPSAoKSA9PiB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sXG4gICAgICB0aGlzLnByb3BzLnNldHRpbmdzLmlzU2lkZWJhckNvbnRlbnRIaWRkZW4gPyB7IGxlZnQ6IDgwIH0gOiB7IGxlZnQ6IDMzMCB9XG4gICAgKTtcbiAgfTtcblxuICByZW5kZXIoKSB7XG4gICAgY29uc29sZS5sb2coJ1JlbmRlcmluZyBpbiBNYWluRWRpdG9yJyk7XG4gICAgLy8gVGVzdGluZyBkYXRhIGNvbnZlcnNpb25cbiAgICBjb25zdCBjdXJyZW50Q29udGVudCA9XG4gICAgICBjb252ZXJ0VG9SYXcodGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpKTtcbiAgICBjb25zb2xlLmxvZyhjdXJyZW50Q29udGVudCk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXZcbiAgICAgICAgcmVmPVwiYm9va01haW5Db250ZW50XCJcbiAgICAgICAgc3R5bGU9e3RoaXMuaGFuZGxlTWFpbkNvbnRlbnRUb2dnbGVTdHlsZXMoKX1cbiAgICAgICAgY2xhc3NOYW1lPVwibWFpbi1lZGl0b3ItY29udGFpbmVyXCI+XG4gICAgICAgIDxFdmVyTGliVG9vbGJhclxuICAgICAgICAgIGJvb2s9e3RoaXMucHJvcHMuYm9va31cbiAgICAgICAgICBzZWxlY3RlZENoYXB0ZXI9e3RoaXMucHJvcHMuc2VsZWN0ZWRDaGFwdGVyfVxuICAgICAgICAgIHNldHRpbmdzPXt0aGlzLnByb3BzLnNldHRpbmdzfVxuICAgICAgICAgIG1ldGhvZHM9e3RoaXMucHJvcHMubWV0aG9kc31cbiAgICAgICAgICBoYW5kbGVDaGFuZ2U9eyhlZGl0b3JTdGF0ZSkgPT4gdGhpcy5vbkNoYW5nZShlZGl0b3JTdGF0ZSl9XG4gICAgICAgICAgZWRpdG9yU3RhdGU9e3RoaXMuc3RhdGUuZWRpdG9yU3RhdGV9XG4gICAgICAgICAgZWRpdG9yPXt0aGlzLmhhbmRsZUVkaXRvcn1cbiAgICAgICAgLz5cbiAgICAgICAgPGRpdlxuICAgICAgICAgIHJlZj1cImJvb2tNYWluQ29udGFpbmVyXCJcbiAgICAgICAgICBjbGFzc05hbWU9XCJib29rLWVkaXQtbWFpbi1jb250YWluZXJcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImNoYXB0ZXItdGl0bGUtY29udGFpbmVyXCI+XG4gICAgICAgICAgICA8aW5wdXRcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPVwibWFpbi1jb250ZW50LWNoYXB0ZXItdGl0bGUtaW5wdXRcIlxuICAgICAgICAgICAgICB0eXBlPVwidGV4dFwiXG4gICAgICAgICAgICAgIHZhbHVlPXt0aGlzLnN0YXRlLnRpdGxlVmFsdWV9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZUNoYXB0ZXJUaXRsZUNoYW5nZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPEV2ZXJMaWJFZGl0b3JcbiAgICAgICAgICAgIGhhbmRsZUNoYW5nZT17KGVkaXRvclN0YXRlKSA9PiB0aGlzLm9uQ2hhbmdlKGVkaXRvclN0YXRlKX1cbiAgICAgICAgICAgIGVkaXRvclN0YXRlPXt0aGlzLnN0YXRlLmVkaXRvclN0YXRlfVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8RXZlckxpYkVkaXRvclN0YXRzXG4gICAgICAgICAgYm9vaz17dGhpcy5wcm9wcy5ib29rfVxuICAgICAgICAgIHNlbGVjdGVkQ2hhcHRlcj17dGhpcy5wcm9wcy5zZWxlY3RlZENoYXB0ZXJ9XG4gICAgICAgICAgc2V0dGluZ3M9e3RoaXMucHJvcHMuc2V0dGluZ3N9XG4gICAgICAgICAgbWV0aG9kcz17dGhpcy5wcm9wcy5tZXRob2RzfVxuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IE1haW5FZGl0b3I7XG4iXX0=