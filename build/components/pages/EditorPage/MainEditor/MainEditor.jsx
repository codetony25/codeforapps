'use strict';exports.__esModule=true;var _assign=require('babel-runtime/core-js/object/assign');var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _jsxFileName='components/pages/EditorPage/MainEditor/MainEditor.jsx';var _lodash=require('lodash');var _react=require('react');var _react2=_interopRequireDefault(_react);var _draftJs=require('draft-js');var _everlib_editor=require('../../../../core/modules/everlib_editor');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MainEditor=function(_React$Component){(0,_inherits3.default)(MainEditor,_React$Component);function MainEditor(props){(0,_classCallCheck3.default)(this,MainEditor);var _this=(0,_possibleConstructorReturn3.default)(this,(MainEditor.__proto__||(0,_getPrototypeOf2.default)(MainEditor)).call(this,props));_this.componentDidMount=function(){return _this.__componentDidMount__REACT_HOT_LOADER__.apply(_this,arguments)};_this.shouldComponentUpdate=function(){return _this.__shouldComponentUpdate__REACT_HOT_LOADER__.apply(_this,arguments)};_this.componentWillUnmount=function(){return _this.__componentWillUnmount__REACT_HOT_LOADER__.apply(_this,arguments)};_this.onWindowResize=function(){return _this.__onWindowResize__REACT_HOT_LOADER__.apply(_this,arguments)};_this.onChange=function(){return _this.__onChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.debouncedSave=(0,_lodash.debounce)(function(draft){return _this.props.methods.saveDraft(draft)},_this.milliSecondsToSave);_this.handleChapterTitleChange=function(){return _this.__handleChapterTitleChange__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleMainContentToggleStyles=function(){return _this.__handleMainContentToggleStyles__REACT_HOT_LOADER__.apply(_this,arguments)};console.log(props.book.draft.chapters[props.selectedChapter].text);_this.displayName='MainEditor';_this.initialText=(0,_draftJs.convertFromRaw)(props.book.draft.chapters[props.selectedChapter].text);_this.state={titleValue:props.book.draft.chapters[props.selectedChapter].title,isToolbarHidden:false,browserWidth:'',editorState:_draftJs.EditorState.createWithContent(_this.initialText)};_this.mediaQueryLargeWidth=992;_this.milliSecondsToSave=3000;_this.maxChapterTitleLength=100;return _this}(0,_createClass3.default)(MainEditor,[{key:'__componentDidMount__REACT_HOT_LOADER__',value:function __componentDidMount__REACT_HOT_LOADER__(){return this.__componentDidMount__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__componentDidMount__REACT_HOT_LOADER__',value:function __componentDidMount__REACT_HOT_LOADER__(){var bookMainElement=this.refs.bookMainContent;if(window.innerWidth<=this.mediaQueryLargeWidth){bookMainElement.style.left='0px'}window.addEventListener('resize',this.onWindowResize)}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(nextProps){if(this.props.selectedChapter!==nextProps.selectedChapter){var newText=(0,_draftJs.convertFromRaw)(nextProps.book.draft.chapters[nextProps.selectedChapter].text);this.setState({editorState:_draftJs.EditorState.createWithContent(newText),titleValue:nextProps.book.draft.chapters[nextProps.selectedChapter].title})}}},{key:'__shouldComponentUpdate__REACT_HOT_LOADER__',value:function __shouldComponentUpdate__REACT_HOT_LOADER__(){return this.__shouldComponentUpdate__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__shouldComponentUpdate__REACT_HOT_LOADER__',value:function __shouldComponentUpdate__REACT_HOT_LOADER__(nextProps,nextState){return this.props.selectedChapter!==nextProps.selectedChapter||this.state.editorState!==nextState.editorState||this.state.titleValue!==nextState.titleValue||this.props.settings!==nextProps.settings||this.props.isToolbarHidden!==nextState.isToolbarHidden}},{key:'__componentWillUnmount__REACT_HOT_LOADER__',value:function __componentWillUnmount__REACT_HOT_LOADER__(){return this.__componentWillUnmount__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__componentWillUnmount__REACT_HOT_LOADER__',value:function __componentWillUnmount__REACT_HOT_LOADER__(){window.removeEventListener('resize',this.onWindowResize)}},{key:'__onWindowResize__REACT_HOT_LOADER__',value:function __onWindowResize__REACT_HOT_LOADER__(){return this.__onWindowResize__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__onWindowResize__REACT_HOT_LOADER__',value:function __onWindowResize__REACT_HOT_LOADER__(){var lessThanInnerWidth=window.innerWidth<=this.mediaQueryLargeWidth,moreThanInnerWidth=window.innerWidth>=this.mediaQueryLargeWidth,isSidebarHidden=this.props.settings.isSidebarContentHidden;if(lessThanInnerWidth){this.refs.bookMainContent.style.left='0px'}else if(moreThanInnerWidth&&isSidebarHidden){this.refs.bookMainContent.style.left='80px'}else if(moreThanInnerWidth&&!isSidebarHidden){this.refs.bookMainContent.style.left='330px'}}},{key:'__onChange__REACT_HOT_LOADER__',value:function __onChange__REACT_HOT_LOADER__(){return this.__onChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__onChange__REACT_HOT_LOADER__',value:function __onChange__REACT_HOT_LOADER__(editorState){console.log('book_edit_main_content onChange');console.log('CHANGING EDITOR STATE');this.setState({editorState:editorState});var draft=this.props.book.draft;draft.chapters[this.props.selectedChapter].text=(0,_draftJs.convertToRaw)(editorState.getCurrentContent());this.debouncedSave(draft)}},{key:'__handleChapterTitleChange__REACT_HOT_LOADER__',value:function __handleChapterTitleChange__REACT_HOT_LOADER__(){return this.__handleChapterTitleChange__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleChapterTitleChange__REACT_HOT_LOADER__',value:function __handleChapterTitleChange__REACT_HOT_LOADER__(event){var title=event.target.value;if(title.length>=this.maxChapterTitleLength){title=title.slice(0,this.maxChapterTitleLength)}if(!title.length){title='Chapter Title'}this.setState({titleValue:title});var draft=this.props.book.draft;draft.chapters[this.props.selectedChapter].title=title;this.debouncedSave(draft)}},{key:'__handleMainContentToggleStyles__REACT_HOT_LOADER__',value:function __handleMainContentToggleStyles__REACT_HOT_LOADER__(){return this.__handleMainContentToggleStyles__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleMainContentToggleStyles__REACT_HOT_LOADER__',value:function __handleMainContentToggleStyles__REACT_HOT_LOADER__(){return(0,_assign2.default)({},this.props.settings.isSidebarContentHidden?{left:80}:{left:330})}},{key:'render',value:function render(){var _this2=this;console.log('Rendering in MainEditor');var currentContent=(0,_draftJs.convertToRaw)(this.state.editorState.getCurrentContent());console.log(currentContent);return _react2.default.createElement('div',{ref:'bookMainContent',style:this.handleMainContentToggleStyles(),className:'main-editor-container',__source:{fileName:_jsxFileName,lineNumber:181}},_react2.default.createElement(_everlib_editor.EverLibToolbar,{book:this.props.book,selectedChapter:this.props.selectedChapter,settings:this.props.settings,methods:this.props.methods,handleChange:function handleChange(editorState){return _this2.onChange(editorState)},editorState:this.state.editorState,editor:this.handleEditor,__source:{fileName:_jsxFileName,lineNumber:185}}),_react2.default.createElement('div',{ref:'bookMainContainer',className:'book-edit-main-container',__source:{fileName:_jsxFileName,lineNumber:194}},_react2.default.createElement('div',{className:'chapter-title-container',__source:{fileName:_jsxFileName,lineNumber:197}},_react2.default.createElement('input',{className:'main-content-chapter-title-input',type:'text',value:this.state.titleValue,onChange:this.handleChapterTitleChange,__source:{fileName:_jsxFileName,lineNumber:198}})),_react2.default.createElement(_everlib_editor.EverLibEditor,{handleChange:function handleChange(editorState){return _this2.onChange(editorState)},editorState:this.state.editorState,__source:{fileName:_jsxFileName,lineNumber:205}})),_react2.default.createElement(_everlib_editor.EverLibEditorStats,{book:this.props.book,selectedChapter:this.props.selectedChapter,settings:this.props.settings,methods:this.props.methods,__source:{fileName:_jsxFileName,lineNumber:210}}))}}]);return MainEditor}(_react2.default.Component);var _default=MainEditor;exports.default=_default;;var _temp=function(){if(typeof __REACT_HOT_LOADER__==='undefined'){return}__REACT_HOT_LOADER__.register(MainEditor,'MainEditor','components/pages/EditorPage/MainEditor/MainEditor.jsx');__REACT_HOT_LOADER__.register(_default,'default','components/pages/EditorPage/MainEditor/MainEditor.jsx')}();;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk1haW5FZGl0b3IuanN4Il0sIm5hbWVzIjpbIk1haW5FZGl0b3IiLCJwcm9wcyIsImNvbXBvbmVudERpZE1vdW50Iiwic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwiY29tcG9uZW50V2lsbFVubW91bnQiLCJvbldpbmRvd1Jlc2l6ZSIsIm9uQ2hhbmdlIiwiZGVib3VuY2VkU2F2ZSIsImRyYWZ0IiwibWV0aG9kcyIsInNhdmVEcmFmdCIsIm1pbGxpU2Vjb25kc1RvU2F2ZSIsImhhbmRsZUNoYXB0ZXJUaXRsZUNoYW5nZSIsImhhbmRsZU1haW5Db250ZW50VG9nZ2xlU3R5bGVzIiwiY29uc29sZSIsImxvZyIsImJvb2siLCJjaGFwdGVycyIsInNlbGVjdGVkQ2hhcHRlciIsInRleHQiLCJkaXNwbGF5TmFtZSIsImluaXRpYWxUZXh0Iiwic3RhdGUiLCJ0aXRsZVZhbHVlIiwidGl0bGUiLCJpc1Rvb2xiYXJIaWRkZW4iLCJicm93c2VyV2lkdGgiLCJlZGl0b3JTdGF0ZSIsImNyZWF0ZVdpdGhDb250ZW50IiwibWVkaWFRdWVyeUxhcmdlV2lkdGgiLCJtYXhDaGFwdGVyVGl0bGVMZW5ndGgiLCJib29rTWFpbkVsZW1lbnQiLCJyZWZzIiwiYm9va01haW5Db250ZW50Iiwid2luZG93IiwiaW5uZXJXaWR0aCIsInN0eWxlIiwibGVmdCIsImFkZEV2ZW50TGlzdGVuZXIiLCJuZXh0UHJvcHMiLCJuZXdUZXh0Iiwic2V0U3RhdGUiLCJuZXh0U3RhdGUiLCJzZXR0aW5ncyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJsZXNzVGhhbklubmVyV2lkdGgiLCJtb3JlVGhhbklubmVyV2lkdGgiLCJpc1NpZGViYXJIaWRkZW4iLCJpc1NpZGViYXJDb250ZW50SGlkZGVuIiwiZ2V0Q3VycmVudENvbnRlbnQiLCJldmVudCIsInRhcmdldCIsInZhbHVlIiwibGVuZ3RoIiwic2xpY2UiLCJjdXJyZW50Q29udGVudCIsImhhbmRsZUVkaXRvciIsIkNvbXBvbmVudCJdLCJtYXBwaW5n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RSxLQUFLLE1BRlAsQ0FHRSxNQUFPLEtBQUtsQyxLQUFMLENBQVdDLFVBSHBCLENBSUUsU0FBVSxLQUFLWCx3QkFKakIsa0RBREYsQ0FIRixDQVdFLDZEQUNFLGFBQWMsc0JBQUNlLFdBQUQsUUFBaUIsUUFBS3JCLFFBQUwsQ0FBY3FCLFdBQWQsQ0FBakIsQ0FEaEIsQ0FFRSxZQUFhLEtBQUtMLEtBQUwsQ0FBV0ssV0FGMUIsa0RBWEYsQ0FiRixDQTZCRSxrRUFDRSxLQUFNLEtBQUsxQixLQUFMLENBQVdlLElBRG5CLENBRUUsZ0JBQWlCLEtBQUtmLEtBQUwsQ0FBV2lCLGVBRjlCLENBR0UsU0FBVSxLQUFLakIsS0FBTCxDQUFXMEMsUUFIdkIsQ0FJRSxRQUFTLEtBQUsxQyxLQUFMLENBQVdRLE9BSnRCLGtEQTdCRixDQXFDSCxDLHVCQS9Nc0IsZ0JBQU1nRCxTLGVBbU5oQnpELFUsbUlBbk5UQSxVIiwiZmlsZSI6Ik1haW5FZGl0b3IuanN4Iiwic291cmNlUm9vdCI6Ii9Vc2Vycy90b255bmd1eWVuL1Byb2plY3RzL2NvZGVmb3JhcHBzL3Rvb2xzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVib3VuY2UgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEVkaXRvclN0YXRlLCBjb252ZXJ0VG9SYXcsIGNvbnZlcnRGcm9tUmF3IH0gZnJvbSAnZHJhZnQtanMnO1xuXG5pbXBvcnQge1xuICBFdmVyTGliRWRpdG9yLFxuICBFdmVyTGliVG9vbGJhcixcbiAgRXZlckxpYkVkaXRvclN0YXRzXG59IGZyb20gJy4uLy4uLy4uLy4uL2NvcmUvbW9kdWxlcy9ldmVybGliX2VkaXRvcic7XG5cbmNsYXNzIE1haW5FZGl0b3IgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgLy8gVE9ETzogSGF2ZSB0byBjb252ZXJ0IHRoZSB0ZXh0IHN0b3JlZFxuICAgIC8vIFRPRE86IGluIHRoZSBkYXRhYmFzZSB0byB0aGUgaW5pdGlhbCBlZGl0b3Igc3RhdGVcbiAgICBjb25zb2xlLmxvZyhwcm9wcy5ib29rLmRyYWZ0LmNoYXB0ZXJzW3Byb3BzLnNlbGVjdGVkQ2hhcHRlcl0udGV4dCk7XG5cbiAgICB0aGlzLmRpc3BsYXlOYW1lID0gJ01haW5FZGl0b3InO1xuICAgIHRoaXMuaW5pdGlhbFRleHQgPVxuICAgICAgY29udmVydEZyb21SYXcocHJvcHMuYm9vay5kcmFmdC5jaGFwdGVyc1twcm9wcy5zZWxlY3RlZENoYXB0ZXJdLnRleHQpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHRpdGxlVmFsdWU6IHByb3BzLmJvb2suZHJhZnQuY2hhcHRlcnNbcHJvcHMuc2VsZWN0ZWRDaGFwdGVyXS50aXRsZSxcbiAgICAgIGlzVG9vbGJhckhpZGRlbjogZmFsc2UsXG4gICAgICBicm93c2VyV2lkdGg6ICcnLFxuICAgICAgZWRpdG9yU3RhdGU6IEVkaXRvclN0YXRlLmNyZWF0ZVdpdGhDb250ZW50KFxuICAgICAgICB0aGlzLmluaXRpYWxUZXh0XG4gICAgICApXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIE1lZGl1bSBNZWRpYSBRdWVyeSB0byBrZWVwIHRyYWNrIG9mIHJlc2l6aW5nIGFuZCB3aGVuIHRoZVxuICAgICAqIGNvbXBvbmVudCBpcyBtb3VudGVkIFRvIHNob3cgdGhlIGNvcnJlY3QgbWFpbiBjb250ZW50IHdpZHRoXG4gICAgICovXG4gICAgdGhpcy5tZWRpYVF1ZXJ5TGFyZ2VXaWR0aCA9IDk5MjtcblxuICAgIHRoaXMubWlsbGlTZWNvbmRzVG9TYXZlID0gMzAwMDtcbiAgICB0aGlzLm1heENoYXB0ZXJUaXRsZUxlbmd0aCA9IDEwMDtcblxuICB9XG5cbiAgLyoqXG4gICAqIFdoZW4gdGhlIGNvbXBvbmVudCBpcyBtb3VudGVkLCBpdCB3aWxsIHNlZSBpZiB0aGUgYnJvd3NlciB3aWR0aCBpcyBsZXNzXG4gICAqIHRoYW4gbGVzcyB0aGFuIDc2OCwgYW5kIGlmIGl0IGlzLCB0aGVuIGl0IHdpbGwgc2hpZnQgdGhlIG1haW4gY29udGVudFxuICAgKiBhbGwgdGhlIHdheSB0byB0aGUgbGVmdCBvbiBpdHMgaW5pdGlhbCBsb2FkLiBJdCB3aWxsIGFsc28gYWRkIHRoZVxuICAgKiByZXNpemluZyBldmVudCBsaXN0ZW5lci5cbiAgICovXG4gIGNvbXBvbmVudERpZE1vdW50ID0gKCkgPT4ge1xuICAgIGNvbnN0IGJvb2tNYWluRWxlbWVudCA9IHRoaXMucmVmcy5ib29rTWFpbkNvbnRlbnQ7XG5cbiAgICBpZiAod2luZG93LmlubmVyV2lkdGggPD0gdGhpcy5tZWRpYVF1ZXJ5TGFyZ2VXaWR0aCkge1xuICAgICAgYm9va01haW5FbGVtZW50LnN0eWxlLmxlZnQgPSAnMHB4JztcbiAgICB9XG5cbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vbldpbmRvd1Jlc2l6ZSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFdlIGFyZSBjdXJyZW50bHkgbm90IHR5aW5nIHRoZSBjaGFuZ2VzIHRvIHRoZSB0ZXh0IGFyZWEgdG8gZGF0YWJhc2VcbiAgICogY2hhbmdlcy4gVGhpcyBpcyBiZWNhdXNlIGl0J3MgcXVpY2tlciB0byBzaW1wbHkga2VlcCB0cmFjayBvZiB0aGUgdGV4dFxuICAgKiBpbiBzdGF0ZSBhbmQgaGF2ZSBhIHN0dWIgZ28gb2ZmIGFuZCBoYW5kbGUgdGhlIGRhdGFiYXNlIHNhdmluZy4gSG93ZXZlcixcbiAgICogc3dpdGNoaW5nIGJldHdlZW4gY2hhcHRlcnMgaXMgYSBnb29kIHRpbWUgdG8gZ3JhYiB0aGUgY3VycmVudCB2YWx1ZSBvZlxuICAgKiB0aGF0IHRleHQgZnJvbSB0aGUgZGF0YWJhc2UgKHRoZSBib29rIHByb3BzIG9iamVjdClcbiAgICovXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgaWYgKHRoaXMucHJvcHMuc2VsZWN0ZWRDaGFwdGVyICE9PSBuZXh0UHJvcHMuc2VsZWN0ZWRDaGFwdGVyKSB7XG5cbiAgICAgIC8vIEdldCB0aGUgbmV3IGNoYXB0ZXJzIHRleHQgYW5kIGNvbnZlcnQgaXQgZnJvbSBpdCdzIHJhdyBmb3JtXG4gICAgICBjb25zdCBuZXdUZXh0ID0gY29udmVydEZyb21SYXcoXG4gICAgICAgIG5leHRQcm9wcy5ib29rLmRyYWZ0LmNoYXB0ZXJzW25leHRQcm9wcy5zZWxlY3RlZENoYXB0ZXJdLnRleHRcbiAgICAgICk7XG5cbiAgICAgIC8vIFNldCB0aGUgbmV3IGNvbnRlbnQgb24gdG8gc3RhdGVcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBlZGl0b3JTdGF0ZTogRWRpdG9yU3RhdGUuY3JlYXRlV2l0aENvbnRlbnQobmV3VGV4dCksXG4gICAgICAgIHRpdGxlVmFsdWU6IG5leHRQcm9wcy5ib29rLmRyYWZ0XG4gICAgICAgICAgLmNoYXB0ZXJzW25leHRQcm9wcy5zZWxlY3RlZENoYXB0ZXJdLnRpdGxlXG4gICAgICB9KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQmVjYXVzZSBvdXIgY29tcG9uZW50IGlzIHJlY2VpdmluZyBtdWx0aXBsZSBwcm9wcyxcbiAgICogIHdlIG9ubHkgd2FudCB0byB1cGRhdGUgaXQgaW4gYSBmZXcgY2FzZXMuXG4gICAqICBJZiBhbnkgb2YgdGhlIGZvbGxvd2luZyBhcmUgdHJ1ZTpcbiAgICogMSkgVGhlIGN1cnJlbnQgc2VsZWN0ZWQgY2hhcHRlciBoYXMgY2hhbmdlZC5cbiAgICogMikgVGhlIHZhbHVlIG9mIHN0YXRlLnRleHRWYWx1ZSBoYXMgY2hhbmdlZCAtXG4gICAqICAgTm90ZTogV2Ugd2lsbCBvbmx5IGJlIHB1bGxpbmcgaW4gdGhlIHRleHQgdmFsdWUgb2YgYSBjaGFwdGVyIGZyb20gdGhlXG4gICAqICAgICAgICAgZGF0YWJhc2Ugb24gaW5pdGlhbCBsb2FkIG9yIHdoZW4gYSBuZXcgY2hhcHRlciBpcyBzZWxlY3RlZC5cbiAgICogICAgICAgICBUaGlzIGlzIHRvIG1ha2Ugc3VyZSB0aGVyZSBhcmUgbm8gYmFjayBhbmQgZm9ydGggaXNzdWVzXG4gICAqICAgICAgICAgd2l0aCByZWFjdGl2ZSBkYXRhIG92ZXJ3cml0aW5nIHRoZSB0ZXh0IHRoYXQncyBiZWluZyB0eXBlZC5cbiAgICogMykgU2V0dGluZ3MgdG8gdGhlIHBhZ2UgaGF2ZSBjaGFuZ2VkXG4gICAqXG4gICAqIERvbid0IGJlIGFsYXJtZWQgYnkgdGhlIHRyaXBlIGVxdWFsaXR5IGNoZWNrIGNvbXBhcmluZyB0aGUgcHJvcHMuc2V0dGluZ3NcbiAgICogb2JqZWN0IHRvIHRoZSBuZXh0UHJvcHMuc2V0dGluZ3Mgb2JqZWN0LiBUaGlzIGFjdHVhbGx5IHdvcmtzIGZvciBwcm9wXG4gICAqIG9iamVjdHMgaW4gcmVhY3QuXG4gICAqL1xuICBzaG91bGRDb21wb25lbnRVcGRhdGUgPSAobmV4dFByb3BzLCBuZXh0U3RhdGUpID0+IHtcbiAgICByZXR1cm4gKCh0aGlzLnByb3BzLnNlbGVjdGVkQ2hhcHRlciAhPT0gbmV4dFByb3BzLnNlbGVjdGVkQ2hhcHRlcikgfHxcbiAgICAodGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZSAhPT0gbmV4dFN0YXRlLmVkaXRvclN0YXRlKSB8fFxuICAgICh0aGlzLnN0YXRlLnRpdGxlVmFsdWUgIT09IG5leHRTdGF0ZS50aXRsZVZhbHVlKSB8fFxuICAgICh0aGlzLnByb3BzLnNldHRpbmdzICE9PSBuZXh0UHJvcHMuc2V0dGluZ3MpIHx8XG4gICAgKHRoaXMucHJvcHMuaXNUb29sYmFySGlkZGVuICE9PSBuZXh0U3RhdGUuaXNUb29sYmFySGlkZGVuKSk7XG4gIH07XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQgPSAoKSA9PiB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMub25XaW5kb3dSZXNpemUpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBPbiB3aW5kb3cgcmUtc2l6aW5nLCB0aGUgbWFpbiBjb250ZW50IHdpbGwgc2hpZnQgdGhlIGFtb3VudCBvZiBwaXhlbHNcbiAgICogdG8gdGhlIGxlZnQgZGVwZW5kaW5nIG9uIHRoZSBtZWRpYSBxdWVyeSB3aWR0aCBvZiA3NjggYW5kIGFsc28gaWZcbiAgICogdGhlIHNpZGViYXIgY29udGVudCBoYXMgYmVlbiB0b2dnbGVkIG9yIG5vdC5cbiAgICovXG4gIG9uV2luZG93UmVzaXplID0gKCkgPT4ge1xuICAgIGNvbnN0IGxlc3NUaGFuSW5uZXJXaWR0aCA9ICh3aW5kb3cuaW5uZXJXaWR0aCA8PSB0aGlzLm1lZGlhUXVlcnlMYXJnZVdpZHRoKSxcbiAgICAgIG1vcmVUaGFuSW5uZXJXaWR0aCA9ICh3aW5kb3cuaW5uZXJXaWR0aCA+PSB0aGlzLm1lZGlhUXVlcnlMYXJnZVdpZHRoKSxcbiAgICAgIGlzU2lkZWJhckhpZGRlbiA9IHRoaXMucHJvcHMuc2V0dGluZ3MuaXNTaWRlYmFyQ29udGVudEhpZGRlbjtcblxuICAgIGlmIChsZXNzVGhhbklubmVyV2lkdGgpIHtcbiAgICAgIHRoaXMucmVmcy5ib29rTWFpbkNvbnRlbnQuc3R5bGUubGVmdCA9ICcwcHgnO1xuICAgIH0gZWxzZSBpZiAobW9yZVRoYW5Jbm5lcldpZHRoICYmIGlzU2lkZWJhckhpZGRlbikge1xuICAgICAgdGhpcy5yZWZzLmJvb2tNYWluQ29udGVudC5zdHlsZS5sZWZ0ID0gJzgwcHgnO1xuICAgIH0gZWxzZSBpZiAobW9yZVRoYW5Jbm5lcldpZHRoICYmICFpc1NpZGViYXJIaWRkZW4pIHtcbiAgICAgIHRoaXMucmVmcy5ib29rTWFpbkNvbnRlbnQuc3R5bGUubGVmdCA9ICczMzBweCc7XG4gICAgfVxuICB9O1xuXG4gIC8vIFRPRE86IE5lZWRzIHRvIGJlIHVwZGF0ZWRcbiAgLy8gVE9ETzogVGhpcyBpcyB3aGVyZSB0aGUgZGIgc2F2aW5nIGNoYWluIHdvdWxkIHN0YXJ0XG4gIG9uQ2hhbmdlID0gKGVkaXRvclN0YXRlKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ2Jvb2tfZWRpdF9tYWluX2NvbnRlbnQgb25DaGFuZ2UnKTtcbiAgICBjb25zb2xlLmxvZygnQ0hBTkdJTkcgRURJVE9SIFNUQVRFJyk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGVkaXRvclN0YXRlIH0pO1xuICAgIGNvbnN0IGRyYWZ0ID0gdGhpcy5wcm9wcy5ib29rLmRyYWZ0O1xuICAgIGRyYWZ0LmNoYXB0ZXJzW3RoaXMucHJvcHMuc2VsZWN0ZWRDaGFwdGVyXS50ZXh0ID1cbiAgICAgIGNvbnZlcnRUb1JhdyhlZGl0b3JTdGF0ZS5nZXRDdXJyZW50Q29udGVudCgpKTtcbiAgICB0aGlzLmRlYm91bmNlZFNhdmUoZHJhZnQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBkZWJvdW5jZSB0aGUgc2F2aW5nIG9mIHRoZSBkcmFmdFxuICAgKi9cbiAgZGVib3VuY2VkU2F2ZSA9IGRlYm91bmNlKChkcmFmdCkgPT5cbiAgICB0aGlzLnByb3BzLm1ldGhvZHMuc2F2ZURyYWZ0KGRyYWZ0KSwgdGhpcy5taWxsaVNlY29uZHNUb1NhdmUpO1xuXG4gIGhhbmRsZUNoYXB0ZXJUaXRsZUNoYW5nZSA9IChldmVudCkgPT4ge1xuICAgIGxldCB0aXRsZSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICBpZiAodGl0bGUubGVuZ3RoID49IHRoaXMubWF4Q2hhcHRlclRpdGxlTGVuZ3RoKSB7XG4gICAgICB0aXRsZSA9IHRpdGxlLnNsaWNlKDAsIHRoaXMubWF4Q2hhcHRlclRpdGxlTGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKCF0aXRsZS5sZW5ndGgpIHtcbiAgICAgIHRpdGxlID0gJ0NoYXB0ZXIgVGl0bGUnO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXRlKHsgdGl0bGVWYWx1ZTogdGl0bGUgfSk7XG4gICAgY29uc3QgZHJhZnQgPSB0aGlzLnByb3BzLmJvb2suZHJhZnQ7XG4gICAgZHJhZnQuY2hhcHRlcnNbdGhpcy5wcm9wcy5zZWxlY3RlZENoYXB0ZXJdLnRpdGxlID0gdGl0bGU7XG4gICAgLy8gVE9ETzogbGV0J3MganVzdCBtYWtlIGEgc2VwYXJhdGUgc2F2ZSBmb3IgY2hhcHRlciB0aXRsZXNcbiAgICB0aGlzLmRlYm91bmNlZFNhdmUoZHJhZnQpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBIYW5kbGVzIHJlc2l6aW5nIG9mIHRoZSBtYWluIGNvbnRlbnQgZGVwZW5kaW5nIG9uIHdoYXQgaXNcbiAgICogY3VycmVudGx5IGJlaW5nIHRvZ2dsZWQgYnkgbWVyZ2luZyB0aGUgY3VycmVjdCBzdHlsZXNcbiAgICovXG4gIGhhbmRsZU1haW5Db250ZW50VG9nZ2xlU3R5bGVzID0gKCkgPT4ge1xuICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LFxuICAgICAgdGhpcy5wcm9wcy5zZXR0aW5ncy5pc1NpZGViYXJDb250ZW50SGlkZGVuID8geyBsZWZ0OiA4MCB9IDogeyBsZWZ0OiAzMzAgfVxuICAgICk7XG4gIH07XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgaW4gTWFpbkVkaXRvcicpO1xuICAgIC8vIFRlc3RpbmcgZGF0YSBjb252ZXJzaW9uXG4gICAgY29uc3QgY3VycmVudENvbnRlbnQgPVxuICAgICAgY29udmVydFRvUmF3KHRoaXMuc3RhdGUuZWRpdG9yU3RhdGUuZ2V0Q3VycmVudENvbnRlbnQoKSk7XG4gICAgY29uc29sZS5sb2coY3VycmVudENvbnRlbnQpO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIHJlZj1cImJvb2tNYWluQ29udGVudFwiXG4gICAgICAgIHN0eWxlPXt0aGlzLmhhbmRsZU1haW5Db250ZW50VG9nZ2xlU3R5bGVzKCl9XG4gICAgICAgIGNsYXNzTmFtZT1cIm1haW4tZWRpdG9yLWNvbnRhaW5lclwiPlxuICAgICAgICA8RXZlckxpYlRvb2xiYXJcbiAgICAgICAgICBib29rPXt0aGlzLnByb3BzLmJvb2t9XG4gICAgICAgICAgc2VsZWN0ZWRDaGFwdGVyPXt0aGlzLnByb3BzLnNlbGVjdGVkQ2hhcHRlcn1cbiAgICAgICAgICBzZXR0aW5ncz17dGhpcy5wcm9wcy5zZXR0aW5nc31cbiAgICAgICAgICBtZXRob2RzPXt0aGlzLnByb3BzLm1ldGhvZHN9XG4gICAgICAgICAgaGFuZGxlQ2hhbmdlPXsoZWRpdG9yU3RhdGUpID0+IHRoaXMub25DaGFuZ2UoZWRpdG9yU3RhdGUpfVxuICAgICAgICAgIGVkaXRvclN0YXRlPXt0aGlzLnN0YXRlLmVkaXRvclN0YXRlfVxuICAgICAgICAgIGVkaXRvcj17dGhpcy5oYW5kbGVFZGl0b3J9XG4gICAgICAgIC8+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICByZWY9XCJib29rTWFpbkNvbnRhaW5lclwiXG4gICAgICAgICAgY2xhc3NOYW1lPVwiYm9vay1lZGl0LW1haW4tY29udGFpbmVyXCI+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJjaGFwdGVyLXRpdGxlLWNvbnRhaW5lclwiPlxuICAgICAgICAgICAgPGlucHV0XG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cIm1haW4tY29udGVudC1jaGFwdGVyLXRpdGxlLWlucHV0XCJcbiAgICAgICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgICAgICB2YWx1ZT17dGhpcy5zdGF0ZS50aXRsZVZhbHVlfVxuICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVDaGFwdGVyVGl0bGVDaGFuZ2V9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxFdmVyTGliRWRpdG9yXG4gICAgICAgICAgICBoYW5kbGVDaGFuZ2U9eyhlZGl0b3JTdGF0ZSkgPT4gdGhpcy5vbkNoYW5nZShlZGl0b3JTdGF0ZSl9XG4gICAgICAgICAgICBlZGl0b3JTdGF0ZT17dGhpcy5zdGF0ZS5lZGl0b3JTdGF0ZX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPEV2ZXJMaWJFZGl0b3JTdGF0c1xuICAgICAgICAgIGJvb2s9e3RoaXMucHJvcHMuYm9va31cbiAgICAgICAgICBzZWxlY3RlZENoYXB0ZXI9e3RoaXMucHJvcHMuc2VsZWN0ZWRDaGFwdGVyfVxuICAgICAgICAgIHNldHRpbmdzPXt0aGlzLnByb3BzLnNldHRpbmdzfVxuICAgICAgICAgIG1ldGhvZHM9e3RoaXMucHJvcHMubWV0aG9kc31cbiAgICAgICAgLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxufVxuXG5leHBvcnQgZGVmYXVsdCBNYWluRWRpdG9yO1xuIl19