'use strict';exports.__esModule=true;var _assign=require('babel-runtime/core-js/object/assign');var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _class,_temp,_jsxFileName='components/pages/EditorPage/EditorPage.jsx';var _jassy=require('jassy');var _react=require('react');var _react2=_interopRequireDefault(_react);var _moment=require('moment');var _moment2=_interopRequireDefault(_moment);var _book_edit_helpers=require('../../../core/utils/book_helpers/book_edit_helpers');var _MainEditor=require('./MainEditor');var _MainEditor2=_interopRequireDefault(_MainEditor);var _editorPage=require('./editorPage.style');var _editorPage2=_interopRequireDefault(_editorPage);var _SidebarEditor=require('./SidebarEditor');var _SidebarEditor2=_interopRequireDefault(_SidebarEditor);var _modals=require('../../modals');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorPage=(_temp=_class=function(_React$Component){(0,_inherits3.default)(EditorPage,_React$Component);function EditorPage(props){(0,_classCallCheck3.default)(this,EditorPage);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorPage.__proto__||(0,_getPrototypeOf2.default)(EditorPage)).call(this,props));_this.componentWillReceiveProps=function(){return _this.__componentWillReceiveProps__REACT_HOT_LOADER__.apply(_this,arguments)};_this.saveDraft=function(){return _this.__saveDraft__REACT_HOT_LOADER__.apply(_this,arguments)};_this.setSetting=function(){return _this.__setSetting__REACT_HOT_LOADER__.apply(_this,arguments)};_this.atFirstChapter=function(){return _this.__atFirstChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.atLastChapter=function(){return _this.__atLastChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.selectNextChapter=function(){return _this.__selectNextChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.selectPreviousChapter=function(){return _this.__selectPreviousChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleSelectChapter=function(){return _this.__handleSelectChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleCreateChapter=function(){return _this.__handleCreateChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleDeleteChapter=function(){return _this.__handleDeleteChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleSidebarContentToggle=function(){return _this.__handleSidebarContentToggle__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleToggleLanguageModal=function(){return _this.__handleToggleLanguageModal__REACT_HOT_LOADER__.apply(_this,arguments)};_this.state={style:(0,_editorPage2.default)(),selectedChapter:'chkey1',loaded:false,showLanguageModal:false,settings:{lastSaved:'',showMarkdownToolbar:true,showBookStats:true,isSidebarContentHidden:false,previewLocation:'bottom'}};_this.methods={setSetting:_this.setSetting,atFirstChapter:_this.atFirstChapter,atLastChapter:_this.atLastChapter,selectNextChapter:_this.selectNextChapter,selectPreviousChapter:_this.selectPreviousChapter,handleSelectChapter:_this.handleSelectChapter,handleCreateChapter:_this.handleCreateChapter,handleDeleteChapter:_this.handleDeleteChapter,handleSidebarContentToggle:_this.handleSidebarContentToggle,handleToggleLanguageModal:_this.handleToggleLanguageModal,saveDraft:_this.saveDraft};_this.fakeProps={book:{titleSlug:'fake-book',draft:{chapterList:['chkey1'],chapters:{'chkey1':{title:'Chapter 1',text:'<h1>Hello world.</h1>'}}}}};return _this}(0,_createClass3.default)(EditorPage,[{key:'__componentWillReceiveProps__REACT_HOT_LOADER__',value:function __componentWillReceiveProps__REACT_HOT_LOADER__(){return this.__componentWillReceiveProps__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__componentWillReceiveProps__REACT_HOT_LOADER__',value:function __componentWillReceiveProps__REACT_HOT_LOADER__(nextProps){this.setState({selectedChapter:this.fakeProps.book.draft.chapterList[0]});this.setState({loaded:true})}},{key:'__saveDraft__REACT_HOT_LOADER__',value:function __saveDraft__REACT_HOT_LOADER__(){return this.__saveDraft__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__saveDraft__REACT_HOT_LOADER__',value:function __saveDraft__REACT_HOT_LOADER__(draft,successCallback,errorCallback){this.setSetting('lastSaved','Saving...')}},{key:'__setSetting__REACT_HOT_LOADER__',value:function __setSetting__REACT_HOT_LOADER__(){return this.__setSetting__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__setSetting__REACT_HOT_LOADER__',value:function __setSetting__REACT_HOT_LOADER__(key,value){var settings=(0,_assign2.default)({},this.state.settings);settings[key]=value;this.setState({settings:settings})}},{key:'__atFirstChapter__REACT_HOT_LOADER__',value:function __atFirstChapter__REACT_HOT_LOADER__(){return this.__atFirstChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__atFirstChapter__REACT_HOT_LOADER__',value:function __atFirstChapter__REACT_HOT_LOADER__(){return this.fakeProps.book.draft.chapterList.indexOf(this.state.selectedChapter)===0}},{key:'__atLastChapter__REACT_HOT_LOADER__',value:function __atLastChapter__REACT_HOT_LOADER__(){return this.__atLastChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__atLastChapter__REACT_HOT_LOADER__',value:function __atLastChapter__REACT_HOT_LOADER__(){return this.fakeProps.book.draft.chapterList.indexOf(this.state.selectedChapter)===this.fakeProps.book.draft.chapterList.length-1}},{key:'__selectNextChapter__REACT_HOT_LOADER__',value:function __selectNextChapter__REACT_HOT_LOADER__(){return this.__selectNextChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__selectNextChapter__REACT_HOT_LOADER__',value:function __selectNextChapter__REACT_HOT_LOADER__(){var chapterList=this.fakeProps.book.draft.chapterList;var idx=chapterList.indexOf(this.state.selectedChapter);if(chapterList[idx+1]){this.setState({selectedChapter:chapterList[idx+1]})}}},{key:'__selectPreviousChapter__REACT_HOT_LOADER__',value:function __selectPreviousChapter__REACT_HOT_LOADER__(){return this.__selectPreviousChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__selectPreviousChapter__REACT_HOT_LOADER__',value:function __selectPreviousChapter__REACT_HOT_LOADER__(){var chapterList=this.fakeProps.book.draft.chapterList;var idx=chapterList.indexOf(this.state.selectedChapter);if(chapterList[idx-1]){this.setState({selectedChapter:chapterList[idx-1]})}}},{key:'__handleSelectChapter__REACT_HOT_LOADER__',value:function __handleSelectChapter__REACT_HOT_LOADER__(){return this.__handleSelectChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleSelectChapter__REACT_HOT_LOADER__',value:function __handleSelectChapter__REACT_HOT_LOADER__(selectedChapter){this.setState({selectedChapter:selectedChapter})}},{key:'__handleCreateChapter__REACT_HOT_LOADER__',value:function __handleCreateChapter__REACT_HOT_LOADER__(){return this.__handleCreateChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleCreateChapter__REACT_HOT_LOADER__',value:function __handleCreateChapter__REACT_HOT_LOADER__(){var _this2=this;var draft=(0,_assign2.default)({},this.fakeProps.book.draft);var chapterKey='CHANGE ME';draft.chapters[chapterKey]=_book_edit_helpers.newChapter;draft.chapterList.push(chapterKey);this.saveDraft(draft,function(){_this2.setState({selectedChapter:chapterKey})})}},{key:'__handleDeleteChapter__REACT_HOT_LOADER__',value:function __handleDeleteChapter__REACT_HOT_LOADER__(){return this.__handleDeleteChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleDeleteChapter__REACT_HOT_LOADER__',value:function __handleDeleteChapter__REACT_HOT_LOADER__(){var _this3=this;var draft=(0,_assign2.default)({},this.fakeProps.book.draft);if(draft.chapterList.length>1){var idx=draft.chapterList.indexOf(this.state.selectedChapter);draft.chapterList.splice(idx,1);this.saveDraft(draft,function(){if(idx>=draft.chapterList.length){idx--}_this3.setState({selectedChapter:draft.chapterList[idx]})})}}},{key:'__handleSidebarContentToggle__REACT_HOT_LOADER__',value:function __handleSidebarContentToggle__REACT_HOT_LOADER__(){return this.__handleSidebarContentToggle__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleSidebarContentToggle__REACT_HOT_LOADER__',value:function __handleSidebarContentToggle__REACT_HOT_LOADER__(){var open=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var settings=(0,_assign2.default)({},this.state.settings);if(open){settings.isSidebarContentHidden=false}else{settings.isSidebarContentHidden=!settings.isSidebarContentHidden}this.setState({settings:settings})}},{key:'__handleToggleLanguageModal__REACT_HOT_LOADER__',value:function __handleToggleLanguageModal__REACT_HOT_LOADER__(){return this.__handleToggleLanguageModal__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleToggleLanguageModal__REACT_HOT_LOADER__',value:function __handleToggleLanguageModal__REACT_HOT_LOADER__(){console.log('handleToggleLanguageModal',this.state.showLanguageModal);this.setState({showLanguageModal:!this.state.showLanguageModal})}},{key:'render',value:function render(){console.log('Rendering EditorPage');if(this.state.loaded||true){return _react2.default.createElement('div',{className:'editor-view-container',__source:{fileName:_jsxFileName,lineNumber:223}},_react2.default.createElement(_jassy.Style,{rules:this.state.style,__source:{fileName:_jsxFileName,lineNumber:224}}),_react2.default.createElement(_modals.PanelModal,{show:this.state.showLanguageModal,__source:{fileName:_jsxFileName,lineNumber:225}}),_react2.default.createElement('div',{className:'main-sidebar-wrapper',__source:{fileName:_jsxFileName,lineNumber:226}},_react2.default.createElement(_SidebarEditor2.default,{book:this.fakeProps.book,selectedChapter:this.state.selectedChapter,settings:this.state.settings,methods:this.methods,__source:{fileName:_jsxFileName,lineNumber:227}})),_react2.default.createElement('div',{className:'main-book-content-wrapper',__source:{fileName:_jsxFileName,lineNumber:234}},_react2.default.createElement(_MainEditor2.default,{book:this.fakeProps.book,selectedChapter:this.state.selectedChapter,settings:this.state.settings,methods:this.methods,__source:{fileName:_jsxFileName,lineNumber:235}})))}return null}}]);return EditorPage}(_react2.default.Component),_class.displayName='EditorPage',_temp);var _default=EditorPage;exports.default=_default;;var _temp2=function(){if(typeof __REACT_HOT_LOADER__==='undefined'){return}__REACT_HOT_LOADER__.register(EditorPage,'EditorPage','components/pages/EditorPage/EditorPage.jsx');__REACT_HOT_LOADER__.register(_default,'default','components/pages/EditorPage/EditorPage.jsx')}();;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkVkaXRvclBhZ2UuanN4Il0sIm5hbWVzIjpbIkVkaXRvclBhZ2UiLCJwcm9wcyIsImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLCJzYXZlRHJhZnQiLCJzZXRTZXR0aW5nIiwiYXRGaXJzdENoYXB0ZXIiLCJhdExhc3RDaGFwdGVyIiwic2VsZWN0TmV4dENoYXB0ZXIiLCJzZWxlY3RQcmV2aW91c0NoYXB0ZXIiLCJoYW5kbGVTZWxlY3RDaGFwdGVyIiwiaGFuZGxlQ3JlYXRlQ2hhcHRlciIsImhhbmRsZURlbGV0ZUNoYXB0ZXIiLCJoYW5kbGVTaWRlYmFyQ29udGVudFRvZ2dsZSIsImhhbmRsZVRvZ2dsZUxhbmd1YWdlTW9kYWwiLCJzdGF0ZSIsInN0eWxlIiwic2VsZWN0ZWRDaGFwdGVyIiwibG9hZGVkIiwic2hvd0xhbmd1YWdlTW9kYWwiLCJzZXR0aW5ncyIsImxhc3RTYXZlZCIsInNob3dNYXJrZG93blRvb2xiYXIiLCJzaG93Qm9va1N0YXRzIiwiaXNTaWRlYmFyQ29udGVudEhpZGRlbiIsInByZXZpZXdMb2NhdGlvbiIsIm1ldGhvZHMiLCJmYWtlUHJvcHMiLCJib29rIiwidGl0bGVTbHVnIiwiZHJhZnQiLCJjaGFwdGVyTGlzdCIsImNoYXB0ZXJzIiwidGl0bGUiLCJ0ZXh0IiwibmV4dFByb3BzIiwic2V0U3RhdGUiLCJzdWNjZXNzQ2FsbGJhY2siLCJlcnJvckNhbGxiYWNrIiwia2V5IiwidmFsdWUiLCJpbmRleE9mIiwibGVuZ3RoIiwiaWR4IiwiY2hhcHRlcktleSIsInB1c2giLCJzcGxpY2UiLCJvcGVuIiwiY29uc29sZSIsImxvZyIsIkNvbXBvbmVudCIsImRpc3BsYXlOYW1lIl0sIm1hcHBpbmdzIjoiczNCQUFBLDRCQUNBLDRCLDJDQUNBLDhCLDZDQUdBLHFGQUNBLHdDLHFEQUNBLDhDLHFEQUNBLDhDLDJEQUNBLG9DLHFGQU1NQSxXLDhGQU9KLG9CQUFZQyxLQUFaLENBQW1CLGlMQUNYQSxLQURXLFNBa0RuQkMseUJBbERtQix1R0F1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S00sT0FKaEIsa0RBREYsQ0FIRixDQVdFLHFDQUFLLFVBQVUsMkJBQWYsa0RBQ0Usb0RBQ0UsS0FBTSxLQUFLQyxTQUFMLENBQWVDLElBRHZCLENBRUUsZ0JBQWlCLEtBQUtiLEtBQUwsQ0FBV0UsZUFGOUIsQ0FHRSxTQUFVLEtBQUtGLEtBQUwsQ0FBV0ssUUFIdkIsQ0FJRSxRQUFTLEtBQUtNLE9BSmhCLGtEQURGLENBWEYsQ0FxQkgsQ0FDRCxNQUFPLEtBQ1IsQyx1QkF0T3NCLGdCQUFNd0IsUyxTQUV0QkMsVyxDQUFjLFkscUJBcVFSbEQsVSxvSUF2UVRBLFUiLCJmaWxlIjoiRWRpdG9yUGFnZS5qc3giLCJzb3VyY2VSb290IjoiL1VzZXJzL3RvbnluZ3V5ZW4vUHJvamVjdHMvY29kZWZvcmFwcHMvdG9vbHMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTdHlsZSB9IGZyb20gJ2phc3N5JztcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG4vLyBpbXBvcnQgeyBicm93c2VySGlzdG9yeSB9IGZyb20gJ3JlYWN0LXJvdXRlcic7XG5cbmltcG9ydCB7IG5ld0NoYXB0ZXIgfSBmcm9tICcuLi8uLi8uLi9jb3JlL3V0aWxzL2Jvb2tfaGVscGVycy9ib29rX2VkaXRfaGVscGVycyc7XG5pbXBvcnQgTWFpbkVkaXRvciBmcm9tICcuL01haW5FZGl0b3InO1xuaW1wb3J0IGVkaXRvclBhZ2VTdHlsZSBmcm9tICcuL2VkaXRvclBhZ2Uuc3R5bGUnO1xuaW1wb3J0IFNpZGViYXJFZGl0b3IgZnJvbSAnLi9TaWRlYmFyRWRpdG9yJztcbmltcG9ydCB7IFBhbmVsTW9kYWwgfSBmcm9tICcuLi8uLi9tb2RhbHMnO1xuLy8gaW1wb3J0IHsgQm9va3MgfSBmcm9tICcvaW1wb3J0cy9hcGkvYm9va3MnO1xuXG4vLyBUT0RPOiBXZSB3aWxsIGhhdmUgdG8gbWFrZSBzdXJlIHRoZSBib29rIGV4aXN0cyB3aGVuIGhpdHRpbmcgdGhpcyBwYWdlXG4vLyBUT0RPOiBJZiBub3QgdGhlIHVzZXIgc2hvdWxkIGJlIHJlZGlyZWN0ZWQuXG5cbmNsYXNzIEVkaXRvclBhZ2UgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuXG4gIHN0YXRpYyBkaXNwbGF5TmFtZSA9ICdFZGl0b3JQYWdlJztcblxuICAvKipcbiAgICogRWRpdG9yUGFnZSBpcyB0aGUgZW50cnkgcG9pbnQgZm9yIG91ciBlZGl0aW5nIGNvbXBvbmVudC5cbiAgICovXG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuXG4gICAgLy8gU2V0IHVwIG91ciBpbml0aWFsIHN0YXRlIGZvciBvdXIgZW50aXJlIGJvb2sgZWRpdGluZyBjb21wb25lbnQuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHN0eWxlOiBlZGl0b3JQYWdlU3R5bGUoKSxcbiAgICAgIHNlbGVjdGVkQ2hhcHRlcjogJ2Noa2V5MScsXG4gICAgICBsb2FkZWQ6IGZhbHNlLFxuICAgICAgc2hvd0xhbmd1YWdlTW9kYWw6IGZhbHNlLFxuICAgICAgc2V0dGluZ3M6IHtcbiAgICAgICAgbGFzdFNhdmVkOiAnJyxcbiAgICAgICAgc2hvd01hcmtkb3duVG9vbGJhcjogdHJ1ZSxcbiAgICAgICAgc2hvd0Jvb2tTdGF0czogdHJ1ZSxcbiAgICAgICAgaXNTaWRlYmFyQ29udGVudEhpZGRlbjogZmFsc2UsXG4gICAgICAgIHByZXZpZXdMb2NhdGlvbjogJ2JvdHRvbSdcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gV2UgZG9uJ3QgaGF2ZSB0byBwdXQgbWV0aG9kcyBvbiBzdGF0ZSwgdGhleSBhcmUgc3RhdGljICYgd2lsbCBub3QgY2hhbmdlXG4gICAgdGhpcy5tZXRob2RzID0ge1xuICAgICAgc2V0U2V0dGluZzogdGhpcy5zZXRTZXR0aW5nLFxuICAgICAgYXRGaXJzdENoYXB0ZXI6IHRoaXMuYXRGaXJzdENoYXB0ZXIsXG4gICAgICBhdExhc3RDaGFwdGVyOiB0aGlzLmF0TGFzdENoYXB0ZXIsXG4gICAgICBzZWxlY3ROZXh0Q2hhcHRlcjogdGhpcy5zZWxlY3ROZXh0Q2hhcHRlcixcbiAgICAgIHNlbGVjdFByZXZpb3VzQ2hhcHRlcjogdGhpcy5zZWxlY3RQcmV2aW91c0NoYXB0ZXIsXG4gICAgICBoYW5kbGVTZWxlY3RDaGFwdGVyOiB0aGlzLmhhbmRsZVNlbGVjdENoYXB0ZXIsXG4gICAgICBoYW5kbGVDcmVhdGVDaGFwdGVyOiB0aGlzLmhhbmRsZUNyZWF0ZUNoYXB0ZXIsXG4gICAgICBoYW5kbGVEZWxldGVDaGFwdGVyOiB0aGlzLmhhbmRsZURlbGV0ZUNoYXB0ZXIsXG4gICAgICBoYW5kbGVTaWRlYmFyQ29udGVudFRvZ2dsZTogdGhpcy5oYW5kbGVTaWRlYmFyQ29udGVudFRvZ2dsZSxcbiAgICAgIGhhbmRsZVRvZ2dsZUxhbmd1YWdlTW9kYWw6IHRoaXMuaGFuZGxlVG9nZ2xlTGFuZ3VhZ2VNb2RhbCxcbiAgICAgIHNhdmVEcmFmdDogdGhpcy5zYXZlRHJhZnRcbiAgICB9O1xuXG4gICAgLy8gVE9ETzogRmFrZSBwYXNzaW5nIHNvbWUgYm9vayBkYXRhXG4gICAgdGhpcy5mYWtlUHJvcHMgPSB7XG4gICAgICBib29rOiB7XG4gICAgICAgIHRpdGxlU2x1ZzogJ2Zha2UtYm9vaycsXG4gICAgICAgIGRyYWZ0OiB7XG4gICAgICAgICAgY2hhcHRlckxpc3Q6IFsnY2hrZXkxJ10sXG4gICAgICAgICAgY2hhcHRlcnM6IHtcbiAgICAgICAgICAgICdjaGtleTEnOiB7XG4gICAgICAgICAgICAgIHRpdGxlOiAnQ2hhcHRlciAxJyxcbiAgICAgICAgICAgICAgdGV4dDogJzxoMT5IZWxsbyB3b3JsZC48L2gxPidcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IChuZXh0UHJvcHMpID0+IHtcbiAgICAvKiBUT0RPOiBBZGRpbmcgRmFrZSBkYXRhIGhlcmUsIGhvb2sgdXAgdG8gbmV3IGFwaSAqL1xuICAgIC8vIElmIHdlJ3JlIG5vIGxvbmdlciBsb2FkaW5nICYgYm9vayBpcyBudWxsLCB3ZSBkb24ndCBoYXZlIHByb3BlciBhY2Nlc3MuXG4gICAgLy8gaWYgKCFuZXh0UHJvcHMuc3Vic2NyaXB0aW9uTG9hZGluZyAmJiAhbmV4dFByb3BzLmJvb2spIHtcbiAgICAvLyAgIC8vIFdlIHdhbnQgdG8gdXNlIHJlcGxhY2UgaW5zdGVhZCBvZiBwdXNoXG4gICAgLy8gICAvLyBzbyB0aGUgYmFkIHVybCBkb2Vzbid0IHN0YXkgaW4gaGlzdG9yeVxuICAgIC8vICAgYnJvd3Nlckhpc3RvcnkucmVwbGFjZSgnLycpO1xuICAgIC8vIH1cbiAgICAvLyBJZiB3ZSdyZSBub3Qgd2FpdGluZyBvbiB0aGUgc3Vic2NyaXB0aW9uIGFueW1vcmUsICYgd2UgaGF2ZW4ndCBzZXQgdXAgb3VyXG4gICAgLy8gc3RhdGUgYmFzZWQgb2ZmIHNvbWUgYm9vayBwcm9wZXJ0aWVzLCBsZXQncyBkbyB0aGF0IG5vdy5cbiAgICAvLyBpZiAoIW5leHRQcm9wcy5zdWJzY3JpcHRpb25Mb2FkaW5nICYmXG4gICAgLy8gICBuZXh0UHJvcHMuYm9vayAmJiAhdGhpcy5zdGF0ZS5sb2FkZWQpIHtcbiAgICAvLyAgIC8vIFRoZSBzZWxlY3RlZCBjaGFwdGVyIHdpbGwgYmUgdGhlIGZpcnN0IGtleSBpbiB0aGUgY2hhcHRlciBsaXN0XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGVkQ2hhcHRlcjogdGhpcy5mYWtlUHJvcHMuYm9vay5kcmFmdC5jaGFwdGVyTGlzdFswXSB9KTtcbiAgICB0aGlzLnNldFN0YXRlKHsgbG9hZGVkOiB0cnVlIH0pO1xuICAgIC8vIH1cbiAgfTtcblxuICAvKipcbiAgICogVGhpcyB3aWxsIGJlIHRoZSBtYWluIGVudHJ5IHBvaW50IGZvciBzYXZpbmcgdGhlIGRyYWZ0XG4gICAqL1xuICBzYXZlRHJhZnQgPSAoZHJhZnQsIHN1Y2Nlc3NDYWxsYmFjaywgZXJyb3JDYWxsYmFjaykgPT4ge1xuICAgIHRoaXMuc2V0U2V0dGluZygnbGFzdFNhdmVkJywgJ1NhdmluZy4uLicpO1xuICAgIC8qIFRPRE86IE5vIGxvbmdlciB1c2luZyBNZXRlb3IgKi9cbiAgICAvLyBNZXRlb3IuY2FsbCgndXBkYXRlQm9va0RyYWZ0JywgdGhpcy5mYWtlUHJvcHMuYm9vay5faWQsIGRyYWZ0LCAoZXJyKSA9PiB7XG4gICAgLy8gICBpZiAoIWVycikge1xuICAgIC8vICAgICB0aGlzLnNldFNldHRpbmcoXG4gICAgLy8gICAgICAgJ2xhc3RTYXZlZCcsXG4gICAgLy8gICAgICAgYExhc3Qgc2F2ZWQ6ICR7bW9tZW50KG5ldyBEYXRlKCkpLmZvcm1hdCgnaDptbTpzcyBhJyl9YFxuICAgIC8vICAgICApO1xuICAgIC8vICAgICBpZiAoc3VjY2Vzc0NhbGxiYWNrKSB7XG4gICAgLy8gICAgICAgc3VjY2Vzc0NhbGxiYWNrKCk7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH0gZWxzZSB7XG4gICAgLy8gICAgIGNvbnNvbGUubG9nKCdFcnJvciBzYXZpbmcgdGhlIGRyYWZ0OiAnLCBlcnIpO1xuICAgIC8vICAgICBpZiAoZXJyb3JDYWxsYmFjaykge1xuICAgIC8vICAgICAgIGVycm9yQ2FsbGJhY2soKTtcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIH0pO1xuICB9O1xuXG4gIHNldFNldHRpbmcgPSAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgIGNvbnN0IHNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zdGF0ZS5zZXR0aW5ncyk7XG4gICAgc2V0dGluZ3Nba2V5XSA9IHZhbHVlO1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzZXR0aW5ncyB9KTtcbiAgfTtcblxuICBhdEZpcnN0Q2hhcHRlciA9ICgpID0+XG4gIHRoaXMuZmFrZVByb3BzLmJvb2suZHJhZnQuY2hhcHRlckxpc3QuaW5kZXhPZih0aGlzLnN0YXRlLnNlbGVjdGVkQ2hhcHRlcikgPT09IDA7XG5cbiAgYXRMYXN0Q2hhcHRlciA9ICgpID0+XG4gIHRoaXMuZmFrZVByb3BzLmJvb2suZHJhZnQuY2hhcHRlckxpc3QuaW5kZXhPZih0aGlzLnN0YXRlLnNlbGVjdGVkQ2hhcHRlcikgPT09XG4gICh0aGlzLmZha2VQcm9wcy5ib29rLmRyYWZ0LmNoYXB0ZXJMaXN0Lmxlbmd0aCAtIDEpO1xuXG4gIHNlbGVjdE5leHRDaGFwdGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGNoYXB0ZXJMaXN0ID0gdGhpcy5mYWtlUHJvcHMuYm9vay5kcmFmdC5jaGFwdGVyTGlzdDtcbiAgICBjb25zdCBpZHggPSBjaGFwdGVyTGlzdC5pbmRleE9mKHRoaXMuc3RhdGUuc2VsZWN0ZWRDaGFwdGVyKTtcbiAgICBpZiAoY2hhcHRlckxpc3RbaWR4ICsgMV0pIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBzZWxlY3RlZENoYXB0ZXI6IGNoYXB0ZXJMaXN0W2lkeCArIDFdIH0pO1xuICAgIH1cbiAgfTtcblxuICBzZWxlY3RQcmV2aW91c0NoYXB0ZXIgPSAoKSA9PiB7XG4gICAgY29uc3QgY2hhcHRlckxpc3QgPSB0aGlzLmZha2VQcm9wcy5ib29rLmRyYWZ0LmNoYXB0ZXJMaXN0O1xuICAgIGNvbnN0IGlkeCA9IGNoYXB0ZXJMaXN0LmluZGV4T2YodGhpcy5zdGF0ZS5zZWxlY3RlZENoYXB0ZXIpO1xuICAgIGlmIChjaGFwdGVyTGlzdFtpZHggLSAxXSkge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGVkQ2hhcHRlcjogY2hhcHRlckxpc3RbaWR4IC0gMV0gfSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCB3aWxsIGdldCBwYXNzZWQgZG93biB0aHJvdWdoIHByb3BzIHNvIHRoYXQgd2UgY2FuXG4gICAqIHNlbGVjdCBhIGNoYXB0ZXIgZnJvbSBhIGNoaWxkIGNvbXBvbmVudCBhbmQgY2hhbmdlIHRoZSBzdGF0ZSBvZiB0aGlzXG4gICAqIGNvbXBvbmVudC5cbiAgICovXG4gIGhhbmRsZVNlbGVjdENoYXB0ZXIgPSAoc2VsZWN0ZWRDaGFwdGVyKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGVkQ2hhcHRlciB9KTtcbiAgfTtcblxuICBoYW5kbGVDcmVhdGVDaGFwdGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGRyYWZ0ID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5mYWtlUHJvcHMuYm9vay5kcmFmdCk7XG4gICAgLyogVE9ETzogRmlndXJlIG91dCBuZXcgd2F5IHRvIGRvIGNoYXB0ZXIga2V5ICovXG4gICAgY29uc3QgY2hhcHRlcktleSA9ICdDSEFOR0UgTUUnO1xuICAgIGRyYWZ0LmNoYXB0ZXJzW2NoYXB0ZXJLZXldID0gbmV3Q2hhcHRlcjtcbiAgICBkcmFmdC5jaGFwdGVyTGlzdC5wdXNoKGNoYXB0ZXJLZXkpO1xuICAgIHRoaXMuc2F2ZURyYWZ0KGRyYWZ0LCAoKSA9PiB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgc2VsZWN0ZWRDaGFwdGVyOiBjaGFwdGVyS2V5IH0pO1xuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBGb3Igbm93LCB3ZSB3aWxsIGhhbmRsZSBcImRlbGV0aW5nXCIgYSBjaGFwdGVyIGZyb20gdGhlIGRyYWZ0XG4gICAqIGFzIGp1c3QgcmVtb3ZpbmcgdGhlIGtleSBmcm9tIHRoZSBjaGFwdGVyIGxpc3QuIFRoaXMgd2F5IHdlIGNvdWxkIGFkZFxuICAgKiBmdW5jdGlvbmFsaXR5IGZvciB1c2VycyB0byBzZWUgdGhlaXIgZGVsZXRlZCBjaGFwdGVycywgJiB0aGVuICdwZXJtYW5lbnRseSdcbiAgICogZGVsZXRlIHRob3NlIGNoYXB0ZXJzLlxuICAgKlxuICAgKiBJZiB0aGVyZSdzIG9ubHkgMSBjaGFwdGVyIHJlbWFpbmluZywgbGV0J3Mgbm90IGxldCB0aGVtIGRlbGV0ZSBpdC5cbiAgICovXG4gIGhhbmRsZURlbGV0ZUNoYXB0ZXIgPSAoKSA9PiB7XG4gICAgY29uc3QgZHJhZnQgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLmZha2VQcm9wcy5ib29rLmRyYWZ0KTtcbiAgICAvLyBEb24ndCBkZWxldGUgdGhlIGxhc3QgY2hhcHRlci4gQSBib29rIG5lZWRzIGF0IGxlYXN0IDEgY2hhcHRlci5cbiAgICBpZiAoZHJhZnQuY2hhcHRlckxpc3QubGVuZ3RoID4gMSkge1xuICAgICAgbGV0IGlkeCA9IGRyYWZ0LmNoYXB0ZXJMaXN0LmluZGV4T2YodGhpcy5zdGF0ZS5zZWxlY3RlZENoYXB0ZXIpO1xuICAgICAgZHJhZnQuY2hhcHRlckxpc3Quc3BsaWNlKGlkeCwgMSk7XG4gICAgICB0aGlzLnNhdmVEcmFmdChkcmFmdCwgKCkgPT4ge1xuICAgICAgICBpZiAoaWR4ID49IGRyYWZ0LmNoYXB0ZXJMaXN0Lmxlbmd0aCkge1xuICAgICAgICAgIGlkeC0tO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoeyBzZWxlY3RlZENoYXB0ZXI6IGRyYWZ0LmNoYXB0ZXJMaXN0W2lkeF0gfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFRvZ2dsZXMgdGhlIHNpZGViYXIsIHVubGVzcyB0cnVlIGlzIHBhc3NlZCBpbi4gVGhpcyBlbnN1cmVzXG4gICAqIHRoZSBzaWRlYmFyIGlzIHNob3duLlxuICAgKiBAcGFyYW0gb3BlblxuICAgKi9cbiAgaGFuZGxlU2lkZWJhckNvbnRlbnRUb2dnbGUgPSAob3BlbiA9IGZhbHNlKSA9PiB7XG4gICAgY29uc3Qgc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnN0YXRlLnNldHRpbmdzKTtcbiAgICBpZiAob3Blbikge1xuICAgICAgc2V0dGluZ3MuaXNTaWRlYmFyQ29udGVudEhpZGRlbiA9IGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXR0aW5ncy5pc1NpZGViYXJDb250ZW50SGlkZGVuID0gIXNldHRpbmdzLmlzU2lkZWJhckNvbnRlbnRIaWRkZW47XG4gICAgfVxuICAgIHRoaXMuc2V0U3RhdGUoeyBzZXR0aW5ncyB9KTtcbiAgfTtcblxuICBoYW5kbGVUb2dnbGVMYW5ndWFnZU1vZGFsID0gKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdoYW5kbGVUb2dnbGVMYW5ndWFnZU1vZGFsJywgdGhpcy5zdGF0ZS5zaG93TGFuZ3VhZ2VNb2RhbCk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICBzaG93TGFuZ3VhZ2VNb2RhbDogIXRoaXMuc3RhdGUuc2hvd0xhbmd1YWdlTW9kYWxcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogSWYgdGhlIHBhZ2UgaXMgbG9hZGluZyBkbyBvbmUgdGhpbmcsIG9uY2UgdGhlIHBhZ2UgaXMgZG9uZSBsb2FkaW5nIGRvIGFcbiAgICogY2hlY2sgdG8gbWFrZSBzdXJlIHRoZXJlIGlzIGEgYm9vayB0byB2aWV3LlxuICAgKi9cbiAgcmVuZGVyKCkge1xuICAgIGNvbnNvbGUubG9nKCdSZW5kZXJpbmcgRWRpdG9yUGFnZScpO1xuICAgIC8vIE90aGVyd2lzZSwgbGV0J3MgbWFrZSBzdXJlIHRoZXJlJ3MgYSBib29rIG90aGVyd2lzZSByZWRpcmVjdFxuICAgIC8vIFRoZSBxdWVyeSBpdHNlbGYgZnJvbSB0aGUgc2VydmVyIHdpbGxcbiAgICAvLyBtYWtlIHN1cmUgdGhhdCB0aGUgcmlnaHQgYm9vayBpcyByZXR1cm5lZCBpZlxuICAgIC8vIGl0IGV4aXN0cyBmb3IgdGhpcyB1c2VyLiBXZSB3b3VsZG4ndCBsZWF2ZSB0aGF0IHVwIHRvIHRoZSBjbGllbnQuXG5cbiAgICAvLyBUT0RPOiBTRVRUSU5HIFRISVMgVE8gQUxXQVlTIExPQURFRCBGT1IgTk9XXG4gICAgaWYgKHRoaXMuc3RhdGUubG9hZGVkIHx8IHRydWUpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZWRpdG9yLXZpZXctY29udGFpbmVyXCI+XG4gICAgICAgICAgPFN0eWxlIHJ1bGVzPXt0aGlzLnN0YXRlLnN0eWxlfSAvPlxuICAgICAgICAgIDxQYW5lbE1vZGFsIHNob3c9e3RoaXMuc3RhdGUuc2hvd0xhbmd1YWdlTW9kYWx9IC8+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtYWluLXNpZGViYXItd3JhcHBlclwiPlxuICAgICAgICAgICAgPFNpZGViYXJFZGl0b3JcbiAgICAgICAgICAgICAgYm9vaz17dGhpcy5mYWtlUHJvcHMuYm9va31cbiAgICAgICAgICAgICAgc2VsZWN0ZWRDaGFwdGVyPXt0aGlzLnN0YXRlLnNlbGVjdGVkQ2hhcHRlcn1cbiAgICAgICAgICAgICAgc2V0dGluZ3M9e3RoaXMuc3RhdGUuc2V0dGluZ3N9XG4gICAgICAgICAgICAgIG1ldGhvZHM9e3RoaXMubWV0aG9kc31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJtYWluLWJvb2stY29udGVudC13cmFwcGVyXCI+XG4gICAgICAgICAgICA8TWFpbkVkaXRvclxuICAgICAgICAgICAgICBib29rPXt0aGlzLmZha2VQcm9wcy5ib29rfVxuICAgICAgICAgICAgICBzZWxlY3RlZENoYXB0ZXI9e3RoaXMuc3RhdGUuc2VsZWN0ZWRDaGFwdGVyfVxuICAgICAgICAgICAgICBzZXR0aW5ncz17dGhpcy5zdGF0ZS5zZXR0aW5nc31cbiAgICAgICAgICAgICAgbWV0aG9kcz17dGhpcy5tZXRob2RzfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG59XG5cbi8qKlxuICogVGhpcyBpcyB3aGVyZSB3ZSBhZGQgb3VyIGJvb2sgdG8gdGhlIHByb3BzIG9mIG91ciBjb21wb25lbnQuXG4gKiBTb21lIHRoaW5ncyB0byBub3RlIGFib3V0IHRoaXMuIFdoZW4gcHJvcHMgY2hhbmdlLCBpdCBjb3VsZCBjYXVzZSBvdXJcbiAqIGNvbXBvbmVudHMgdG8gcmUtcmVuZGVyLiBJZiB3ZSdyZSB0YWtpbmcgdGhlIGVudGlyZSBib29rIG9iamVjdCwgd2hlblxuICogYSByZWFkZXIgaXMgYWRkZWQsIG9yIGFub3RoZXIgdmFsdWUgaXMgY2hhbmdlZCBpdCBtYXkgY2F1c2Ugc29tZSB1bndhbnRlZFxuICogcmVuZGVyaW5nLiBXZSB3aWxsIGhhdmUgdG8gY2FyZWZ1bGx5IGluc3BlY3QgdGhpcyBhY3Rpdml0eSBhbmQgcHJvcGVybHlcbiAqIGFkanVzdCBpbiBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzLlxuICpcbiAqIHJldHVybjogYm9vayBhbmQgbG9hZGluZyBhcmUgYm90aCByZWFjdGl2ZSBkYXRhIHNvdXJjZXMuIGJvb2sgaXMgcmVhY3RpdmVcbiAqIGJlY2F1c2UgaXQgY29tZXMgZnJvbSBhIG1ldGVvciBtb25nb2RiIHJlYWN0aXZlIGVudmlyb25tZW50LiBsb2FkaW5nIGlzIGFcbiAqIHJlYWN0aXZlIHZhcmlhYmxlIHRoYXQgaXMgdGhlIHN1YnNjcmlwdGlvbiBoYW5kbGVyIGZvciBib29rLiBXaGVuIHRoZVxuICogc3Vic2NyaXB0aW9uIGlzIHJlYWR5LCBsb2FkaW5nIHdpbGwgYmUgZmFsc2UgKGJlY2F1c2Ugd2UgYXJlIGFzc2lnbmluZyBpdFxuICogdGhlIG5lZ2F0ZSB2YWx1ZSBvZiB0aGUgaGFuZGxlci5yZWFkeSgpIGZ1bmN0aW9uKVxuICovXG4vLyBleHBvcnQgZGVmYXVsdCBjcmVhdGVDb250YWluZXIoKHByb3BzKSA9PiB7XG4vLyAgIC8vIEdldCB0aGUgYm9vayBmcm9tIHRoZSBzbHVnXG4vLyAgIGNvbnN0IGJvb2tIYW5kbGUgPSBNZXRlb3Iuc3Vic2NyaWJlKFxuLy8gICAgICdnZXRCb29rRm9yQm9va0VkaXQnLFxuLy8gICAgIHByb3BzLnBhcmFtcy5ib29rU2x1Z1xuLy8gICApO1xuLy8gICAvLyBBIHZhcmlhYmxlIHRvIHNlZSBpZiB0aGUgYm9vayBpcyBzdGlsbCBsb2FkaW5nXG4vLyAgIGNvbnN0IHN1YnNjcmlwdGlvbkxvYWRpbmcgPSAhYm9va0hhbmRsZS5yZWFkeSgpO1xuLy8gICBjb25zdCBib29rID0gQm9va3MuZmluZCh7fSkuZmV0Y2goKVswXTtcbi8vICAgcmV0dXJuIHtcbi8vICAgICBzdWJzY3JpcHRpb25Mb2FkaW5nLFxuLy8gICAgIGJvb2tcbi8vICAgfTtcbi8vIH0sIEVkaXRvclBhZ2UpO1xuXG5leHBvcnQgZGVmYXVsdCBFZGl0b3JQYWdlO1xuXG4iXX0=