'use strict';exports.__esModule=true;var _assign=require('babel-runtime/core-js/object/assign');var _assign2=_interopRequireDefault(_assign);var _getPrototypeOf=require('babel-runtime/core-js/object/get-prototype-of');var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require('babel-runtime/helpers/possibleConstructorReturn');var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require('babel-runtime/helpers/inherits');var _inherits3=_interopRequireDefault(_inherits2);var _class,_temp,_jsxFileName='components/pages/EditorPage/EditorPage.jsx';var _jassy=require('jassy');var _react=require('react');var _react2=_interopRequireDefault(_react);var _moment=require('moment');var _moment2=_interopRequireDefault(_moment);var _book_edit_helpers=require('../../../core/utils/book_helpers/book_edit_helpers');var _MainEditor=require('./MainEditor');var _MainEditor2=_interopRequireDefault(_MainEditor);var _editorPage=require('./editorPage.style');var _editorPage2=_interopRequireDefault(_editorPage);var _SidebarEditor=require('./SidebarEditor');var _SidebarEditor2=_interopRequireDefault(_SidebarEditor);var _modals=require('../../modals');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EditorPage=(_temp=_class=function(_React$Component){(0,_inherits3.default)(EditorPage,_React$Component);function EditorPage(props){(0,_classCallCheck3.default)(this,EditorPage);var _this=(0,_possibleConstructorReturn3.default)(this,(EditorPage.__proto__||(0,_getPrototypeOf2.default)(EditorPage)).call(this,props));_this.componentWillReceiveProps=function(){return _this.__componentWillReceiveProps__REACT_HOT_LOADER__.apply(_this,arguments)};_this.saveDraft=function(){return _this.__saveDraft__REACT_HOT_LOADER__.apply(_this,arguments)};_this.setSetting=function(){return _this.__setSetting__REACT_HOT_LOADER__.apply(_this,arguments)};_this.atFirstChapter=function(){return _this.__atFirstChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.atLastChapter=function(){return _this.__atLastChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.selectNextChapter=function(){return _this.__selectNextChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.selectPreviousChapter=function(){return _this.__selectPreviousChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleSelectChapter=function(){return _this.__handleSelectChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleCreateChapter=function(){return _this.__handleCreateChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleDeleteChapter=function(){return _this.__handleDeleteChapter__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleSidebarContentToggle=function(){return _this.__handleSidebarContentToggle__REACT_HOT_LOADER__.apply(_this,arguments)};_this.handleToggleLanguageModal=function(){return _this.__handleToggleLanguageModal__REACT_HOT_LOADER__.apply(_this,arguments)};_this.state={style:(0,_editorPage2.default)(),selectedChapter:'chkey1',loaded:false,showLanguageModal:false,settings:{lastSaved:'',showMarkdownToolbar:true,showBookStats:true,isSidebarContentHidden:false,previewLocation:'bottom'}};_this.methods={setSetting:_this.setSetting,atFirstChapter:_this.atFirstChapter,atLastChapter:_this.atLastChapter,selectNextChapter:_this.selectNextChapter,selectPreviousChapter:_this.selectPreviousChapter,handleSelectChapter:_this.handleSelectChapter,handleCreateChapter:_this.handleCreateChapter,handleDeleteChapter:_this.handleDeleteChapter,handleSidebarContentToggle:_this.handleSidebarContentToggle,handleToggleLanguageModal:_this.handleToggleLanguageModal,saveDraft:_this.saveDraft};_this.fakeProps={book:{titleSlug:'fake-book',draft:{chapterList:['chkey1'],chapters:{'chkey1':{title:'Chapter 1',text:'<h1>Hello world.</h1>'}}}}};return _this}(0,_createClass3.default)(EditorPage,[{key:'__componentWillReceiveProps__REACT_HOT_LOADER__',value:function __componentWillReceiveProps__REACT_HOT_LOADER__(){return this.__componentWillReceiveProps__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__componentWillReceiveProps__REACT_HOT_LOADER__',value:function __componentWillReceiveProps__REACT_HOT_LOADER__(nextProps){this.setState({selectedChapter:this.fakeProps.book.draft.chapterList[0]});this.setState({loaded:true})}},{key:'__saveDraft__REACT_HOT_LOADER__',value:function __saveDraft__REACT_HOT_LOADER__(){return this.__saveDraft__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__saveDraft__REACT_HOT_LOADER__',value:function __saveDraft__REACT_HOT_LOADER__(draft,successCallback,errorCallback){this.setSetting('lastSaved','Saving...')}},{key:'__setSetting__REACT_HOT_LOADER__',value:function __setSetting__REACT_HOT_LOADER__(){return this.__setSetting__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__setSetting__REACT_HOT_LOADER__',value:function __setSetting__REACT_HOT_LOADER__(key,value){var settings=(0,_assign2.default)({},this.state.settings);settings[key]=value;this.setState({settings:settings})}},{key:'__atFirstChapter__REACT_HOT_LOADER__',value:function __atFirstChapter__REACT_HOT_LOADER__(){return this.__atFirstChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__atFirstChapter__REACT_HOT_LOADER__',value:function __atFirstChapter__REACT_HOT_LOADER__(){return this.fakeProps.book.draft.chapterList.indexOf(this.state.selectedChapter)===0}},{key:'__atLastChapter__REACT_HOT_LOADER__',value:function __atLastChapter__REACT_HOT_LOADER__(){return this.__atLastChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__atLastChapter__REACT_HOT_LOADER__',value:function __atLastChapter__REACT_HOT_LOADER__(){return this.fakeProps.book.draft.chapterList.indexOf(this.state.selectedChapter)===this.fakeProps.book.draft.chapterList.length-1}},{key:'__selectNextChapter__REACT_HOT_LOADER__',value:function __selectNextChapter__REACT_HOT_LOADER__(){return this.__selectNextChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__selectNextChapter__REACT_HOT_LOADER__',value:function __selectNextChapter__REACT_HOT_LOADER__(){var chapterList=this.fakeProps.book.draft.chapterList;var idx=chapterList.indexOf(this.state.selectedChapter);if(chapterList[idx+1]){this.setState({selectedChapter:chapterList[idx+1]})}}},{key:'__selectPreviousChapter__REACT_HOT_LOADER__',value:function __selectPreviousChapter__REACT_HOT_LOADER__(){return this.__selectPreviousChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__selectPreviousChapter__REACT_HOT_LOADER__',value:function __selectPreviousChapter__REACT_HOT_LOADER__(){var chapterList=this.fakeProps.book.draft.chapterList;var idx=chapterList.indexOf(this.state.selectedChapter);if(chapterList[idx-1]){this.setState({selectedChapter:chapterList[idx-1]})}}},{key:'__handleSelectChapter__REACT_HOT_LOADER__',value:function __handleSelectChapter__REACT_HOT_LOADER__(){return this.__handleSelectChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleSelectChapter__REACT_HOT_LOADER__',value:function __handleSelectChapter__REACT_HOT_LOADER__(selectedChapter){this.setState({selectedChapter:selectedChapter})}},{key:'__handleCreateChapter__REACT_HOT_LOADER__',value:function __handleCreateChapter__REACT_HOT_LOADER__(){return this.__handleCreateChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleCreateChapter__REACT_HOT_LOADER__',value:function __handleCreateChapter__REACT_HOT_LOADER__(){var _this2=this;var draft=(0,_assign2.default)({},this.fakeProps.book.draft);var chapterKey='CHANGE ME';draft.chapters[chapterKey]=_book_edit_helpers.newChapter;draft.chapterList.push(chapterKey);this.saveDraft(draft,function(){_this2.setState({selectedChapter:chapterKey})})}},{key:'__handleDeleteChapter__REACT_HOT_LOADER__',value:function __handleDeleteChapter__REACT_HOT_LOADER__(){return this.__handleDeleteChapter__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleDeleteChapter__REACT_HOT_LOADER__',value:function __handleDeleteChapter__REACT_HOT_LOADER__(){var _this3=this;var draft=(0,_assign2.default)({},this.fakeProps.book.draft);if(draft.chapterList.length>1){var idx=draft.chapterList.indexOf(this.state.selectedChapter);draft.chapterList.splice(idx,1);this.saveDraft(draft,function(){if(idx>=draft.chapterList.length){idx--}_this3.setState({selectedChapter:draft.chapterList[idx]})})}}},{key:'__handleSidebarContentToggle__REACT_HOT_LOADER__',value:function __handleSidebarContentToggle__REACT_HOT_LOADER__(){return this.__handleSidebarContentToggle__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleSidebarContentToggle__REACT_HOT_LOADER__',value:function __handleSidebarContentToggle__REACT_HOT_LOADER__(){var open=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var settings=(0,_assign2.default)({},this.state.settings);if(open){settings.isSidebarContentHidden=false}else{settings.isSidebarContentHidden=!settings.isSidebarContentHidden}this.setState({settings:settings})}},{key:'__handleToggleLanguageModal__REACT_HOT_LOADER__',value:function __handleToggleLanguageModal__REACT_HOT_LOADER__(){return this.__handleToggleLanguageModal__REACT_HOT_LOADER__.apply(this,arguments)}},{key:'__handleToggleLanguageModal__REACT_HOT_LOADER__',value:function __handleToggleLanguageModal__REACT_HOT_LOADER__(){console.log('handleToggleLanguageModal',this.state.showLanguageModal);this.setState({showLanguageModal:!this.state.showLanguageModal})}},{key:'render',value:function render(){console.log('Rendering EditorPage');if(this.state.loaded||true){return _react2.default.createElement('div',{className:'editor-view-container',__source:{fileName:_jsxFileName,lineNumber:223}},_react2.default.createElement(_jassy.Style,{rules:this.state.style,__source:{fileName:_jsxFileName,lineNumber:224}}),_react2.default.createElement(_modals.PanelModal,{show:this.state.showLanguageModal,__source:{fileName:_jsxFileName,lineNumber:225}}),_react2.default.createElement('div',{className:'main-sidebar-wrapper',__source:{fileName:_jsxFileName,lineNumber:226}},_react2.default.createElement(_SidebarEditor2.default,{book:this.fakeProps.book,selectedChapter:this.state.selectedChapter,settings:this.state.settings,methods:this.methods,__source:{fileName:_jsxFileName,lineNumber:227}})),_react2.default.createElement('div',{className:'main-book-content-wrapper',__source:{fileName:_jsxFileName,lineNumber:234}},_react2.default.createElement(_MainEditor2.default,{book:this.fakeProps.book,selectedChapter:this.state.selectedChapter,settings:this.state.settings,methods:this.methods,__source:{fileName:_jsxFileName,lineNumber:235}})))}return null}}]);return EditorPage}(_react2.default.Component),_class.displayName='EditorPage',_temp);var _default=EditorPage;exports.default=_default;;var _temp2=function(){if(typeof __REACT_HOT_LOADER__==='undefined'){return}__REACT_HOT_LOADER__.register(EditorPage,'EditorPage','components/pages/EditorPage/EditorPage.jsx');__REACT_HOT_LOADER__.register(_default,'default','components/pages/EditorPage/EditorPage.jsx')}();;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkVkaXRvclBhZ2UuanN4Il0sIm5hbWVzIjpbIkVkaXRvclBhZ2UiLCJwcm9wcyIsImNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMiLCJzYXZlRHJhZnQiLCJzZXRTZXR0aW5nIiwiYXRGaXJzdENoYXB0ZXIiLCJhdExhc3RDaGFwdGVyIiwic2VsZWN0TmV4dENoYXB0ZXIiLCJzZWxlY3RQcmV2aW91c0NoYXB0ZXIiLCJoYW5kbGVTZWxlY3RDaGFwdGVyIiwiaGFuZGxlQ3JlYXRlQ2hhcHRlciIsImhhbmRsZURlbGV0ZUNoYXB0ZXIiLCJoYW5kbGVTaWRlYmFyQ29udGVudFRvZ2dsZSIsImhhbmRsZVRvZ2dsZUxhbmd1YWdlTW9kYWwiLCJzdGF0ZSIsInN0eWxlIiwic2VsZWN0ZWRDaGFwdGVyIiwibG9hZGVkIiwic2hvd0xhbmd1YWdlTW9kYWwiLCJzZXR0aW5ncyIsImxhc3RTYXZlZCIsInNob3dNYXJrZG93blRvb2xiYXIiLCJzaG93Qm9va1N0YXRzIiwiaXNTaWRlYmFyQ29udGVudEhpZGRlbiIsInByZXZpZXdMb2NhdGlvbiIsIm1ldGhvZHMiLCJmYWtlUHJvcHMiLCJib29rIiwidGl0bGVTbHVnIiwiZHJhZnQiLCJjaGFwdGVyTGlzdCIsImNoYXB0ZXJzIiwidGl0bGUiLCJ0ZXh0IiwibmV4dFByb3BzIiwic2V0U3RhdGUiLCJzdWNjZXNzQ2FsbGJhY2siLCJlcnJvckNhbGxiYWNrIiwia2V5IiwidmFsdWUiLCJpbmRleE9mIiwibGVuZ3RoIiwiaWR4IiwiY2hhcHRlcktleSIsInB1c2giLCJzcGxpY2UiLCJvcGVuIiwiY29uc29sZSIsImxvZyIsIkNvbXBvbmVudCIsImRpc3BsYXlOYW1lIl0sIm1hcHBpbmdzIjoiczNCQUFBLDRCQUNBLDRCLDJDQUNBLDhCLDZDQUdBLHFGQUNBLHdDLHFEQUNBLDhDLHFEQUNBLDhDLDJEQUNBLG9DLHFGQU1NQSxXLDhGQU9KLG9CQUFZQyxLQUFaLENBQW1CLGlMQUNYQSxLQURXLFNBa0RuQkMseUJBbERtQix1R0F1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S00sT0FKaEIsa0RBREYsQ0FIRixDQVdFLHFDQUFLLFVBQVUsMkJBQWYsa0RBQ0Usb0RBQ0UsS0FBTSxLQUFLQyxTQUFMLENBQWVDLElBRHZCLENBRUUsZ0JBQWlCLEtBQUtiLEtBQUwsQ0FBV0UsZUFGOUIsQ0FHRSxTQUFVLEtBQUtGLEtBQUwsQ0FBV0ssUUFIdkIsQ0FJRSxRQUFTLEtBQUtNLE9BSmhCLGtEQURGLENBWEYsQ0FxQkgsQ0FDRCxNQUFPLEtBQ1IsQyx1QkF0T3NCLGdCQUFNd0IsUyxTQUV0QkMsVyxDQUFjLFkscUJBcVFSbEQsVSxvSUF2UVRBLFUiLCJmaWxlIjoiRWRpdG9yUGFnZS5qc3giLCJzb3VyY2VSb290IjoiL1VzZXJzL3RvbnluZ3V5ZW4vSWRlYVByb2plY3RzL2NvZGVmb3JhcHBzL3Rvb2xzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3R5bGUgfSBmcm9tICdqYXNzeSc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuLy8gaW1wb3J0IHsgYnJvd3Nlckhpc3RvcnkgfSBmcm9tICdyZWFjdC1yb3V0ZXInO1xuXG5pbXBvcnQgeyBuZXdDaGFwdGVyIH0gZnJvbSAnLi4vLi4vLi4vY29yZS91dGlscy9ib29rX2hlbHBlcnMvYm9va19lZGl0X2hlbHBlcnMnO1xuaW1wb3J0IE1haW5FZGl0b3IgZnJvbSAnLi9NYWluRWRpdG9yJztcbmltcG9ydCBlZGl0b3JQYWdlU3R5bGUgZnJvbSAnLi9lZGl0b3JQYWdlLnN0eWxlJztcbmltcG9ydCBTaWRlYmFyRWRpdG9yIGZyb20gJy4vU2lkZWJhckVkaXRvcic7XG5pbXBvcnQgeyBQYW5lbE1vZGFsIH0gZnJvbSAnLi4vLi4vbW9kYWxzJztcbi8vIGltcG9ydCB7IEJvb2tzIH0gZnJvbSAnL2ltcG9ydHMvYXBpL2Jvb2tzJztcblxuLy8gVE9ETzogV2Ugd2lsbCBoYXZlIHRvIG1ha2Ugc3VyZSB0aGUgYm9vayBleGlzdHMgd2hlbiBoaXR0aW5nIHRoaXMgcGFnZVxuLy8gVE9ETzogSWYgbm90IHRoZSB1c2VyIHNob3VsZCBiZSByZWRpcmVjdGVkLlxuXG5jbGFzcyBFZGl0b3JQYWdlIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcblxuICBzdGF0aWMgZGlzcGxheU5hbWUgPSAnRWRpdG9yUGFnZSc7XG5cbiAgLyoqXG4gICAqIEVkaXRvclBhZ2UgaXMgdGhlIGVudHJ5IHBvaW50IGZvciBvdXIgZWRpdGluZyBjb21wb25lbnQuXG4gICAqL1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIC8vIFNldCB1cCBvdXIgaW5pdGlhbCBzdGF0ZSBmb3Igb3VyIGVudGlyZSBib29rIGVkaXRpbmcgY29tcG9uZW50LlxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBzdHlsZTogZWRpdG9yUGFnZVN0eWxlKCksXG4gICAgICBzZWxlY3RlZENoYXB0ZXI6ICdjaGtleTEnLFxuICAgICAgbG9hZGVkOiBmYWxzZSxcbiAgICAgIHNob3dMYW5ndWFnZU1vZGFsOiBmYWxzZSxcbiAgICAgIHNldHRpbmdzOiB7XG4gICAgICAgIGxhc3RTYXZlZDogJycsXG4gICAgICAgIHNob3dNYXJrZG93blRvb2xiYXI6IHRydWUsXG4gICAgICAgIHNob3dCb29rU3RhdHM6IHRydWUsXG4gICAgICAgIGlzU2lkZWJhckNvbnRlbnRIaWRkZW46IGZhbHNlLFxuICAgICAgICBwcmV2aWV3TG9jYXRpb246ICdib3R0b20nXG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIFdlIGRvbid0IGhhdmUgdG8gcHV0IG1ldGhvZHMgb24gc3RhdGUsIHRoZXkgYXJlIHN0YXRpYyAmIHdpbGwgbm90IGNoYW5nZVxuICAgIHRoaXMubWV0aG9kcyA9IHtcbiAgICAgIHNldFNldHRpbmc6IHRoaXMuc2V0U2V0dGluZyxcbiAgICAgIGF0Rmlyc3RDaGFwdGVyOiB0aGlzLmF0Rmlyc3RDaGFwdGVyLFxuICAgICAgYXRMYXN0Q2hhcHRlcjogdGhpcy5hdExhc3RDaGFwdGVyLFxuICAgICAgc2VsZWN0TmV4dENoYXB0ZXI6IHRoaXMuc2VsZWN0TmV4dENoYXB0ZXIsXG4gICAgICBzZWxlY3RQcmV2aW91c0NoYXB0ZXI6IHRoaXMuc2VsZWN0UHJldmlvdXNDaGFwdGVyLFxuICAgICAgaGFuZGxlU2VsZWN0Q2hhcHRlcjogdGhpcy5oYW5kbGVTZWxlY3RDaGFwdGVyLFxuICAgICAgaGFuZGxlQ3JlYXRlQ2hhcHRlcjogdGhpcy5oYW5kbGVDcmVhdGVDaGFwdGVyLFxuICAgICAgaGFuZGxlRGVsZXRlQ2hhcHRlcjogdGhpcy5oYW5kbGVEZWxldGVDaGFwdGVyLFxuICAgICAgaGFuZGxlU2lkZWJhckNvbnRlbnRUb2dnbGU6IHRoaXMuaGFuZGxlU2lkZWJhckNvbnRlbnRUb2dnbGUsXG4gICAgICBoYW5kbGVUb2dnbGVMYW5ndWFnZU1vZGFsOiB0aGlzLmhhbmRsZVRvZ2dsZUxhbmd1YWdlTW9kYWwsXG4gICAgICBzYXZlRHJhZnQ6IHRoaXMuc2F2ZURyYWZ0XG4gICAgfTtcblxuICAgIC8vIFRPRE86IEZha2UgcGFzc2luZyBzb21lIGJvb2sgZGF0YVxuICAgIHRoaXMuZmFrZVByb3BzID0ge1xuICAgICAgYm9vazoge1xuICAgICAgICB0aXRsZVNsdWc6ICdmYWtlLWJvb2snLFxuICAgICAgICBkcmFmdDoge1xuICAgICAgICAgIGNoYXB0ZXJMaXN0OiBbJ2Noa2V5MSddLFxuICAgICAgICAgIGNoYXB0ZXJzOiB7XG4gICAgICAgICAgICAnY2hrZXkxJzoge1xuICAgICAgICAgICAgICB0aXRsZTogJ0NoYXB0ZXIgMScsXG4gICAgICAgICAgICAgIHRleHQ6ICc8aDE+SGVsbG8gd29ybGQuPC9oMT4nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgPSAobmV4dFByb3BzKSA9PiB7XG4gICAgLyogVE9ETzogQWRkaW5nIEZha2UgZGF0YSBoZXJlLCBob29rIHVwIHRvIG5ldyBhcGkgKi9cbiAgICAvLyBJZiB3ZSdyZSBubyBsb25nZXIgbG9hZGluZyAmIGJvb2sgaXMgbnVsbCwgd2UgZG9uJ3QgaGF2ZSBwcm9wZXIgYWNjZXNzLlxuICAgIC8vIGlmICghbmV4dFByb3BzLnN1YnNjcmlwdGlvbkxvYWRpbmcgJiYgIW5leHRQcm9wcy5ib29rKSB7XG4gICAgLy8gICAvLyBXZSB3YW50IHRvIHVzZSByZXBsYWNlIGluc3RlYWQgb2YgcHVzaFxuICAgIC8vICAgLy8gc28gdGhlIGJhZCB1cmwgZG9lc24ndCBzdGF5IGluIGhpc3RvcnlcbiAgICAvLyAgIGJyb3dzZXJIaXN0b3J5LnJlcGxhY2UoJy8nKTtcbiAgICAvLyB9XG4gICAgLy8gSWYgd2UncmUgbm90IHdhaXRpbmcgb24gdGhlIHN1YnNjcmlwdGlvbiBhbnltb3JlLCAmIHdlIGhhdmVuJ3Qgc2V0IHVwIG91clxuICAgIC8vIHN0YXRlIGJhc2VkIG9mZiBzb21lIGJvb2sgcHJvcGVydGllcywgbGV0J3MgZG8gdGhhdCBub3cuXG4gICAgLy8gaWYgKCFuZXh0UHJvcHMuc3Vic2NyaXB0aW9uTG9hZGluZyAmJlxuICAgIC8vICAgbmV4dFByb3BzLmJvb2sgJiYgIXRoaXMuc3RhdGUubG9hZGVkKSB7XG4gICAgLy8gICAvLyBUaGUgc2VsZWN0ZWQgY2hhcHRlciB3aWxsIGJlIHRoZSBmaXJzdCBrZXkgaW4gdGhlIGNoYXB0ZXIgbGlzdFxuICAgIHRoaXMuc2V0U3RhdGUoeyBzZWxlY3RlZENoYXB0ZXI6IHRoaXMuZmFrZVByb3BzLmJvb2suZHJhZnQuY2hhcHRlckxpc3RbMF0gfSk7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGxvYWRlZDogdHJ1ZSB9KTtcbiAgICAvLyB9XG4gIH07XG5cbiAgLyoqXG4gICAqIFRoaXMgd2lsbCBiZSB0aGUgbWFpbiBlbnRyeSBwb2ludCBmb3Igc2F2aW5nIHRoZSBkcmFmdFxuICAgKi9cbiAgc2F2ZURyYWZ0ID0gKGRyYWZ0LCBzdWNjZXNzQ2FsbGJhY2ssIGVycm9yQ2FsbGJhY2spID0+IHtcbiAgICB0aGlzLnNldFNldHRpbmcoJ2xhc3RTYXZlZCcsICdTYXZpbmcuLi4nKTtcbiAgICAvKiBUT0RPOiBObyBsb25nZXIgdXNpbmcgTWV0ZW9yICovXG4gICAgLy8gTWV0ZW9yLmNhbGwoJ3VwZGF0ZUJvb2tEcmFmdCcsIHRoaXMuZmFrZVByb3BzLmJvb2suX2lkLCBkcmFmdCwgKGVycikgPT4ge1xuICAgIC8vICAgaWYgKCFlcnIpIHtcbiAgICAvLyAgICAgdGhpcy5zZXRTZXR0aW5nKFxuICAgIC8vICAgICAgICdsYXN0U2F2ZWQnLFxuICAgIC8vICAgICAgIGBMYXN0IHNhdmVkOiAke21vbWVudChuZXcgRGF0ZSgpKS5mb3JtYXQoJ2g6bW06c3MgYScpfWBcbiAgICAvLyAgICAgKTtcbiAgICAvLyAgICAgaWYgKHN1Y2Nlc3NDYWxsYmFjaykge1xuICAgIC8vICAgICAgIHN1Y2Nlc3NDYWxsYmFjaygpO1xuICAgIC8vICAgICB9XG4gICAgLy8gICB9IGVsc2Uge1xuICAgIC8vICAgICBjb25zb2xlLmxvZygnRXJyb3Igc2F2aW5nIHRoZSBkcmFmdDogJywgZXJyKTtcbiAgICAvLyAgICAgaWYgKGVycm9yQ2FsbGJhY2spIHtcbiAgICAvLyAgICAgICBlcnJvckNhbGxiYWNrKCk7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH1cbiAgICAvLyB9KTtcbiAgfTtcblxuICBzZXRTZXR0aW5nID0gKGtleSwgdmFsdWUpID0+IHtcbiAgICBjb25zdCBzZXR0aW5ncyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuc3RhdGUuc2V0dGluZ3MpO1xuICAgIHNldHRpbmdzW2tleV0gPSB2YWx1ZTtcbiAgICB0aGlzLnNldFN0YXRlKHsgc2V0dGluZ3MgfSk7XG4gIH07XG5cbiAgYXRGaXJzdENoYXB0ZXIgPSAoKSA9PlxuICB0aGlzLmZha2VQcm9wcy5ib29rLmRyYWZ0LmNoYXB0ZXJMaXN0LmluZGV4T2YodGhpcy5zdGF0ZS5zZWxlY3RlZENoYXB0ZXIpID09PSAwO1xuXG4gIGF0TGFzdENoYXB0ZXIgPSAoKSA9PlxuICB0aGlzLmZha2VQcm9wcy5ib29rLmRyYWZ0LmNoYXB0ZXJMaXN0LmluZGV4T2YodGhpcy5zdGF0ZS5zZWxlY3RlZENoYXB0ZXIpID09PVxuICAodGhpcy5mYWtlUHJvcHMuYm9vay5kcmFmdC5jaGFwdGVyTGlzdC5sZW5ndGggLSAxKTtcblxuICBzZWxlY3ROZXh0Q2hhcHRlciA9ICgpID0+IHtcbiAgICBjb25zdCBjaGFwdGVyTGlzdCA9IHRoaXMuZmFrZVByb3BzLmJvb2suZHJhZnQuY2hhcHRlckxpc3Q7XG4gICAgY29uc3QgaWR4ID0gY2hhcHRlckxpc3QuaW5kZXhPZih0aGlzLnN0YXRlLnNlbGVjdGVkQ2hhcHRlcik7XG4gICAgaWYgKGNoYXB0ZXJMaXN0W2lkeCArIDFdKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgc2VsZWN0ZWRDaGFwdGVyOiBjaGFwdGVyTGlzdFtpZHggKyAxXSB9KTtcbiAgICB9XG4gIH07XG5cbiAgc2VsZWN0UHJldmlvdXNDaGFwdGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGNoYXB0ZXJMaXN0ID0gdGhpcy5mYWtlUHJvcHMuYm9vay5kcmFmdC5jaGFwdGVyTGlzdDtcbiAgICBjb25zdCBpZHggPSBjaGFwdGVyTGlzdC5pbmRleE9mKHRoaXMuc3RhdGUuc2VsZWN0ZWRDaGFwdGVyKTtcbiAgICBpZiAoY2hhcHRlckxpc3RbaWR4IC0gMV0pIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBzZWxlY3RlZENoYXB0ZXI6IGNoYXB0ZXJMaXN0W2lkeCAtIDFdIH0pO1xuICAgIH1cbiAgfTtcblxuICAvKipcbiAgICogVGhpcyBtZXRob2Qgd2lsbCBnZXQgcGFzc2VkIGRvd24gdGhyb3VnaCBwcm9wcyBzbyB0aGF0IHdlIGNhblxuICAgKiBzZWxlY3QgYSBjaGFwdGVyIGZyb20gYSBjaGlsZCBjb21wb25lbnQgYW5kIGNoYW5nZSB0aGUgc3RhdGUgb2YgdGhpc1xuICAgKiBjb21wb25lbnQuXG4gICAqL1xuICBoYW5kbGVTZWxlY3RDaGFwdGVyID0gKHNlbGVjdGVkQ2hhcHRlcikgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBzZWxlY3RlZENoYXB0ZXIgfSk7XG4gIH07XG5cbiAgaGFuZGxlQ3JlYXRlQ2hhcHRlciA9ICgpID0+IHtcbiAgICBjb25zdCBkcmFmdCA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZmFrZVByb3BzLmJvb2suZHJhZnQpO1xuICAgIC8qIFRPRE86IEZpZ3VyZSBvdXQgbmV3IHdheSB0byBkbyBjaGFwdGVyIGtleSAqL1xuICAgIGNvbnN0IGNoYXB0ZXJLZXkgPSAnQ0hBTkdFIE1FJztcbiAgICBkcmFmdC5jaGFwdGVyc1tjaGFwdGVyS2V5XSA9IG5ld0NoYXB0ZXI7XG4gICAgZHJhZnQuY2hhcHRlckxpc3QucHVzaChjaGFwdGVyS2V5KTtcbiAgICB0aGlzLnNhdmVEcmFmdChkcmFmdCwgKCkgPT4ge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IHNlbGVjdGVkQ2hhcHRlcjogY2hhcHRlcktleSB9KTtcbiAgICB9KTtcbiAgfTtcblxuICAvKipcbiAgICogRm9yIG5vdywgd2Ugd2lsbCBoYW5kbGUgXCJkZWxldGluZ1wiIGEgY2hhcHRlciBmcm9tIHRoZSBkcmFmdFxuICAgKiBhcyBqdXN0IHJlbW92aW5nIHRoZSBrZXkgZnJvbSB0aGUgY2hhcHRlciBsaXN0LiBUaGlzIHdheSB3ZSBjb3VsZCBhZGRcbiAgICogZnVuY3Rpb25hbGl0eSBmb3IgdXNlcnMgdG8gc2VlIHRoZWlyIGRlbGV0ZWQgY2hhcHRlcnMsICYgdGhlbiAncGVybWFuZW50bHknXG4gICAqIGRlbGV0ZSB0aG9zZSBjaGFwdGVycy5cbiAgICpcbiAgICogSWYgdGhlcmUncyBvbmx5IDEgY2hhcHRlciByZW1haW5pbmcsIGxldCdzIG5vdCBsZXQgdGhlbSBkZWxldGUgaXQuXG4gICAqL1xuICBoYW5kbGVEZWxldGVDaGFwdGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IGRyYWZ0ID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5mYWtlUHJvcHMuYm9vay5kcmFmdCk7XG4gICAgLy8gRG9uJ3QgZGVsZXRlIHRoZSBsYXN0IGNoYXB0ZXIuIEEgYm9vayBuZWVkcyBhdCBsZWFzdCAxIGNoYXB0ZXIuXG4gICAgaWYgKGRyYWZ0LmNoYXB0ZXJMaXN0Lmxlbmd0aCA+IDEpIHtcbiAgICAgIGxldCBpZHggPSBkcmFmdC5jaGFwdGVyTGlzdC5pbmRleE9mKHRoaXMuc3RhdGUuc2VsZWN0ZWRDaGFwdGVyKTtcbiAgICAgIGRyYWZ0LmNoYXB0ZXJMaXN0LnNwbGljZShpZHgsIDEpO1xuICAgICAgdGhpcy5zYXZlRHJhZnQoZHJhZnQsICgpID0+IHtcbiAgICAgICAgaWYgKGlkeCA+PSBkcmFmdC5jaGFwdGVyTGlzdC5sZW5ndGgpIHtcbiAgICAgICAgICBpZHgtLTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldFN0YXRlKHsgc2VsZWN0ZWRDaGFwdGVyOiBkcmFmdC5jaGFwdGVyTGlzdFtpZHhdIH0pO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBUb2dnbGVzIHRoZSBzaWRlYmFyLCB1bmxlc3MgdHJ1ZSBpcyBwYXNzZWQgaW4uIFRoaXMgZW5zdXJlc1xuICAgKiB0aGUgc2lkZWJhciBpcyBzaG93bi5cbiAgICogQHBhcmFtIG9wZW5cbiAgICovXG4gIGhhbmRsZVNpZGViYXJDb250ZW50VG9nZ2xlID0gKG9wZW4gPSBmYWxzZSkgPT4ge1xuICAgIGNvbnN0IHNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zdGF0ZS5zZXR0aW5ncyk7XG4gICAgaWYgKG9wZW4pIHtcbiAgICAgIHNldHRpbmdzLmlzU2lkZWJhckNvbnRlbnRIaWRkZW4gPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0dGluZ3MuaXNTaWRlYmFyQ29udGVudEhpZGRlbiA9ICFzZXR0aW5ncy5pc1NpZGViYXJDb250ZW50SGlkZGVuO1xuICAgIH1cbiAgICB0aGlzLnNldFN0YXRlKHsgc2V0dGluZ3MgfSk7XG4gIH07XG5cbiAgaGFuZGxlVG9nZ2xlTGFuZ3VhZ2VNb2RhbCA9ICgpID0+IHtcbiAgICBjb25zb2xlLmxvZygnaGFuZGxlVG9nZ2xlTGFuZ3VhZ2VNb2RhbCcsIHRoaXMuc3RhdGUuc2hvd0xhbmd1YWdlTW9kYWwpO1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgc2hvd0xhbmd1YWdlTW9kYWw6ICF0aGlzLnN0YXRlLnNob3dMYW5ndWFnZU1vZGFsXG4gICAgfSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIElmIHRoZSBwYWdlIGlzIGxvYWRpbmcgZG8gb25lIHRoaW5nLCBvbmNlIHRoZSBwYWdlIGlzIGRvbmUgbG9hZGluZyBkbyBhXG4gICAqIGNoZWNrIHRvIG1ha2Ugc3VyZSB0aGVyZSBpcyBhIGJvb2sgdG8gdmlldy5cbiAgICovXG4gIHJlbmRlcigpIHtcbiAgICBjb25zb2xlLmxvZygnUmVuZGVyaW5nIEVkaXRvclBhZ2UnKTtcbiAgICAvLyBPdGhlcndpc2UsIGxldCdzIG1ha2Ugc3VyZSB0aGVyZSdzIGEgYm9vayBvdGhlcndpc2UgcmVkaXJlY3RcbiAgICAvLyBUaGUgcXVlcnkgaXRzZWxmIGZyb20gdGhlIHNlcnZlciB3aWxsXG4gICAgLy8gbWFrZSBzdXJlIHRoYXQgdGhlIHJpZ2h0IGJvb2sgaXMgcmV0dXJuZWQgaWZcbiAgICAvLyBpdCBleGlzdHMgZm9yIHRoaXMgdXNlci4gV2Ugd291bGRuJ3QgbGVhdmUgdGhhdCB1cCB0byB0aGUgY2xpZW50LlxuXG4gICAgLy8gVE9ETzogU0VUVElORyBUSElTIFRPIEFMV0FZUyBMT0FERUQgRk9SIE5PV1xuICAgIGlmICh0aGlzLnN0YXRlLmxvYWRlZCB8fCB0cnVlKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImVkaXRvci12aWV3LWNvbnRhaW5lclwiPlxuICAgICAgICAgIDxTdHlsZSBydWxlcz17dGhpcy5zdGF0ZS5zdHlsZX0gLz5cbiAgICAgICAgICA8UGFuZWxNb2RhbCBzaG93PXt0aGlzLnN0YXRlLnNob3dMYW5ndWFnZU1vZGFsfSAvPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibWFpbi1zaWRlYmFyLXdyYXBwZXJcIj5cbiAgICAgICAgICAgIDxTaWRlYmFyRWRpdG9yXG4gICAgICAgICAgICAgIGJvb2s9e3RoaXMuZmFrZVByb3BzLmJvb2t9XG4gICAgICAgICAgICAgIHNlbGVjdGVkQ2hhcHRlcj17dGhpcy5zdGF0ZS5zZWxlY3RlZENoYXB0ZXJ9XG4gICAgICAgICAgICAgIHNldHRpbmdzPXt0aGlzLnN0YXRlLnNldHRpbmdzfVxuICAgICAgICAgICAgICBtZXRob2RzPXt0aGlzLm1ldGhvZHN9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibWFpbi1ib29rLWNvbnRlbnQtd3JhcHBlclwiPlxuICAgICAgICAgICAgPE1haW5FZGl0b3JcbiAgICAgICAgICAgICAgYm9vaz17dGhpcy5mYWtlUHJvcHMuYm9va31cbiAgICAgICAgICAgICAgc2VsZWN0ZWRDaGFwdGVyPXt0aGlzLnN0YXRlLnNlbGVjdGVkQ2hhcHRlcn1cbiAgICAgICAgICAgICAgc2V0dGluZ3M9e3RoaXMuc3RhdGUuc2V0dGluZ3N9XG4gICAgICAgICAgICAgIG1ldGhvZHM9e3RoaXMubWV0aG9kc31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxufVxuXG4vKipcbiAqIFRoaXMgaXMgd2hlcmUgd2UgYWRkIG91ciBib29rIHRvIHRoZSBwcm9wcyBvZiBvdXIgY29tcG9uZW50LlxuICogU29tZSB0aGluZ3MgdG8gbm90ZSBhYm91dCB0aGlzLiBXaGVuIHByb3BzIGNoYW5nZSwgaXQgY291bGQgY2F1c2Ugb3VyXG4gKiBjb21wb25lbnRzIHRvIHJlLXJlbmRlci4gSWYgd2UncmUgdGFraW5nIHRoZSBlbnRpcmUgYm9vayBvYmplY3QsIHdoZW5cbiAqIGEgcmVhZGVyIGlzIGFkZGVkLCBvciBhbm90aGVyIHZhbHVlIGlzIGNoYW5nZWQgaXQgbWF5IGNhdXNlIHNvbWUgdW53YW50ZWRcbiAqIHJlbmRlcmluZy4gV2Ugd2lsbCBoYXZlIHRvIGNhcmVmdWxseSBpbnNwZWN0IHRoaXMgYWN0aXZpdHkgYW5kIHByb3Blcmx5XG4gKiBhZGp1c3QgaW4gY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcy5cbiAqXG4gKiByZXR1cm46IGJvb2sgYW5kIGxvYWRpbmcgYXJlIGJvdGggcmVhY3RpdmUgZGF0YSBzb3VyY2VzLiBib29rIGlzIHJlYWN0aXZlXG4gKiBiZWNhdXNlIGl0IGNvbWVzIGZyb20gYSBtZXRlb3IgbW9uZ29kYiByZWFjdGl2ZSBlbnZpcm9ubWVudC4gbG9hZGluZyBpcyBhXG4gKiByZWFjdGl2ZSB2YXJpYWJsZSB0aGF0IGlzIHRoZSBzdWJzY3JpcHRpb24gaGFuZGxlciBmb3IgYm9vay4gV2hlbiB0aGVcbiAqIHN1YnNjcmlwdGlvbiBpcyByZWFkeSwgbG9hZGluZyB3aWxsIGJlIGZhbHNlIChiZWNhdXNlIHdlIGFyZSBhc3NpZ25pbmcgaXRcbiAqIHRoZSBuZWdhdGUgdmFsdWUgb2YgdGhlIGhhbmRsZXIucmVhZHkoKSBmdW5jdGlvbilcbiAqL1xuLy8gZXhwb3J0IGRlZmF1bHQgY3JlYXRlQ29udGFpbmVyKChwcm9wcykgPT4ge1xuLy8gICAvLyBHZXQgdGhlIGJvb2sgZnJvbSB0aGUgc2x1Z1xuLy8gICBjb25zdCBib29rSGFuZGxlID0gTWV0ZW9yLnN1YnNjcmliZShcbi8vICAgICAnZ2V0Qm9va0ZvckJvb2tFZGl0Jyxcbi8vICAgICBwcm9wcy5wYXJhbXMuYm9va1NsdWdcbi8vICAgKTtcbi8vICAgLy8gQSB2YXJpYWJsZSB0byBzZWUgaWYgdGhlIGJvb2sgaXMgc3RpbGwgbG9hZGluZ1xuLy8gICBjb25zdCBzdWJzY3JpcHRpb25Mb2FkaW5nID0gIWJvb2tIYW5kbGUucmVhZHkoKTtcbi8vICAgY29uc3QgYm9vayA9IEJvb2tzLmZpbmQoe30pLmZldGNoKClbMF07XG4vLyAgIHJldHVybiB7XG4vLyAgICAgc3Vic2NyaXB0aW9uTG9hZGluZyxcbi8vICAgICBib29rXG4vLyAgIH07XG4vLyB9LCBFZGl0b3JQYWdlKTtcblxuZXhwb3J0IGRlZmF1bHQgRWRpdG9yUGFnZTtcblxuIl19